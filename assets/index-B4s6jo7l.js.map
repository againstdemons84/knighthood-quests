{"version":3,"file":"index-B4s6jo7l.js","sources":["../../node_modules/react-dom/client.js","../../src/utils/workoutDataHelpers.ts","../../src/utils/trainingMetrics.ts","../../src/data/workout-data/index.ts","../../src/utils/scenarioHelpers.ts","../../src/utils/optimalSelections.ts","../../src/utils/targetIntensityUtils.ts","../../src/hooks/useViewport.ts","../../src/utils/svgGenerator.tsx","../../src/components/WorkoutChart.tsx","../../src/components/WorkoutSelector.tsx","../../src/components/PrintQuestModal.print.ts","../../src/components/PrintQuestModal.tsx","../../src/components/ScenarioComparison.tsx","../../src/components/ScenarioManager.tsx","../../src/components/SaveScenarioModal.tsx","../../src/utils/userProfileHelpers.ts","../../src/components/UserProfileSetup.tsx","../../src/components/UserProfileManager.tsx","../../src/components/ReorderableWorkoutList.tsx","../../src/components/SharedScenarioView.tsx","../../src/components/IntroPage.tsx","../../src/components/PrivacyPolicyModal.tsx","../../src/components/Footer.tsx","../../src/hooks/useAppRouting.ts","../../src/services/systmApi.ts","../../src/utils/workoutScheduling.ts","../../src/components/WorkoutSchedulingModal.tsx","../../src/components/ScenarioDetailsView.tsx","../../src/routes/ScenarioDetailRoute.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\n * Utility functions for handling workout data with indoor/outdoor fallback logic\n */\n\nexport interface WorkoutDataResult {\n    data: any;\n    usedOutdoor: boolean;\n}\n\n/**\n * Check if all values in the workout data are zero\n */\nfunction hasAllZeroValues(workoutData: any): boolean {\n    if (!workoutData?.value || !Array.isArray(workoutData.value)) {\n        return true;\n    }\n    return workoutData.value.every((val: number) => val === 0);\n}\n\n/**\n * Get the best available workout data, preferring indoor but falling back to outdoor if indoor has all zeros\n */\nexport function getBestWorkoutData(rawData: any): WorkoutDataResult {\n    const indoor = rawData?.data?.workoutGraphTriggers?.indoor;\n    const outdoor = rawData?.data?.workoutGraphTriggers?.outdoor;\n\n    // Prefer indoor data if it exists and has non-zero values\n    if (indoor && !hasAllZeroValues(indoor)) {\n        return {\n            data: indoor,\n            usedOutdoor: false\n        };\n    }\n\n    // Fallback to outdoor data if available\n    if (outdoor) {\n        return {\n            data: outdoor,\n            usedOutdoor: true\n        };\n    }\n\n    // Return indoor data even if it's all zeros (better than nothing)\n    return {\n        data: indoor || null,\n        usedOutdoor: false\n    };\n}","import { WorkoutData } from '../types/workout';\nimport { UserProfile } from '../types/user';\nimport { UserPowerProfile } from '../types/userProfile';\n\n/**\n * Get the actual power value for a workout segment based on type, intensity, and user profile\n */\nexport const getPowerValue = (type: string, intensity: number, userProfile?: UserProfile | UserPowerProfile): number => {\n    if (!userProfile) {\n        return intensity; // Fallback if no user profile\n    }\n    \n    switch (type) {\n        case 'NM':\n            return intensity * userProfile.nm;\n        case 'AC':\n            return intensity * userProfile.ac;\n        case 'MAP':\n            return intensity * userProfile.map;\n        case 'FTP':\n        default:\n            return intensity * userProfile.ftp;\n    }\n};\n\n/**\n * Calculate Normalized Power (NP) using the 4-step process:\n * 1. Calculate 30-second rolling averages\n * 2. Raise each to the 4th power\n * 3. Average the 4th powers\n * 4. Take the 4th root of the average\n */\nexport const calculateNormalizedPower = (workoutData: WorkoutData, userProfile?: UserProfile | UserPowerProfile): number => {\n    const { time, value, type } = workoutData;\n    \n    if (!userProfile) {\n        return 0; // Can't calculate without user profile\n    }\n    \n    // Step 1: Create a second-by-second power array\n    const maxTime = Math.max(...time);\n    const powerBySecond: number[] = [];\n    \n    // Fill the power array with actual power values for each second\n    for (let second = 0; second < maxTime; second++) {\n        // Find which segment this second belongs to\n        let segmentIndex = 0;\n        for (let i = 0; i < time.length - 1; i++) {\n            if (second >= time[i] && second < time[i + 1]) {\n                segmentIndex = i;\n                break;\n            }\n        }\n        \n        const actualPower = getPowerValue(type[segmentIndex], value[segmentIndex], userProfile);\n        powerBySecond.push(actualPower);\n    }\n    \n    // Step 2: Calculate 30-second rolling averages\n    const rollingAverages: number[] = [];\n    for (let i = 0; i <= powerBySecond.length - 30; i++) {\n        const thirtySecondSlice = powerBySecond.slice(i, i + 30);\n        const average = thirtySecondSlice.reduce((sum, power) => sum + power, 0) / 30;\n        rollingAverages.push(average);\n    }\n    \n    if (rollingAverages.length === 0) {\n        return 0; // Not enough data\n    }\n    \n    // Step 3: Raise each rolling average to the 4th power\n    const fourthPowers = rollingAverages.map(avg => Math.pow(avg, 4));\n    \n    // Step 4: Calculate the average of the 4th powers\n    const averageOfFourthPowers = fourthPowers.reduce((sum, power) => sum + power, 0) / fourthPowers.length;\n    \n    // Step 5: Take the 4th root to get Normalized Power\n    const normalizedPower = Math.pow(averageOfFourthPowers, 1/4);\n    \n    return isNaN(normalizedPower) ? 0 : Math.round(normalizedPower);\n};\n\n/**\n * Calculate Intensity Factor (IF)\n * Formula: IF = NP ÷ FTP\n */\nexport const calculateIntensityFactor = (normalizedPower: number, userProfile?: UserProfile | UserPowerProfile): number => {\n    if (!userProfile || userProfile.ftp === 0 || isNaN(userProfile.ftp) || isNaN(normalizedPower)) {\n        return 0; // Can't calculate without user profile or valid FTP\n    }\n    \n    // IF = NP ÷ FTP\n    const intensityFactor = normalizedPower / userProfile.ftp;\n    \n    // Return rounded to 2 decimal places, but check for NaN first\n    return isNaN(intensityFactor) ? 0 : Math.round(intensityFactor * 100) / 100;\n};\n\n/**\n * Calculate Training Stress Score (TSS)\n * Formula: TSS = IF² × Duration in Hours × 100\n */\nexport const calculateTrainingStressScore = (intensityFactor: number, durationInSeconds: number): number => {\n    if (intensityFactor === 0 || durationInSeconds === 0 || isNaN(intensityFactor) || isNaN(durationInSeconds)) {\n        return 0; // Can't calculate without valid inputs\n    }\n    \n    // Convert duration from seconds to hours\n    const durationInHours = durationInSeconds / 3600;\n    \n    // TSS = IF² × Duration in Hours × 100\n    const tss = Math.pow(intensityFactor, 2) * durationInHours * 100;\n    \n    // Return rounded to nearest whole number, but check for NaN first\n    return isNaN(tss) ? 0 : Math.round(tss);\n};\n\n/**\n * Calculate all training metrics at once for convenience\n */\nexport const calculateAllTrainingMetrics = (workoutData: WorkoutData, userProfile?: UserProfile | UserPowerProfile) => {\n    const maxTime = Math.max(...workoutData.time);\n    const duration = Math.floor(maxTime);\n    \n    const normalizedPower = calculateNormalizedPower(workoutData, userProfile);\n    const intensityFactor = calculateIntensityFactor(normalizedPower, userProfile);\n    const trainingStressScore = calculateTrainingStressScore(intensityFactor, duration);\n    \n    return {\n        normalizedPower,\n        intensityFactor,\n        trainingStressScore,\n        duration\n    };\n};\n\n/**\n * getPowerValue is now exported above as part of the function declaration\n */","// Auto-generated workout data imports\n// This file consolidates all workout JSON files into a single importable module\n\nimport workout_14TmGHiqpC from './14TmGHiqpC.json';\nimport workout_1tViNkXwKQ from './1tViNkXwKQ.json';\nimport workout_3aJ8nMrgLd from './3aJ8nMrgLd.json';\nimport workout_3rLnRlTdQ3 from './3rLnRlTdQ3.json';\nimport workout_54dYn0oExU from './54dYn0oExU.json';\nimport workout_553lkiVNgV from './553lkiVNgV.json';\nimport workout_89HeFQSbGE from './89HeFQSbGE.json';\nimport workout_FML2PrDvkR from './FML2PrDvkR.json';\nimport workout_IX2uSFbGPZ from './IX2uSFbGPZ.json';\nimport workout_JpDMHRZtaB from './JpDMHRZtaB.json';\nimport workout_LGt8MqcvdQ from './LGt8MqcvdQ.json';\nimport workout_MzBfwwDxEB from './MzBfwwDxEB.json';\nimport workout_NkctG9Onu1 from './NkctG9Onu1.json';\nimport workout_OIoXe9I4bh from './OIoXe9I4bh.json';\nimport workout_PexwKSHyz6 from './PexwKSHyz6.json';\nimport workout_TBn7DwOwEc from './TBn7DwOwEc.json';\nimport workout_VBEbqmsmYl from './VBEbqmsmYl.json';\nimport workout_YBjIjxrpJ2 from './YBjIjxrpJ2.json';\nimport workout_aB01LoXAZk from './aB01LoXAZk.json';\nimport workout_bZIBbPzXc6 from './bZIBbPzXc6.json';\nimport workout_e0fpoQCSWR from './e0fpoQCSWR.json';\nimport workout_ereX1jTlGO from './ereX1jTlGO.json';\nimport workout_k0MlcITKGW from './k0MlcITKGW.json';\nimport workout_tJpZlAA0hq from './tJpZlAA0hq.json';\nimport workout_uLOWEcW9V1 from './uLOWEcW9V1.json';\nimport workout_vCBrff5o6l from './vCBrff5o6l.json';\nimport workout_xjx8cV9fzM from './xjx8cV9fzM.json';\nimport workout_xzCdnkKwU1 from './xzCdnkKwU1.json';\n\nexport const workoutData: Record<string, any> = {\n  '14TmGHiqpC': workout_14TmGHiqpC,\n  '1tViNkXwKQ': workout_1tViNkXwKQ,\n  '3aJ8nMrgLd': workout_3aJ8nMrgLd,\n  '3rLnRlTdQ3': workout_3rLnRlTdQ3,\n  '54dYn0oExU': workout_54dYn0oExU,\n  '553lkiVNgV': workout_553lkiVNgV,\n  '89HeFQSbGE': workout_89HeFQSbGE,\n  'FML2PrDvkR': workout_FML2PrDvkR,\n  'IX2uSFbGPZ': workout_IX2uSFbGPZ,\n  'JpDMHRZtaB': workout_JpDMHRZtaB,\n  'LGt8MqcvdQ': workout_LGt8MqcvdQ,\n  'MzBfwwDxEB': workout_MzBfwwDxEB,\n  'NkctG9Onu1': workout_NkctG9Onu1,\n  'OIoXe9I4bh': workout_OIoXe9I4bh,\n  'PexwKSHyz6': workout_PexwKSHyz6,\n  'TBn7DwOwEc': workout_TBn7DwOwEc,\n  'VBEbqmsmYl': workout_VBEbqmsmYl,\n  'YBjIjxrpJ2': workout_YBjIjxrpJ2,\n  'aB01LoXAZk': workout_aB01LoXAZk,\n  'bZIBbPzXc6': workout_bZIBbPzXc6,\n  'e0fpoQCSWR': workout_e0fpoQCSWR,\n  'ereX1jTlGO': workout_ereX1jTlGO,\n  'k0MlcITKGW': workout_k0MlcITKGW,\n  'tJpZlAA0hq': workout_tJpZlAA0hq,\n  'uLOWEcW9V1': workout_uLOWEcW9V1,\n  'vCBrff5o6l': workout_vCBrff5o6l,\n  'xjx8cV9fzM': workout_xjx8cV9fzM,\n  'xzCdnkKwU1': workout_xzCdnkKwU1,\n};\n\n/**\n * Get workout data by ID (replaces fetch calls)\n */\nexport const getWorkoutData = (workoutId: string): any | null => {\n  return workoutData[workoutId] || null;\n};","import { Scenario, WorkoutSelection } from '../types/scenario';\nimport { getBestWorkoutData } from './workoutDataHelpers';\nimport { calculateAllTrainingMetrics } from './trainingMetrics';\nimport { getWorkoutData } from '../data/workout-data';\n\nconst SCENARIOS_STORAGE_KEY = 'knighthood_scenarios';\n\n/**\n * Load workout metrics dynamically from JSON files\n */\nexport const loadWorkoutMetrics = async (workoutId: string, userProfile?: any) => {\n    try {\n        const rawData = getWorkoutData(workoutId);\n        if (!rawData) {\n            throw new Error(`Workout data not found for ${workoutId}`);\n        }\n        \n        const result = getBestWorkoutData(rawData);\n        \n        if (!result.data) {\n            return null;\n        }\n\n        // Calculate metrics using the training metrics utility\n        const metrics = calculateAllTrainingMetrics(result.data, userProfile);\n        \n        return {\n            duration: (isNaN(metrics.duration) || !isFinite(metrics.duration)) ? 0 : metrics.duration,\n            tss: (isNaN(metrics.trainingStressScore) || !isFinite(metrics.trainingStressScore)) ? 0 : metrics.trainingStressScore,\n            intensityFactor: (isNaN(metrics.intensityFactor) || !isFinite(metrics.intensityFactor)) ? 0 : metrics.intensityFactor,\n            normalizedPower: (isNaN(metrics.normalizedPower) || !isFinite(metrics.normalizedPower)) ? 0 : metrics.normalizedPower\n        };\n    } catch (error) {\n        console.error(`Error loading workout metrics for ${workoutId}:`, error);\n        return null;\n    }\n};\n\nexport const saveScenarios = (scenarios: Scenario[]): void => {\n    try {\n        localStorage.setItem(SCENARIOS_STORAGE_KEY, JSON.stringify(scenarios));\n    } catch (error) {\n        console.error('Failed to save scenarios to localStorage:', error);\n    }\n};\n\nexport const loadScenarios = (): Scenario[] => {\n    try {\n        const stored = localStorage.getItem(SCENARIOS_STORAGE_KEY);\n        return stored ? JSON.parse(stored) : [];\n    } catch (error) {\n        console.error('Failed to load scenarios from localStorage:', error);\n        return [];\n    }\n};\n\n/**\n * Calculate combined metrics dynamically from workout JSON files\n */\nexport const calculateCombinedMetricsDynamic = async (workouts: WorkoutSelection[], userProfile?: any) => {\n    if (workouts.length === 0) {\n        return {\n            totalDuration: 0,\n            totalElapsedDuration: 0,\n            totalTSS: 0,\n            averageIF: 0,\n            totalNP: 0\n        };\n    }\n\n    // Load metrics for all workouts dynamically\n    const metricsPromises = workouts.map(workout => loadWorkoutMetrics(workout.id, userProfile));\n    const allMetrics = await Promise.all(metricsPromises);\n    \n    // Filter out failed loads\n    const validMetrics = allMetrics.filter(m => m !== null);\n    \n    if (validMetrics.length === 0) {\n        return {\n            totalDuration: 0,\n            totalElapsedDuration: 0,\n            totalTSS: 0,\n            averageIF: 0,\n            totalNP: 0\n        };\n    }\n    \n    const totalDuration = validMetrics.reduce((sum, m) => sum + (m?.duration || 0), 0);\n    const totalTSS = validMetrics.reduce((sum, m) => sum + (m?.tss || 0), 0);\n    \n    // Calculate elapsed duration: total workout time + 10 minutes rest between workouts\n    const restPeriods = Math.max(0, validMetrics.length - 1) * 10 * 60; // 10 minutes in seconds\n    const totalElapsedDuration = totalDuration + restPeriods;\n\n    // Calculate average IF weighted by duration\n    const totalIFDuration = validMetrics.reduce((sum, m) => {\n        const ifValue = m?.intensityFactor || 0;\n        const duration = m?.duration || 0;\n        const product = ifValue * duration;\n        return sum + (isNaN(product) ? 0 : product);\n    }, 0);\n    const averageIF = totalDuration > 0 ? (isNaN(totalIFDuration / totalDuration) ? 0 : totalIFDuration / totalDuration) : 0;\n    \n    // Calculate average NP weighted by duration  \n    const totalNPDuration = validMetrics.reduce((sum, m) => {\n        const npValue = m?.normalizedPower || 0;\n        const duration = m?.duration || 0;\n        const product = npValue * duration;\n        return sum + (isNaN(product) ? 0 : product);\n    }, 0);\n    const totalNP = totalDuration > 0 ? (isNaN(totalNPDuration / totalDuration) ? 0 : totalNPDuration / totalDuration) : 0;\n\n    return {\n        totalDuration,\n        totalElapsedDuration,\n        totalTSS,\n        averageIF,\n        totalNP\n    };\n};\n\n/**\n * Legacy function - kept for compatibility but will use stored metrics\n */\nexport const calculateCombinedMetrics = (workouts: WorkoutSelection[]) => {\n    const validWorkouts = workouts.filter(w => w.metrics !== null);\n    \n    if (validWorkouts.length === 0) {\n        return {\n            totalDuration: 0,\n            totalElapsedDuration: 0,\n            totalTSS: 0,\n            averageIF: 0,\n            totalNP: 0\n        };\n    }\n\n    const totalDuration = validWorkouts.reduce((sum, w) => {\n        const duration = w.metrics?.duration || 0;\n        return sum + (isNaN(duration) || !isFinite(duration) ? 0 : duration);\n    }, 0);\n    \n    const totalTSS = validWorkouts.reduce((sum, w) => {\n        const tss = w.metrics?.tss || 0;\n        return sum + (isNaN(tss) || !isFinite(tss) ? 0 : tss);\n    }, 0);\n    \n    // Calculate elapsed duration: total workout time + 10 minutes rest between workouts\n    // (no rest after the final workout)\n    const restPeriods = Math.max(0, validWorkouts.length - 1) * 10 * 60; // 10 minutes in seconds\n    const totalElapsedDuration = totalDuration + restPeriods;\n\n    // Calculate average IF weighted by duration\n    const totalIFDuration = validWorkouts.reduce((sum, w) => {\n        const ifValue = w.metrics?.intensityFactor || 0;\n        const duration = w.metrics?.duration || 0;\n        const product = ifValue * duration;\n        return sum + (isNaN(product) || !isFinite(product) ? 0 : product);\n    }, 0);\n    const averageIF = totalDuration > 0 ? totalIFDuration / totalDuration : 0;\n    \n    // Calculate average NP weighted by duration  \n    const totalNPDuration = validWorkouts.reduce((sum, w) => {\n        const npValue = w.metrics?.normalizedPower || 0;\n        const duration = w.metrics?.duration || 0;\n        const product = npValue * duration;\n        return sum + (isNaN(product) || !isFinite(product) ? 0 : product);\n    }, 0);\n    const totalNP = totalDuration > 0 ? totalNPDuration / totalDuration : 0;\n\n    return {\n        totalDuration,\n        totalElapsedDuration,\n        totalTSS,\n        averageIF,\n        totalNP\n    };\n};\n\nexport const formatDuration = (seconds: number): string => {\n    // Handle NaN, null, undefined, or negative values\n    if (seconds == null || isNaN(seconds) || seconds < 0) {\n        return '00:00';\n    }\n    \n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = Math.floor(seconds % 60);\n    \n    if (hours > 0) {\n        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    } else {\n        return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n};\n\nexport const generateScenarioId = (): string => {\n    return `scenario_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n};","import { WorkoutSelection } from '../types/scenario';\n\nexport interface SortedWorkout {\n    id: string;\n    name: string;\n    tss: number;\n    duration: number;\n    intensityFactor: number;\n    normalizedPower: number;\n}\n\nexport const generateOptimalSelections = (workouts: SortedWorkout[]) => {\n    // Filter out workouts without metrics\n    const validWorkouts = workouts.filter(w => w.tss > 0);\n    \n    if (validWorkouts.length < 10) {\n        return {\n            lowestTSS: [],\n            highestTSS: [],\n            shortestDuration: [],\n            longestDuration: [],\n            lowestIF: [],\n            highestIF: [],\n            balanced: []\n        };\n    }\n\n    // Sort by different criteria and take top 10\n    const lowestTSS = [...validWorkouts]\n        .sort((a, b) => a.tss - b.tss)\n        .slice(0, 10);\n    \n    const highestTSS = [...validWorkouts]\n        .sort((a, b) => b.tss - a.tss)\n        .slice(0, 10);\n    \n    const shortestDuration = [...validWorkouts]\n        .sort((a, b) => a.duration - b.duration)\n        .slice(0, 10);\n    \n    const longestDuration = [...validWorkouts]\n        .sort((a, b) => b.duration - a.duration)\n        .slice(0, 10);\n    \n    const lowestIF = [...validWorkouts]\n        .sort((a, b) => a.intensityFactor - b.intensityFactor)\n        .slice(0, 10);\n    \n    const highestIF = [...validWorkouts]\n        .sort((a, b) => b.intensityFactor - a.intensityFactor)\n        .slice(0, 10);\n    \n    // Balanced approach: select workouts with moderate values across all metrics\n    const balanced = [...validWorkouts]\n        .map(workout => {\n            // Normalize values (0-1 scale)\n            const maxTSS = Math.max(...validWorkouts.map(w => w.tss));\n            const maxDuration = Math.max(...validWorkouts.map(w => w.duration));\n            const maxIF = Math.max(...validWorkouts.map(w => w.intensityFactor));\n            \n            const minTSS = Math.min(...validWorkouts.map(w => w.tss));\n            const minDuration = Math.min(...validWorkouts.map(w => w.duration));\n            const minIF = Math.min(...validWorkouts.map(w => w.intensityFactor));\n            \n            // Normalize to 0-1 scale using actual range\n            const normalizedTSS = (workout.tss - minTSS) / (maxTSS - minTSS);\n            const normalizedDuration = (workout.duration - minDuration) / (maxDuration - minDuration);\n            const normalizedIF = (workout.intensityFactor - minIF) / (maxIF - minIF);\n            \n            // Balanced score: prefer workouts in the middle range (0.3-0.7) for each metric\n            // Calculate distance from ideal middle range\n            const tssDistance = Math.abs(normalizedTSS - 0.5);\n            const durationDistance = Math.abs(normalizedDuration - 0.5);\n            const ifDistance = Math.abs(normalizedIF - 0.5);\n            \n            // Balanced score (lower is better) - penalize extremes more\n            const balanceScore = (tssDistance + durationDistance + ifDistance) / 3;\n            \n            return { ...workout, balanceScore, normalizedTSS, normalizedDuration, normalizedIF };\n        })\n        .sort((a, b) => a.balanceScore - b.balanceScore) // Lower score = more balanced\n        .slice(0, 10);\n\n    return {\n        lowestTSS,\n        highestTSS,\n        shortestDuration,\n        longestDuration,\n        lowestIF,\n        highestIF,\n        balanced\n    };\n};\n\nexport const convertToWorkoutSelections = (sortedWorkouts: SortedWorkout[]): WorkoutSelection[] => {\n    return sortedWorkouts.map(workout => ({\n        id: workout.id,\n        name: workout.name,\n        metrics: {\n            duration: workout.duration,\n            tss: workout.tss,\n            intensityFactor: workout.intensityFactor,\n            normalizedPower: workout.normalizedPower\n        }\n    }));\n};","/**\n * Utility functions for handling target intensity values with consistent fallback logic\n */\n\n// Default target intensity when none is set\nexport const DEFAULT_TARGET_INTENSITY = 70;\n\n/**\n * Gets the target intensity value with fallback to default (70%)\n * Handles both undefined values and NaN/invalid values\n * \n * @param userProfile - User profile object that may contain targetIntensity\n * @returns Valid target intensity value (70 if not set or invalid)\n */\nexport function getTargetIntensity(userProfile: any): number {\n    // Handle undefined/null profile\n    if (!userProfile) {\n        return DEFAULT_TARGET_INTENSITY;\n    }\n\n    // Check direct targetIntensity property (UserPowerProfile structure)\n    if (userProfile.targetIntensity != null && \n        !isNaN(userProfile.targetIntensity) && \n        isFinite(userProfile.targetIntensity) &&\n        userProfile.targetIntensity > 0) {\n        return userProfile.targetIntensity;\n    }\n\n    // Check nested powerProfile.targetIntensity (UserProfileData structure)\n    if (userProfile.powerProfile?.targetIntensity != null && \n        !isNaN(userProfile.powerProfile.targetIntensity) && \n        isFinite(userProfile.powerProfile.targetIntensity) &&\n        userProfile.powerProfile.targetIntensity > 0) {\n        return userProfile.powerProfile.targetIntensity;\n    }\n\n\n\n    // Fallback to default\n    return DEFAULT_TARGET_INTENSITY;\n}\n\n/**\n * Gets target intensity as a decimal factor (e.g., 70% -> 0.7)\n * \n * @param userProfile - User profile object that may contain targetIntensity\n * @returns Target intensity as decimal factor\n */\nexport function getTargetIntensityFactor(userProfile: any): number {\n    return getTargetIntensity(userProfile) / 100;\n}\n\n/**\n * Formats target intensity for display (e.g., \"70%\")\n * \n * @param userProfile - User profile object that may contain targetIntensity\n * @returns Formatted intensity string with % symbol\n */\nexport function formatTargetIntensity(userProfile: any): string {\n    return `${getTargetIntensity(userProfile)}%`;\n}","import { useState, useEffect } from 'react';\n\nexport interface ViewportInfo {\n  width: number;\n  height: number;\n  isMobile: boolean;\n  isTablet: boolean;\n  isDesktop: boolean;\n  orientation: 'portrait' | 'landscape';\n}\n\n/**\n * Hook to track viewport information and responsive breakpoints\n */\nexport const useViewport = (): ViewportInfo => {\n  const [viewport, setViewport] = useState<ViewportInfo>({\n    width: typeof window !== 'undefined' ? window.innerWidth : 1024,\n    height: typeof window !== 'undefined' ? window.innerHeight : 768,\n    isMobile: false,\n    isTablet: false,\n    isDesktop: true,\n    orientation: 'landscape'\n  });\n\n  useEffect(() => {\n    const updateViewport = () => {\n      const width = window.innerWidth;\n      const height = window.innerHeight;\n      \n      setViewport({\n        width,\n        height,\n        isMobile: width < 768,\n        isTablet: width >= 768 && width < 1024,\n        isDesktop: width >= 1024,\n        orientation: width > height ? 'landscape' : 'portrait'\n      });\n    };\n\n    // Initial call\n    updateViewport();\n\n    // Add event listener\n    window.addEventListener('resize', updateViewport);\n    window.addEventListener('orientationchange', updateViewport);\n\n    // Cleanup\n    return () => {\n      window.removeEventListener('resize', updateViewport);\n      window.removeEventListener('orientationchange', updateViewport);\n    };\n  }, []);\n\n  return viewport;\n};","import React from 'react';\nimport { WorkoutData } from '../types/workout';\nimport { UserProfile } from '../types/user';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { \n    calculateAllTrainingMetrics, \n    getPowerValue \n} from './trainingMetrics';\n\nconst getColorByType = (type: string): string => {\n    switch (type) {\n        case 'NM':\n            return '#FF1493'; // Pink/magenta for Neuromuscular Power\n        case 'AC':\n            return '#FFA500'; // Orange for Anaerobic Capacity\n        case 'MAP':\n            return '#FFD700'; // Gold for Maximum Aerobic Power\n        case 'FTP':\n        default:\n            return '#0BBEEB'; // Blue for Functional Threshold Power\n    }\n};\n\n\n\nexport const generateSVG = (workoutData: WorkoutData, userProfile?: UserProfile | UserPowerProfile, showMetrics: boolean = false) => {\n    const { time, value, type } = workoutData;\n    const maxTime = Math.max(...time);\n    const svgWidth = 3057;\n    const svgHeight = 370.7;\n    const chartHeight = 250; // Height available for the chart\n    const chartTop = 50; // Top margin for the chart\n    \n    const elements = [];\n    \n    // Calculate max power for scaling (find the highest actual power value)\n    let maxPower = 1.0;\n    for (let i = 0; i < type.length; i++) {\n        const actualPower = getPowerValue(type[i], value[i], userProfile);\n        if (actualPower > maxPower) {\n            maxPower = actualPower;\n        }\n    }\n    \n    // Generate workout bars\n    let currentX = 0; // Track cumulative X position to ensure gapless rendering\n    for (let i = 0; i < time.length - 1; i++) {\n        const startTime = time[i];\n        const endTime = time[i + 1];\n        const intensity = value[i];\n        const workoutType = type[i];\n        \n        // Calculate position and dimensions\n        // Use cumulative X position to ensure gapless rendering: Rect1.x + Rect1.width = Rect2.x\n        const x = Math.round(currentX); // Ensure integer x position\n        const rectWidthFloat = ((endTime - startTime) / maxTime) * svgWidth;\n        const rectWidth = Math.max(1, Math.round(rectWidthFloat)); // Ensure integer width\n        currentX += rectWidth; // Update for next rectangle using precise float value\n        \n        // Calculate actual power for this segment\n        const actualPower = getPowerValue(workoutType, intensity, userProfile);\n        const actualPowerRatio = actualPower / maxPower;\n        \n        // Calculate height based on the actual power ratio\n        const rectHeight = actualPowerRatio * chartHeight;\n        const y = chartTop + chartHeight - rectHeight;\n        \n        // Get color based on workout type\n        const fillColor = getColorByType(workoutType);\n        \n        elements.push(\n            React.createElement('rect', {\n                key: `bar-${i}`,\n                x: x,\n                y: y,\n                width: rectWidth,\n                height: rectHeight,\n                fill: fillColor\n            })\n        );\n    }\n    \n    // Add baseline\n    elements.push(\n        React.createElement('rect', {\n            key: 'baseline',\n            x: 0,\n            y: chartTop + chartHeight,\n            width: svgWidth,\n            height: 2,\n            fill: '#666'\n        })\n    );\n    \n    // Add power zones indicators if user profile is available\n    if (userProfile) {\n        const ftp = userProfile.ftp;\n        \n        // Add FTP reference line (100% FTP line)\n        const ftpPower = userProfile.ftp; // 100% FTP intensity\n        const ftpRatio = ftpPower / maxPower;\n        const ftpY = chartTop + chartHeight - (chartHeight * ftpRatio);\n        elements.push(\n            React.createElement('line', {\n                key: 'ftp-line',\n                x1: 0,\n                y1: ftpY,\n                x2: svgWidth,\n                y2: ftpY,\n                stroke: '#0BBEEB',\n                strokeWidth: 1,\n                strokeDasharray: '5,5',\n                opacity: 0.7\n            })\n        );\n        \n        // Add FTP power annotation with background\n        elements.push(\n            React.createElement('rect', {\n                key: 'ftp-annotation-bg',\n                x: 20,\n                y: ftpY - 25,\n                width: 80,\n                height: 20,\n                fill: '#444',\n                rx: 10,\n                ry: 10\n            })\n        );\n        \n        elements.push(\n            React.createElement('text', {\n                key: 'ftp-annotation',\n                x: 60,\n                y: ftpY - 10,\n                fill: '#fff',\n                fontSize: '14',\n                fontWeight: 'bold',\n                fontFamily: 'Arial, sans-serif',\n                textAnchor: 'middle'\n            }, `${ftp} W`)\n        );\n    }\n    \n    return elements;\n};\n\n\n\nexport const generateWorkoutHeader = (workoutData: WorkoutData, userProfile?: UserProfile | UserPowerProfile, showMetrics: boolean = false) => {\n    const maxTime = Math.max(...workoutData.time);\n    const duration = Math.floor(maxTime);\n    \n    // Return empty array if metrics are disabled\n    if (!showMetrics) {\n        return [];\n    }\n    \n    const headerElements = [];\n    \n    // Calculate duration formatting\n    const totalSeconds = duration;\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    \n    let durationText;\n    if (hours > 0) {\n        durationText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    } else {\n        durationText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    }\n    \n    // Font sizes for the header text (scaled for SVG coordinates)\n    const labelFontSize = '24';\n    const valueFontSize = '36';\n    const legendFontSize = '20';\n    \n    // Left side metrics - positioned above the chart area with better spacing\n    const metricsY = 30;\n    const valuesY = 65;\n    \n    // Duration\n    headerElements.push(\n        React.createElement('text', {\n            key: 'duration-label',\n            x: 30,\n            y: metricsY,\n            fill: '#999',\n            fontSize: labelFontSize,\n            fontFamily: 'Arial, sans-serif'\n        }, 'Duration')\n    );\n    \n    headerElements.push(\n        React.createElement('text', {\n            key: 'duration-value',\n            x: 30,\n            y: valuesY,\n            fill: '#fff',\n            fontSize: valueFontSize,\n            fontWeight: 'bold',\n            fontFamily: 'Arial, sans-serif'\n        }, durationText)\n    );\n    \n    // Calculate all training metrics using the library\n    const metrics = calculateAllTrainingMetrics(workoutData, userProfile);\n    const { normalizedPower: np, intensityFactor, trainingStressScore: tss } = metrics;\n    headerElements.push(\n        React.createElement('text', {\n            key: 'tss-label',\n            x: 200,\n            y: metricsY,\n            fill: '#999',\n            fontSize: labelFontSize,\n            fontFamily: 'Arial, sans-serif'\n        }, 'TSS®')\n    );\n    \n    headerElements.push(\n        React.createElement('text', {\n            key: 'tss-value',\n            x: 200,\n            y: valuesY,\n            fill: '#fff',\n            fontSize: valueFontSize,\n            fontWeight: 'bold',\n            fontFamily: 'Arial, sans-serif'\n        }, `${tss}`)\n    );\n    headerElements.push(\n        React.createElement('text', {\n            key: 'if-label',\n            x: 320,\n            y: metricsY,\n            fill: '#999',\n            fontSize: labelFontSize,\n            fontFamily: 'Arial, sans-serif'\n        }, 'IF®')\n    );\n    \n    headerElements.push(\n        React.createElement('text', {\n            key: 'if-value',\n            x: 320,\n            y: valuesY,\n            fill: '#fff',\n            fontSize: valueFontSize,\n            fontWeight: 'bold',\n            fontFamily: 'Arial, sans-serif'\n        }, intensityFactor.toFixed(2))\n    );\n    \n    // NP (Normalised Power) - calculated value\n    headerElements.push(\n        React.createElement('text', {\n            key: 'np-label',\n            x: 440,\n            y: metricsY,\n            fill: '#999',\n            fontSize: labelFontSize,\n            fontFamily: 'Arial, sans-serif'\n        }, 'NP®')\n    );\n    \n    headerElements.push(\n        React.createElement('text', {\n            key: 'np-value',\n            x: 440,\n            y: valuesY,\n            fill: '#fff',\n            fontSize: valueFontSize,\n            fontWeight: 'bold',\n            fontFamily: 'Arial, sans-serif'\n        }, `${np}`)\n    );\n    \n    // Right side power zone legend\n    const legendStartX = 2200;\n    const legendSpacing = 200;\n    const circleRadius = 8;\n    const circleY = 40;\n    \n    // Power zone legend items\n    const powerZones = [\n        { label: 'NM', color: '#FF1493' },\n        { label: 'AC', color: '#FFA500' },\n        { label: 'MAP', color: '#FFD700' },\n        { label: 'FTP', color: '#0BBEEB' }\n    ];\n    \n    powerZones.forEach((zone, index) => {\n        const xPos = legendStartX + (index * legendSpacing);\n        \n        // Zone label\n        headerElements.push(\n            React.createElement('text', {\n                key: `legend-${zone.label}`,\n                x: xPos,\n                y: 25,\n                fill: '#999',\n                fontSize: legendFontSize,\n                fontFamily: 'Arial, sans-serif',\n                textAnchor: 'middle'\n            }, zone.label)\n        );\n        \n        // Create 5 circles for each zone\n        for (let i = 0; i < 5; i++) {\n            headerElements.push(\n                React.createElement('circle', {\n                    key: `circle-${zone.label}-${i}`,\n                    cx: xPos - 40 + (i * 20),\n                    cy: circleY,\n                    r: circleRadius,\n                    fill: zone.color\n                })\n            );\n        }\n    });\n    \n    return headerElements;\n};","import React from 'react';\nimport { WorkoutData } from '../types/workout';\nimport { UserProfile } from '../types/user';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { generateSVG, generateWorkoutHeader } from '../utils/svgGenerator';\nimport styles from './WorkoutChart.module.css';\n\ninterface WorkoutChartProps {\n    workoutData: WorkoutData;\n    userProfile?: UserProfile | UserPowerProfile;\n    width?: number;\n    height?: number;\n    showMetrics?: boolean;\n}\n\nconst WorkoutChart: React.FC<WorkoutChartProps> = ({ \n    workoutData, \n    userProfile,\n    width = 800, \n    height = 200,\n    showMetrics = false\n}) => {\n    const svgWidth = 3057;\n    const svgHeight = 370.7;\n    \n    return (\n        <div className={styles.container} style={{ height: height }}>\n            <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 3057 370.7\"\n                preserveAspectRatio=\"xMidYMid meet\"\n                shapeRendering=\"crispedges\"\n                className={styles.svg}\n            >\n                {/* Background first */}\n                <rect\n                    x={0}\n                    y={0}\n                    width={svgWidth}\n                    height={svgHeight}\n                    className={styles.background}\n                />\n                {/* Chart elements (without background) */}\n                {generateSVG(workoutData, userProfile, showMetrics)}\n                {/* Header elements on top */}\n                {generateWorkoutHeader(workoutData, userProfile, showMetrics)}\n            </svg>\n        </div>\n    );\n};\n\nexport default WorkoutChart;","import React, { useState, useEffect } from 'react';\nimport { WorkoutSelection, BasketState } from '../types/scenario';\nimport { calculateCombinedMetrics, formatDuration } from '../utils/scenarioHelpers';\nimport { generateOptimalSelections, convertToWorkoutSelections, SortedWorkout } from '../utils/optimalSelections';\nimport knighthoodWorkouts from '../data/knighthood-workouts.json';\nimport allWorkouts from '../data/workouts.json';\nimport { calculateAllTrainingMetrics } from '../utils/trainingMetrics';\nimport { getWorkoutData } from '../data/workout-data';\nimport { WorkoutData } from '../types/workout';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { getTargetIntensity } from '../utils/targetIntensityUtils';\nimport { getBestWorkoutData } from '../utils/workoutDataHelpers';\nimport { useViewport } from '../hooks/useViewport';\nimport WorkoutChart from './WorkoutChart';\nimport styles from './WorkoutSelector.module.css';\n\ninterface WorkoutSelectorProps {\n    onBasketChange: (basket: BasketState) => void;\n    initialBasket?: WorkoutSelection[];\n    userProfile: UserPowerProfile;\n    onSaveScenario?: () => void;\n    editingScenario?: any;\n    onCancelEdit?: () => void;\n}\n\ninterface WorkoutRow {\n    id: string;\n    name: string;\n    workoutData?: WorkoutData | null;\n    metrics: {\n        duration: number;\n        tss: number;\n        intensityFactor: number;\n        normalizedPower: number;\n    } | null;\n    error?: string;\n    isSelected: boolean;\n    usedOutdoorData?: boolean;\n}\n\nconst WorkoutSelector: React.FC<WorkoutSelectorProps> = ({ \n    onBasketChange, \n    initialBasket = [],\n    userProfile,\n    onSaveScenario,\n    editingScenario,\n    onCancelEdit\n}) => {\n    const viewport = useViewport();\n    const [workoutRows, setWorkoutRows] = useState<WorkoutRow[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [basket, setBasket] = useState<WorkoutSelection[]>(initialBasket);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [sortBy, setSortBy] = useState<'name' | 'duration' | 'tss' | 'if'>('name');\n    const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');\n    const [optimalSelections, setOptimalSelections] = useState<any>(null);\n    const [showFloatingSave, setShowFloatingSave] = useState(false);\n    \n    const searchInputRef = React.useRef<HTMLInputElement>(null);\n\n    const MAX_WORKOUTS = 10;\n\n    const findWorkoutTitle = (contentId: string): string => {\n        const workout = allWorkouts.data.library.content.find((item: any) => item.id === contentId);\n        return workout?.name || 'Unknown Workout';\n    };\n\n    const loadWorkoutData = async (workoutId: string): Promise<{ data: WorkoutData | null; usedOutdoor: boolean }> => {\n        try {\n            const rawData = getWorkoutData(workoutId);\n            if (!rawData) {\n                throw new Error(`Workout data not found for ${workoutId}`);\n            }\n            const result = getBestWorkoutData(rawData);\n            return {\n                data: result.data,\n                usedOutdoor: result.usedOutdoor\n            };\n        } catch (error) {\n            console.error(`Error loading workout ${workoutId}:`, error);\n            return { data: null, usedOutdoor: false };\n        }\n    };\n\n    const handleSort = (column: 'name' | 'duration' | 'tss' | 'if') => {\n        if (sortBy === column) {\n            setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n        } else {\n            setSortBy(column);\n            setSortOrder('asc');\n        }\n    };\n\n    const getSortIcon = (column: string) => {\n        if (sortBy !== column) return '↕️';\n        return sortOrder === 'asc' ? '↑' : '↓';\n    };\n\n    useEffect(() => {\n        const loadAllWorkouts = async () => {\n            const rows: WorkoutRow[] = [];\n            const basketIds = new Set(basket.map(w => w.id));\n\n            for (const workout of knighthoodWorkouts.workouts) {\n                const title = findWorkoutTitle(workout.id);\n                const workoutResult = await loadWorkoutData(workout.id);\n                \n                let metrics = null;\n                if (workoutResult.data) {\n                    try {\n                        const calculatedMetrics = calculateAllTrainingMetrics(workoutResult.data, userProfile);\n                        metrics = {\n                            duration: calculatedMetrics.duration,\n                            tss: calculatedMetrics.trainingStressScore,\n                            intensityFactor: calculatedMetrics.intensityFactor,\n                            normalizedPower: calculatedMetrics.normalizedPower\n                        };\n                    } catch (error) {\n                        console.error(`Error calculating metrics for ${workout.id}:`, error);\n                    }\n                }\n\n                rows.push({\n                    id: workout.id,\n                    name: title,\n                    workoutData: workoutResult.data,\n                    metrics,\n                    error: !workoutResult.data ? 'Workout data not available' : undefined,\n                    isSelected: basketIds.has(workout.id),\n                    usedOutdoorData: workoutResult.usedOutdoor\n                });\n            }\n\n            setWorkoutRows(rows);\n            setLoading(false);\n\n            // Generate optimal selections for quick picks\n            const sortedWorkouts: SortedWorkout[] = rows\n                .filter(row => row.metrics)\n                .map(row => ({\n                    id: row.id,\n                    name: row.name,\n                    tss: row.metrics!.tss,\n                    duration: row.metrics!.duration,\n                    intensityFactor: row.metrics!.intensityFactor,\n                    normalizedPower: row.metrics!.normalizedPower\n                }));\n\n            const optimal = generateOptimalSelections(sortedWorkouts);\n            setOptimalSelections(optimal);\n        };\n\n        loadAllWorkouts();\n    }, [basket]);\n\n    // Scroll detection for floating save button on mobile\n    useEffect(() => {\n        if (!viewport.isMobile) return;\n\n        const handleScroll = () => {\n            if (searchInputRef.current) {\n                const searchRect = searchInputRef.current.getBoundingClientRect();\n                const isSearchVisible = searchRect.bottom > 0;\n                \n                // Show floating button when search is scrolled out of view and basket is complete\n                setShowFloatingSave(!isSearchVisible && basket.length === MAX_WORKOUTS);\n            }\n        };\n\n        window.addEventListener('scroll', handleScroll);\n        handleScroll(); // Initial check\n\n        return () => {\n            window.removeEventListener('scroll', handleScroll);\n        };\n    }, [viewport.isMobile, basket.length, MAX_WORKOUTS]);\n\n    const toggleWorkoutSelection = (workoutId: string) => {\n        const workout = workoutRows.find(w => w.id === workoutId);\n        if (!workout) return;\n\n        const isCurrentlySelected = basket.some(w => w.id === workoutId);\n        \n        if (isCurrentlySelected) {\n            // Remove from basket\n            const newBasket = basket.filter(w => w.id !== workoutId);\n            setBasket(newBasket);\n            onBasketChange({\n                selectedWorkouts: newBasket,\n                isComplete: newBasket.length === MAX_WORKOUTS\n            });\n        } else {\n            // Add to basket (if not full)\n            if (basket.length < MAX_WORKOUTS && workout.metrics) {\n                const newWorkout: WorkoutSelection = {\n                    id: workout.id,\n                    name: workout.name,\n                    metrics: workout.metrics\n                };\n                const newBasket = [...basket, newWorkout];\n                setBasket(newBasket);\n                onBasketChange({\n                    selectedWorkouts: newBasket,\n                    isComplete: newBasket.length === MAX_WORKOUTS\n                });\n            }\n        }\n    };\n\n    const clearBasket = () => {\n        setBasket([]);\n        onBasketChange({\n            selectedWorkouts: [],\n            isComplete: false\n        });\n    };\n\n    const randomKnighthoodQuest = () => {\n        // First clear all selections\n        setBasket([]);\n        \n        // Get all workouts with valid metrics (excluding those with errors)\n        const validWorkouts = workoutRows.filter(workout => \n            workout.metrics && !workout.error\n        );\n        \n        // Randomly shuffle and select 10 workouts\n        const shuffled = [...validWorkouts].sort(() => Math.random() - 0.5);\n        const selectedWorkouts = shuffled.slice(0, Math.min(10, shuffled.length));\n        \n        // Convert to WorkoutSelection format\n        const newBasket: WorkoutSelection[] = selectedWorkouts.map(workout => ({\n            id: workout.id,\n            name: workout.name,\n            metrics: workout.metrics!,\n            usedOutdoorData: workout.usedOutdoorData || false\n        }));\n        \n        setBasket(newBasket);\n        onBasketChange({\n            selectedWorkouts: newBasket,\n            isComplete: newBasket.length === MAX_WORKOUTS\n        });\n    };\n\n    const filteredWorkouts = workoutRows.filter(workout => \n        workout.name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    const sortedWorkouts = [...filteredWorkouts].sort((a, b) => {\n        let aValue, bValue;\n        \n        switch (sortBy) {\n            case 'name':\n                aValue = a.name;\n                bValue = b.name;\n                break;\n            case 'duration':\n                aValue = a.metrics?.duration || 0;\n                bValue = b.metrics?.duration || 0;\n                break;\n            case 'tss':\n                aValue = a.metrics?.tss || 0;\n                bValue = b.metrics?.tss || 0;\n                break;\n            case 'if':\n                aValue = a.metrics?.intensityFactor || 0;\n                bValue = b.metrics?.intensityFactor || 0;\n                break;\n            default:\n                return 0;\n        }\n        \n        if (typeof aValue === 'string') {\n            return sortOrder === 'asc' \n                ? aValue.localeCompare(bValue as string)\n                : (bValue as string).localeCompare(aValue);\n        } else {\n            return sortOrder === 'asc' \n                ? (aValue as number) - (bValue as number)\n                : (bValue as number) - (aValue as number);\n        }\n    });\n\n    const combinedMetrics = calculateCombinedMetrics(basket);\n    \n    // Calculate target intensity metrics using centralized utility\n    const targetIntensityValue = getTargetIntensity(userProfile);\n    const targetIntensity = targetIntensityValue / 100;\n    const baseTSS = isNaN(combinedMetrics.totalTSS) ? 0 : combinedMetrics.totalTSS;\n    const baseIF = isNaN(combinedMetrics.averageIF) ? 0 : combinedMetrics.averageIF;\n    const baseNP = isNaN(combinedMetrics.totalNP) ? 0 : combinedMetrics.totalNP;\n    \n    const targetMetrics = {\n        totalTargetTSS: isNaN(baseTSS * targetIntensity) ? 0 : baseTSS * targetIntensity,\n        averageTargetIF: isNaN(baseIF * targetIntensity) ? 0 : baseIF * targetIntensity,\n        totalTargetNP: isNaN(baseNP * targetIntensity) ? 0 : baseNP * targetIntensity\n    };\n\n    if (loading) {\n        return (\n            <div className={styles.loadingContainer}>\n                <h2 className={styles.loadingTitle}>Loading workouts...</h2>\n            </div>\n        );\n    }\n\n    // Mobile card layout\n    const renderMobileLayout = () => (\n        <div className={styles.containerMobile}>\n            {/* Header Section */}\n            <div className={styles.headerMobile}>\n                <h1 className={styles.titleMobile}>\n                    Plan Your Assault on the Castle\n                </h1>\n                <p className={styles.subtitleMobile}>\n                    Assemble 10 instruments of Suffering for your siezing of the highest HONOUR in Sufferlandria\n                </p>\n\n                {/* Quick Selection Options - Mobile */}\n                {optimalSelections && (\n                    <div className={styles.quickSelectionMobile}>\n                        <div className={styles.quickSelectionTitle}>\n                            PATHS TO KNIGHTHOOD (Choose your destiny):\n                        </div>\n                        <div className={styles.quickSelectionGrid}>\n                            <button\n                                onClick={() => {\n                                    const selections = convertToWorkoutSelections(optimalSelections.lowestTSS);\n                                    setBasket(selections);\n                                    onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                                }}\n                                className={`${styles.quickSelectionButton} ${styles.pathMerciful}`}\n                                title=\"For those new to SUFFERING\"\n                            >\n                                🏃‍♂️ Merciful Path\n                            </button>\n                            <button\n                                onClick={() => {\n                                    const selections = convertToWorkoutSelections(optimalSelections.shortestDuration);\n                                    setBasket(selections);\n                                    onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                                }}\n                                className={`${styles.quickSelectionButton} ${styles.pathSwift}`}\n                                title=\"Get it over with quickly\"\n                            >\n                                ⚡ Swift Strike\n                            </button>\n                            <button\n                                onClick={() => {\n                                    const selections = convertToWorkoutSelections(optimalSelections.lowestIF);\n                                    setBasket(selections);\n                                    onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                                }}\n                                className={`${styles.quickSelectionButton} ${styles.pathGentle}`}\n                                title=\"Less pain, more endurance\"\n                            >\n                                💚 Gentle Suffering\n                            </button>\n                            <button\n                                onClick={() => {\n                                    const selections = convertToWorkoutSelections(optimalSelections.balanced);\n                                    setBasket(selections);\n                                    onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                                }}\n                                className={`${styles.quickSelectionButton} ${styles.pathBalanced}`}\n                                title=\"The way GvA intended\"\n                            >\n                                ⚖️ True Sufferlandrian\n                            </button>\n                            <button\n                                onClick={() => {\n                                    const selections = convertToWorkoutSelections(optimalSelections.highestTSS);\n                                    setBasket(selections);\n                                    onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                                }}\n                                className={`${styles.quickSelectionButton} ${styles.pathMaxSuffering}`}\n                                title=\"Please see a doctor first\"\n                            >\n                                🔥 Path of MAXIMUM SUFFERING\n                            </button>\n                            <button\n                                onClick={() => {\n                                    const selections = convertToWorkoutSelections(optimalSelections.longestDuration);\n                                    setBasket(selections);\n                                    onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                                }}\n                                className={`${styles.quickSelectionButton} ${styles.pathEndurance}`}\n                                title=\"Test your mental fortitude\"\n                            >\n                                ⏰ Epic Endurance\n                            </button>\n                            <button\n                                onClick={randomKnighthoodQuest}\n                                className={`${styles.quickSelectionButton} ${styles.pathChaos}`}\n                                title=\"Let fate decide your suffering\"\n                            >\n                                🎲 Trial by Chaos\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n                {/* Basket Summary - Mobile */}\n                <div className={`${styles.basketSummaryMobile} ${\n                    basket.length === MAX_WORKOUTS ? styles.basketSummaryComplete : styles.basketSummaryIncomplete\n                }`}>\n                    <div className={styles.basketSummaryHeader}>\n                        <h3 className={styles.basketTitle}>\n                            Arsenal of SUFFERING ({basket.length}/{MAX_WORKOUTS})\n                        </h3>\n                        {basket.length === MAX_WORKOUTS && (\n                            <>\n                                <div className={styles.basketCompleteMessage}>\n                                    ⚔️ Ready for KNIGHTHOOD! The Ministry of Madness awaits your Suffering!\n                                </div>\n                                {onSaveScenario && (\n                                    <button\n                                        data-testid=\"save-scenario-button\"\n                                        onClick={onSaveScenario}\n                                        className={`${styles.saveButton} ${styles.saveButtonMobile} ${\n                                            editingScenario ? styles.saveButtonEditMargin : styles.saveButtonNormalMargin\n                                        }`}\n                                    >\n                                        {editingScenario ? 'Update Scenario' : 'Save Scenario'}\n                                    </button>\n                                )}\n                            </>\n                        )}\n                        {editingScenario && onCancelEdit && (\n                            <button\n                                onClick={onCancelEdit}\n                                id=\"cancel-edit-button\"\n                                data-testid=\"cancel-edit-button\"\n                                className={`${styles.cancelButton} ${styles.cancelButtonMobile}`}\n                            >\n                                Cancel Edit\n                            </button>\n                        )}\n                        {basket.length > 0 && (\n                            <button\n                                onClick={clearBasket}\n                                className={styles.clearAllButton}\n                                id=\"clear-basket-button\"\n                            >\n                                Clear All ({basket.length})\n                            </button>\n                        )}\n                    </div>\n                </div>\n                \n                {/* Search and Sort Controls */}\n                <div className={styles.searchSortContainer}>\n                    <input\n                        ref={searchInputRef}\n                        data-testid=\"workout-search\"\n                        type=\"text\"\n                        placeholder=\"Search workouts...\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                        className={styles.searchInput}\n                    />\n                    \n                    <div className={styles.sortContainer}>\n                        <span className={styles.sortLabel}>Sort:</span>\n                        {(['name', 'duration', 'tss', 'if'] as const).map(col => (\n                            <button\n                                key={col}\n                                onClick={() => handleSort(col)}\n                                className={`${styles.sortButton} ${\n                                    sortBy === col ? styles.sortButtonActive : styles.sortButtonInactive\n                                }`}\n                            >\n                                {col === 'name' ? 'Name' : \n                                 col === 'duration' ? 'Duration' :\n                                 col === 'tss' ? 'TSS®' : 'IF®'}\n                                {sortBy === col && getSortIcon(col)}\n                            </button>\n                        ))}\n                    </div>\n                </div>\n\n                {/* Workout Cards */}\n                <div className={styles.workoutCardsContainer}>\n                    {sortedWorkouts.map((row, index) => {\n                        const isSelected = row.isSelected;\n                        const canSelect = !isSelected && basket.length < MAX_WORKOUTS && row.metrics;\n                        const canDeselect = isSelected;\n                        const isClickable = canSelect || canDeselect;\n\n                        return (\n                            <div \n                                key={row.id}\n                                onClick={() => isClickable ? toggleWorkoutSelection(row.id) : undefined}\n                                className={`${styles.workoutCard} ${\n                                    isSelected ? styles.workoutCardSelected : ''\n                                } ${\n                                    !row.metrics ? styles.workoutCardDisabled : ''\n                                } ${\n                                    isClickable ? styles.workoutCardClickable : styles.workoutCardNotClickable\n                                }`}\n                            >\n                                {/* Selection Indicator */}\n                                <div \n                                    data-testid={`workout-checkbox-${row.id}`} \n                                    className={`${styles.workoutCheckbox} ${\n                                        isSelected ? styles.workoutCheckboxSelected : ''\n                                    }`}\n                                >\n                                    {isSelected && <span className={styles.workoutCheckboxIcon}>✓</span>}\n                                </div>\n\n                                {/* Workout Header */}\n                                <div className={styles.workoutHeader}>\n                                    <div className={styles.workoutNameContainer}>\n                                        <strong className={styles.workoutName}>\n                                            {row.name}\n                                        </strong>\n                                        {row.usedOutdoorData && (\n                                            <span \n                                                className={styles.workoutOutdoorIcon}\n                                                title=\"Using outdoor power profile data\"\n                                            >\n                                                ⚠️\n                                            </span>\n                                        )}\n                                    </div>\n                                    <div className={styles.workoutId}>\n                                        ID: {row.id}\n                                    </div>\n                                </div>\n\n                                {/* Metrics Grid */}\n                                {row.metrics && (\n                                    <div className={styles.workoutMetricsGrid}>\n                                        <div className={styles.workoutMetricItem}>\n                                            <div className={`${styles.workoutMetricLabel} ${styles.metricDuration}`}>Duration</div>\n                                            <div className={styles.workoutMetricValue}>\n                                                {formatDuration(row.metrics.duration)}\n                                            </div>\n                                        </div>\n                                        <div className={styles.workoutMetricItem}>\n                                            <div className={`${styles.workoutMetricLabel} ${styles.metricTss}`}>TSS®</div>\n                                            <div className={styles.workoutMetricValue}>\n                                                {Math.round(row.metrics.tss)}\n                                            </div>\n                                        </div>\n                                        <div className={styles.workoutMetricItem}>\n                                            <div className={`${styles.workoutMetricLabel} ${styles.metricIf}`}>IF®</div>\n                                            <div className={styles.workoutMetricValue}>\n                                                {row.metrics.intensityFactor.toFixed(2)}\n                                            </div>\n                                        </div>\n                                        <div className={styles.workoutMetricItem}>\n                                            <div className={`${styles.workoutMetricLabel} ${styles.metricNp}`}>NP®</div>\n                                            <div className={styles.workoutMetricValue}>\n                                                {Math.round(row.metrics.normalizedPower)}W\n                                            </div>\n                                        </div>\n                                    </div>\n                                )}\n\n                                {/* Workout Profile Chart */}\n                                {row.workoutData && row.metrics && (\n                                    <div className={styles.workoutChartContainer}>\n                                        <WorkoutChart\n                                            workoutData={row.workoutData}\n                                            userProfile={userProfile}\n                                            height={60}\n                                        />\n                                    </div>\n                                )}\n\n                                {!row.metrics && (\n                                    <div className={styles.workoutErrorMessage}>\n                                        {row.error || 'No workout data available'}\n                                    </div>\n                                )}\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n            \n            {/* Floating Save Button */}\n            {showFloatingSave && onSaveScenario && (\n                <div className={styles.floatingSaveContainer}>\n                    <button\n                        data-testid=\"floating-save-scenario-button\"\n                        onClick={onSaveScenario}\n                        className={styles.floatingSaveButton}\n                    >\n                        💾 {editingScenario ? 'Update Scenario' : 'Save Scenario'}\n                    </button>\n                    {editingScenario && onCancelEdit && (\n                        <button\n                            onClick={onCancelEdit}\n                            id=\"cancel-edit-button\"\n                            data-testid=\"cancel-edit-button\"\n                            className={styles.floatingCancelButton}\n                        >\n                            Cancel\n                        </button>\n                    )}\n                </div>\n            )}\n        </div>\n    );\n\n    return viewport.isMobile ? renderMobileLayout() : (\n        <div className={styles.desktopContainer}>\n            {/* Header Section */}\n            <div className={styles.desktopHeader}>\n                <div className={styles.desktopHeaderInner}>\n                    <h1 className={styles.desktopTitle}>\n                        Plan Your Assault on the Castle\n                    </h1>\n                    <p className={styles.desktopSubtitle}>\n                        Assemble 10 instruments of SUFFERING for your siezing of the highest HONOUR in Sufferlandria\n                    </p>\n                </div>\n            </div>\n\n            {/* Quick Selection Options */}\n            {optimalSelections && (\n                <div className={styles.quickSelectionDesktop}>\n                    <div className={styles.quickSelectionTitleDesktop}>\n                        PATHS TO KNIGHTHOOD (Choose your destiny of SUFFERING):\n                    </div>\n                    <div className={styles.quickSelectionButtonsDesktop}>\n                        <button\n                            onClick={() => {\n                                const selections = convertToWorkoutSelections(optimalSelections.lowestTSS);\n                                setBasket(selections);\n                                onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                            }}\n                            className={`${styles.quickSelectionButtonDesktop} ${styles.pathMercifulDesktop}`}\n                            title=\"For those new to SUFFERING\"\n                        >\n                            🏃‍♂️ Merciful Path\n                        </button>\n                        <button\n                            onClick={() => {\n                                const selections = convertToWorkoutSelections(optimalSelections.shortestDuration);\n                                setBasket(selections);\n                                onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                            }}\n                            className={`${styles.quickSelectionButtonDesktop} ${styles.pathSwiftDesktop}`}\n                            title=\"Get it over with quickly\"\n                        >\n                            ⚡ Swift Strike\n                        </button>\n                        <button\n                            onClick={() => {\n                                const selections = convertToWorkoutSelections(optimalSelections.lowestIF);\n                                setBasket(selections);\n                                onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                            }}\n                            className={`${styles.quickSelectionButtonDesktop} ${styles.pathGentleDesktop}`}\n                            title=\"Less pain, more endurance\"\n                        >\n                            💚 Gentle Suffering\n                        </button>\n                        <button\n                            onClick={() => {\n                                const selections = convertToWorkoutSelections(optimalSelections.balanced);\n                                setBasket(selections);\n                                onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                            }}\n                            className={`${styles.quickSelectionButtonDesktop} ${styles.pathBalancedDesktop}`}\n                            title=\"The way GvA intended\"\n                        >\n                            ⚖️ True Sufferlandrian\n                        </button>\n                        <button\n                            onClick={() => {\n                                const selections = convertToWorkoutSelections(optimalSelections.highestTSS);\n                                setBasket(selections);\n                                onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                            }}\n                            className={`${styles.quickSelectionButtonDesktop} ${styles.pathMaximumDesktop}`}\n                            title=\"Please see a doctor first\"\n                        >\n                            🔥 Path of MAXIMUM SUFFERING\n                        </button>\n                        <button\n                            onClick={() => {\n                                const selections = convertToWorkoutSelections(optimalSelections.longestDuration);\n                                setBasket(selections);\n                                onBasketChange({ selectedWorkouts: selections, isComplete: true });\n                            }}\n                            className={`${styles.quickSelectionButtonDesktop} ${styles.pathEnduranceDesktop}`}\n                            title=\"Test your mental fortitude\"\n                        >\n                            ⏰ Epic Endurance\n                        </button>\n                        <button\n                            onClick={randomKnighthoodQuest}\n                            className={`${styles.quickSelectionButtonDesktop} ${styles.pathChaosDesktop}`}\n                            title=\"Let fate decide your suffering\"\n                        >\n                            🎲 Trial by Chaos\n                        </button>\n                    </div>\n                </div>\n            )}\n\n            {/* Sticky Controls Container */}\n            <div className={styles.desktopControlsSticky}> ho\n                <div className={styles.desktopControlsContainer}>\n                    {/* Basket Summary */}\n                    {basket.length > 0 && (\n                        <div className={`${styles.basketSummaryWrapper}`}>  \n                            <div className={`${styles.basketSummaryDesktop} ${\n                                basket.length === MAX_WORKOUTS ? styles.basketSummaryDesktopComplete : ''\n                            }`}>\n                            <div className={styles.basketSummaryDesktopHeader}>\n                                <div>\n                                    <h3 className={styles.basketSummaryDesktopTitle}>\n                                        Your Arsenal of SUFFERING ({basket.length}/{MAX_WORKOUTS})\n                                    </h3>\n                                    {basket.length === MAX_WORKOUTS && (\n                                        <div className={styles.basketCompleteMessage}>\n                                            ⚔️ Ready for KNIGHTHOOD! The Ministry of Madness acknowledges your commitment to SUFFERING!\n                                        </div>\n                                    )}\n                                    {onSaveScenario && (\n                                        <div className={styles.desktopSaveButtonContainer}>\n                                            <button\n                                                onClick={clearBasket}\n                                                className={`${styles.clearBasketButton}`}\n                                                id=\"clear-basket-button\"\n                                            >\n                                                Clear All\n                                            </button>\n                                            <button\n                                                data-testid=\"save-scenario-button\"\n                                                onClick={basket.length === MAX_WORKOUTS ? onSaveScenario : undefined}\n                                                className={`${styles.saveButton} ${MAX_WORKOUTS > basket.length ? styles.saveBasketButtonDisabled : ''}`}\n                                            >\n                                                {editingScenario ? 'Update Scenario' : 'Save Scenario'}\n                                            </button>\n                                            {editingScenario && onCancelEdit && (\n                                                <button\n                                                    onClick={onCancelEdit}\n                                                    id=\"cancel-edit-button\"\n                                                    data-testid=\"cancel-edit-button\"\n                                                    className={styles.cancelButton}\n                                                >\n                                                    Cancel Edit\n                                                </button>\n                                            )}\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                            \n                            <div className={styles.basketMetricsGrid}>\n                                <div className={`${styles.metricCard} ${styles.metricCardDuration}`}>\n                                    <div className={`${styles.metricLabel} ${styles.colorDuration}`}>Workout Duration</div>\n                                    <div className={styles.metricValue}>\n                                        {formatDuration(combinedMetrics.totalDuration)}\n                                    </div>\n                                </div>\n                                <div className={`${styles.metricCard} ${styles.metricCardElapsed}`}>\n                                    <div className={`${styles.metricLabel} ${styles.colorElapsed}`}>Elapsed Duration</div>\n                                    <div className={styles.metricValue}>\n                                        {formatDuration(combinedMetrics.totalElapsedDuration)}\n                                    </div>\n                                    <div className={styles.metricSubtext}>\n                                        +{Math.max(0, basket.length - 1) * 10}min rest\n                                    </div>\n                                </div>\n                                <div className={`${styles.metricCard} ${styles.metricCardTss}`}>\n                                    <div className={`${styles.metricLabel} ${styles.colorTss}`}>\n                                        TSS® ({targetIntensityValue}%)\n                                    </div>\n                                    <div className={styles.metricValue}>\n                                        {Math.round(combinedMetrics.totalTSS)} ({Math.round(targetMetrics.totalTargetTSS)})\n                                    </div>\n                                </div>\n                                <div className={`${styles.metricCard} ${styles.metricCardIf}`}>\n                                    <div className={`${styles.metricLabel} ${styles.colorIf}`}>\n                                        Avg IF® ({targetIntensityValue}%)\n                                    </div>\n                                    <div className={styles.metricValue}>\n                                        {combinedMetrics.averageIF.toFixed(2)} ({targetMetrics.averageTargetIF.toFixed(2)})\n                                    </div>\n                                </div>\n                                <div className={`${styles.metricCard} ${styles.metricCardNp}`}>\n                                    <div className={`${styles.metricLabel} ${styles.colorNp}`}>\n                                        Avg NP® ({targetIntensityValue}%)\n                                    </div>\n                                    <div className={styles.metricValue}>\n                                        {Math.round(combinedMetrics.totalNP)}W ({Math.round(targetMetrics.totalTargetNP)}W)\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    )}\n\n                    {/* Controls */}\n                    <div className={styles.searchControlsDesktop}>\n                        <div className={styles.searchLabelDesktop}>\n                            SEARCH & FILTER:\n                        </div>\n                        <input\n                            type=\"text\"\n                            data-testid=\"workout-search\"\n                            placeholder=\"Search workouts...\"\n                            value={searchTerm}\n                            onChange={(e) => setSearchTerm(e.target.value)}\n                            className={styles.searchInputDesktop}\n                        />\n                    \n                        <select\n                            value={sortBy}\n                            onChange={(e) => setSortBy(e.target.value as any)}\n                            className={styles.sortSelectDesktop}\n                        >\n                            <option value=\"name\">Sort by Name</option>\n                            <option value=\"duration\">Sort by Duration</option>\n                            <option value=\"tss\">Sort by TSS</option>\n                            <option value=\"if\">Sort by IF</option>\n                        </select>\n                        \n                        <button\n                            onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')}\n                            className={styles.sortOrderButtonDesktop}\n                        >\n                            {sortOrder === 'asc' ? '↑' : '↓'}\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            {/* Scrollable Content Area */}\n            <div className={styles.desktopContentArea}>\n                <div className={styles.desktopContentWrapper}>\n                    {/* Workout List */}\n                    <div className={styles.tableScrollContainer}>\n                        <table className={styles.workoutTable}>\n                        <thead>\n                            <tr className={styles.tableHeaderRow}>\n                                <th className={`${styles.tableHeader} ${styles.selectColumn}`}>\n                                    Select\n                                </th>\n                                <th \n                                    className={`${styles.tableHeader} ${styles.sortableColumn} ${styles.workoutColumn}`}\n                                    onClick={() => handleSort('name')}\n                                >\n                                    Workout {getSortIcon('name')}\n                                </th>\n                                <th \n                                    className={`${styles.tableHeader} ${styles.sortableColumn} ${styles.centerColumn}`}\n                                    onClick={() => handleSort('duration')}\n                                >\n                                    Duration {getSortIcon('duration')}\n                                </th>\n                                <th \n                                    className={`${styles.tableHeader} ${styles.sortableColumn} ${styles.centerColumn}`}\n                                    onClick={() => handleSort('tss')}\n                                >\n                                    TSS® {getSortIcon('tss')}\n                                </th>\n                                <th \n                                    className={`${styles.tableHeader} ${styles.sortableColumn} ${styles.centerColumn}`}\n                                    onClick={() => handleSort('if')}\n                                >\n                                    IF® {getSortIcon('if')}\n                                </th>\n                                <th className={`${styles.tableHeader} ${styles.centerColumn}`}>\n                                    NP®\n                                </th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            {sortedWorkouts.map((row, index) => {\n                                const isSelected = row.isSelected;\n                                const canSelect = !isSelected && basket.length < MAX_WORKOUTS && row.metrics;\n                                const canDeselect = isSelected;\n                                \n                                return (\n                                    <tr \n                                        key={row.id}\n                                        onClick={(e) => {\n                                            // Only trigger selection if clicking outside of interactive elements\n                                            const target = e.target as HTMLElement;\n                                            if (!target.closest('input') && !target.closest('a')) {\n                                                toggleWorkoutSelection(row.id);\n                                            }\n                                        }}\n                                        className={`${styles.tableRow} ${isSelected ? styles.selectedRow : (index % 2 === 0 ? styles.evenRow : styles.oddRow)} ${!row.metrics ? styles.disabledRow : ''} ${(canSelect || canDeselect) ? styles.selectableRow : styles.nonSelectableRow}`}\n                                    >\n                                        <td className={`${styles.tableCell} ${styles.checkboxCell}`}>\n                                            <input\n                                                data-testid={`workout-checkbox-${row.id}`}\n                                                type=\"checkbox\"\n                                                checked={isSelected}\n                                                onChange={() => toggleWorkoutSelection(row.id)}\n                                                disabled={!canSelect && !canDeselect}\n                                                className={`${styles.workoutCheckboxDesktop} ${(canSelect || canDeselect) ? styles.enabledCheckbox : styles.disabledCheckbox}`}\n                                            />\n                                        </td>\n                                        <td className={styles.tableCell}>\n                                            <div>\n                                                {/* Workout Details Container - Description and Chart side by side */}\n                                                <div className={styles.workoutDescriptionFlexItem}>\n                                                    <div className={styles.workoutNameCell}>\n                                                        <span className={styles.workoutName}>{row.name}</span>\n                                                        {row.usedOutdoorData && (\n                                                            <span \n                                                                className={styles.outdoorDataWarning}\n                                                                title=\"Indoor power profile data unavailable, using outdoor power profile.\"\n                                                            >\n                                                                ⚠️\n                                                            </span>\n                                                        )}\n                                                        <a \n                                                            href={`https://systm.wahoofitness.com/content-details/${row.id}`}\n                                                            target=\"_blank\"\n                                                            rel=\"noopener noreferrer\"\n                                                            className={styles.workoutLink}\n                                                            title={`View ${row.name} on SYSTM`}\n                                                        >\n                                                            ↗\n                                                        </a>\n                                                    </div>\n                                                    \n                                                    {/* Workout Profile Chart */}\n                                                    {row.workoutData && row.metrics && (\n                                                        <div className={styles.workoutChartContainerFlexItem}>\n                                                            <WorkoutChart\n                                                                workoutData={row.workoutData}\n                                                                userProfile={userProfile}\n                                                                height={60}\n                                                            />\n                                                        </div>\n                                                    )}\n                                                </div>\n                                            </div>\n                                        </td>\n                                        <td className={`${styles.tableCell} ${styles.centerColumn}`}>\n                                            <span className={styles.workoutMetric}>\n                                                {row.metrics ? formatDuration(row.metrics.duration) : 'N/A'}\n                                            </span>\n                                        </td>\n                                        <td className={`${styles.tableCell} ${styles.centerColumn}`}>\n                                            <span className={styles.workoutMetric}>\n                                                {row.metrics ? Math.round(row.metrics.tss) : 'N/A'}\n                                            </span>\n                                        </td>\n                                        <td className={`${styles.tableCell} ${styles.centerColumn}`}>\n                                            <span className={styles.workoutMetric}>\n                                                {row.metrics ? row.metrics.intensityFactor.toFixed(2) : 'N/A'}\n                                            </span>\n                                        </td>\n                                        <td className={`${styles.tableCell} ${styles.centerColumn}`}>\n                                            <span className={styles.workoutMetric}>\n                                                {row.metrics ? Math.round(row.metrics.normalizedPower) : 'N/A'}\n                                                <span className={styles.metricSuffix}>{row.metrics ? 'W' : ''}</span>\n                                            </span>\n                                        </td>\n                                    </tr>\n                                );\n                            })}\n                        </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n    );\n};\n\nexport default WorkoutSelector;","/* Print-specific styles for PrintQuestModal */\n\nexport const printStyles = `\n    @page { \n        margin: 1in; \n    }\n    \n    body { \n        font-family: Arial, sans-serif; \n        font-size: 12px; \n        line-height: 1.4; \n        color: #333;\n    }\n    \n    .header { \n        text-align: center; \n        border-bottom: 2px solid #333; \n        padding-bottom: 10px; \n        margin-bottom: 20px; \n    }\n    \n    .title { \n        font-size: 18px; \n        font-weight: bold; \n        margin: 0 0 5px 0; \n    }\n    \n    .subtitle { \n        font-size: 14px; \n        color: #666; \n        margin: 0 0 10px 0; \n    }\n    \n    .summary { \n        background: #f5f5f5; \n        padding: 10px; \n        margin-bottom: 20px; \n        border-radius: 5px; \n    }\n    \n    .summary-row { \n        display: flex; \n        justify-content: flex-end; \n        margin: 3px 0; \n        gap: 10px;\n    }\n    \n    .summary-label {\n        min-width: 160px;\n        text-align: right;\n    }\n    \n    .summary-value {\n        font-weight: bold;\n        min-width: 300px;\n        text-align: right;\n    }\n    \n    table { \n        width: 100%; \n        border-collapse: collapse; \n        margin-bottom: 20px; \n    }\n    \n    th, td { \n        border: 1px solid #ddd; \n        padding: 8px; \n    }\n\n    td { \n        text-align: left; \n    }\n    \n    th { \n        background-color: #f2f2f2; \n        font-weight: bold; \n        font-size: 11px; \n        text-align: center;\n    }\n    \n    .th-number { width: 8%; }\n    .th-start { width: 10%; }\n    .th-end { width: 10%; }\n    .th-workout { width: 32%; text-align: left; }\n    .th-duration { width: 8%; }\n    .th-tss { width: 8%; }\n    .th-if { width: 8%; }\n    .th-np { width: 8%; }\n    \n    .workout-row { \n        background-color: #fff; \n    }\n    \n    .break-row { \n        background-color: #f9f9f9; \n        font-style: italic; \n    }\n    \n    .center { \n        text-align: center; \n    }\n    \n    .bold { \n        font-weight: bold; \n    }\n    \n    .notes { \n        margin-top: 20px; \n        font-size: 11px; \n        color: #666; \n    }\n`;","import React, { useState, useEffect } from 'react';\nimport { Scenario } from '../types/scenario';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { formatDuration } from '../utils/scenarioHelpers';\nimport styles from './PrintQuestModal.module.css';\nimport { printStyles } from './PrintQuestModal.print';\nimport { getTargetIntensity, formatTargetIntensity } from '../utils/targetIntensityUtils';\n\ninterface PrintQuestModalProps {\n    scenario: Scenario;\n    userProfile: UserPowerProfile;\n    onClose: () => void;\n}\n\nconst PrintQuestModal: React.FC<PrintQuestModalProps> = ({ scenario, userProfile, onClose }) => {\n    console.log('PrintQuestModal rendered!', { scenario: scenario.name, viewport: window.innerWidth });\n    \n    const [startTime, setStartTime] = useState(() => {\n        // Default to current time\n        const now = new Date();\n        return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;\n    });\n\n    interface ScheduleItem {\n        type: 'workout' | 'break';\n        index?: number;\n        name?: string;\n        id?: string;\n        startTime: Date;\n        endTime: Date;\n        duration: number;\n        tss?: number;\n        intensityFactor?: number;\n        normalizedPower?: number;\n    }\n\n    const calculateSchedule = (): ScheduleItem[] => {\n        const [hours, minutes] = startTime.split(':').map(Number);\n        const startDate = new Date();\n        startDate.setHours(hours, minutes, 0, 0);\n\n        let currentTime = new Date(startDate);\n        const schedule: ScheduleItem[] = [];\n\n        scenario.workouts.forEach((workout, index) => {\n            const workoutStartTime = new Date(currentTime);\n            \n            // Add workout duration\n            const durationMinutes = workout.metrics ? Math.ceil(workout.metrics.duration / 60) : 60;\n            const workoutEndTime = new Date(currentTime.getTime() + (durationMinutes * 60 * 1000));\n            \n            schedule.push({\n                type: 'workout',\n                index: index + 1,\n                name: workout.name,\n                id: workout.id,\n                startTime: workoutStartTime,\n                endTime: workoutEndTime,\n                duration: durationMinutes,\n                tss: workout.metrics?.tss || 0,\n                intensityFactor: workout.metrics?.intensityFactor || 0,\n                normalizedPower: workout.metrics?.normalizedPower || 0\n            });\n\n            // Move to end of workout\n            currentTime = new Date(workoutEndTime);\n\n            // Add 10-minute break (except after last workout)\n            if (index < scenario.workouts.length - 1) {\n                const breakEndTime = new Date(currentTime.getTime() + (10 * 60 * 1000));\n                schedule.push({\n                    type: 'break',\n                    startTime: new Date(currentTime),\n                    endTime: breakEndTime,\n                    duration: 10\n                });\n                currentTime = breakEndTime;\n            }\n        });\n\n        return schedule;\n    };\n\n    const handlePrint = () => {\n        const schedule = calculateSchedule();\n        const intensityScaleFactor = getTargetIntensity(userProfile) / 100;\n        const totalTSS = scenario.workouts.reduce((sum, w) => sum + (w.metrics?.tss || 0), 0);\n        const scaledTotalTSS = totalTSS * intensityScaleFactor;\n        const totalDuration = scenario.workouts.reduce((sum, w) => sum + (w.metrics?.duration || 0), 0);\n        const avgIF = scenario.workouts.reduce((sum, w) => sum + (w.metrics?.intensityFactor || 0), 0) / scenario.workouts.length;\n        const scaledAvgIF = avgIF * intensityScaleFactor;\n        \n        const printContent = `\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>Knight of Sufferlandria Quest Plan - ${scenario.name}</title>\n                <style>${printStyles}</style>\n            </head>\n            <body>\n                <div class=\"header\">\n                    <div class=\"title\">⚔️ ASSAULT ON THE CASTLE ⚔️</div>\n                    <div class=\"subtitle\">Knight of Sufferlandria Quest Plan</div>\n                    <div><strong>${scenario.name}</strong></div>\n                    <div>Created: ${new Date(scenario.createdAt).toLocaleDateString()}</div>\n                </div>\n\n                <div class=\"summary\">\n                    <div class=\"summary-row\">\n                        <span class=\"summary-label\"><strong>Total Quest Duration:</strong></span>\n                        <span class=\"summary-value\">${formatDuration(totalDuration)}</span>\n                    </div>\n                    <div class=\"summary-row\">\n                        <span class=\"summary-label\"><strong>Total Elapsed Time:</strong></span>\n                        <span class=\"summary-value\">${formatDuration(totalDuration + (scenario.workouts.length - 1) * 10 * 60)} (including breaks)</span>\n                    </div>\n                    <div class=\"summary-row\">\n                        <span class=\"summary-label\"><strong>Total TSS® (${formatTargetIntensity(userProfile)} intensity):</strong></span>\n                        <span class=\"summary-value\">${Math.round(scaledTotalTSS)}</span>\n                    </div>\n                    <div class=\"summary-row\">\n                        <span class=\"summary-label\"><strong>Average IF® (${formatTargetIntensity(userProfile)} intensity):</strong></span>\n                        <span class=\"summary-value\">${scaledAvgIF.toFixed(2)}</span>\n                    </div>\n                    <div class=\"summary-row\">\n                        <span class=\"summary-label\"><strong>100% Power Profile:</strong></span>\n                        <span class=\"summary-value\">FTP: ${userProfile.ftp}W, AC: ${userProfile.ac}W, NM: ${userProfile.nm}W, MAP: ${userProfile.map}W</span>\n                    </div>\n                </div>\n\n                <table>\n                    <thead>\n                        <tr>\n                            <th class=\"th-number\">#</th>\n                            <th class=\"th-start\">Start</th>\n                            <th class=\"th-end\">End</th>\n                            <th class=\"th-workout\">Workout / Break</th>\n                            <th class=\"th-duration\">Duration</th>\n                            <th class=\"th-tss\">TSS® (${formatTargetIntensity(userProfile)})</th>\n                            <th class=\"th-if\">IF® (${formatTargetIntensity(userProfile)})</th>\n                            <th class=\"th-np\">NP® (${formatTargetIntensity(userProfile)})</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${schedule.map((item, index) => {\n                            if (item.type === 'workout') {\n                                return `\n                                    <tr class=\"workout-row\">\n                                        <td class=\"center bold\">${item.index}</td>\n                                        <td class=\"center\">${item.startTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>\n                                        <td class=\"center\">${item.endTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>\n                                        <td><strong>${item.name}</strong></td>\n                                        <td class=\"center\">${item.duration}min</td>\n                                        <td class=\"center\">${Math.round((item.tss || 0) * intensityScaleFactor)}</td>\n                                        <td class=\"center\">${((item.intensityFactor || 0) * intensityScaleFactor).toFixed(2)}</td>\n                                        <td class=\"center\">${Math.round((item.normalizedPower || 0) * intensityScaleFactor)}W</td>\n                                    </tr>\n                                `;\n                            } else {\n                                return `\n                                    <tr class=\"break-row\">\n                                        <td class=\"center\">-</td>\n                                        <td class=\"center\">${item.startTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>\n                                        <td class=\"center\">${item.endTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>\n                                        <td class=\"center\">~~ Rest Break ~~</td>\n                                        <td class=\"center\">${item.duration}min</td>\n                                        <td class=\"center\">-</td>\n                                        <td class=\"center\">-</td>\n                                        <td class=\"center\">-</td>\n                                    </tr>\n                                `;\n                            }\n                        }).join('')}\n                    </tbody>\n                </table>\n\n                <div class=\"notes\">\n                    <p><strong>Quest Rules (from the Ministry of Madness):</strong></p>\n                    <ul>\n                        <li>You must complete all 10 workouts back-to-back in the order listed above</li>\n                        <li>Maximum 10 minutes rest between workouts - no more, but less is fine</li>\n                        <li>All workouts must be completed in your Bicycle Torture Chamber (BTC)</li>\n                        <li>No workout may be repeated or substituted during the quest</li>\n                        <li>Upon completion, you must submit your ride to the Ministry of Madness for official KNIGHTHOOD recognition</li>\n                    </ul>\n                    <p><strong>Nutrition Strategy:</strong> Plan your fueling carefully - this is a long siege on the castle! Prepare adequate hydration and nutrition for ${Math.ceil(totalDuration / 3600)} hours of SUFFERING.</p>\n                    <p><strong>May you find GLORY in your SUFFERING!</strong> - The Ministry of Madness</p>\n                </div>\n            </body>\n            </html>\n        `;\n\n        const printWindow = window.open('', '_blank');\n        if (printWindow) {\n            printWindow.document.write(printContent);\n            printWindow.document.close();\n            printWindow.focus();\n            setTimeout(() => {\n                printWindow.print();\n            }, 250);\n        }\n    };\n\n    // Disable body scroll when modal is open\n    useEffect(() => {\n        const originalStyle = window.getComputedStyle(document.body).overflow;\n        document.body.style.overflow = 'hidden';\n        return () => {\n            document.body.style.overflow = originalStyle;\n        };\n    }, []);\n\n    return (\n        <>\n            <div \n                className={styles.modalOverlay}\n                onClick={(e) => {\n                    if (e.target === e.currentTarget) {\n                        onClose();\n                    }\n                }}\n            >\n                <div \n                    className={styles.modalContainer}\n                    onClick={(e) => e.stopPropagation()}\n                >\n                    <h2 className={styles.modalTitle}>\n                        🖨️ Print Quest Schedule\n                    </h2>\n                    \n                    <div className={styles.modalContent}>\n                        <p className={styles.modalDescription}>\n                            Generate a print-friendly assault plan for \"<strong>{scenario.name}</strong>\"\n                        </p>\n                    \n                        <div className={styles.timeInputSection}>\n                            <label className={styles.timeInputLabel}>\n                                Quest Start Time:\n                            </label>\n                            <input\n                                type=\"time\"\n                                value={startTime}\n                                onChange={(e) => setStartTime(e.target.value)}\n                                className={styles.timeInput}\n                            />\n                        </div>\n                    \n                        <div className={styles.infoBox}>\n                            <p className={styles.infoText}>\n                                📋 <strong>Your quest plan will include:</strong><br />\n                                • Complete schedule with start/end times<br />\n                                • 10-minute breaks between workouts<br />\n                                • Workout metrics (TSS®, IF®, NP®)<br />\n                                • Official rules from the Ministry of Madness\n                            </p>\n                        </div>\n                    </div>\n\n                    <div className={styles.buttonSection}>\n                        <button\n                            onClick={onClose}\n                            className={styles.cancelButton}\n                        >\n                            Cancel\n                        </button>\n                        <button\n                            onClick={() => {\n                                handlePrint();\n                                onClose();\n                            }}\n                            className={styles.printButton}\n                        >\n                            🖨️ Print Quest Plan\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </>\n    );\n};\n\nexport default PrintQuestModal;","import React, { useEffect, useState } from 'react';\nimport {\n    Chart as ChartJS,\n    CategoryScale,\n    LinearScale,\n    PointElement,\n    LineElement,\n    BarElement,\n    BarController,\n    ArcElement,\n    Title,\n    Tooltip,\n    Legend,\n    ChartOptions,\n    ChartData\n} from 'chart.js';\nimport { Line, Bar, Pie } from 'react-chartjs-2';\nimport { Scenario } from '../types/scenario';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { getWorkoutData } from '../data/workout-data';\nimport { getBestWorkoutData } from '../utils/workoutDataHelpers';\nimport { WorkoutData } from '../types/workout';\nimport styles from './ScenarioComparison.module.css';\nimport { getTargetIntensity } from '../utils/targetIntensityUtils';\n\n// Register Chart.js components\nChartJS.register(\n    CategoryScale,\n    LinearScale,\n    PointElement,\n    LineElement,\n    BarElement,\n    BarController,\n    ArcElement,\n    Title,\n    Tooltip,\n    Legend\n);\n\ninterface ScenarioComparisonProps {\n    scenarios: Scenario[];\n    userProfile: UserPowerProfile;\n    onClearSelection?: () => void;\n    singleScenarioView?: boolean; // When true, shows reduced height charts and pie chart for power zones\n}\n\ninterface PowerDataPoint {\n    time: number; // in seconds\n    power: number; // normalized power\n}\n\ninterface ScenarioPowerProfile {\n    scenario: Scenario;\n    powerData: PowerDataPoint[];\n    totalDuration: number;\n    color: string;\n}\n\nconst BUCKET_SIZE_MINUTES = 30;\nconst BUCKET_SIZE_SECONDS = BUCKET_SIZE_MINUTES * 60;\n\n// Power zones definition (as % of FTP)\nconst POWER_ZONES = [\n    { name: 'Recovery', min: 0, max: 55, color: '#b3c6ff' },\n    { name: 'Endurance', min: 55, max: 75, color: '#a3e1a3' },\n    { name: 'Tempo', min: 75, max: 90, color: '#ffe066' },\n    { name: 'Threshold', min: 90, max: 105, color: '#ffb366' },\n    { name: 'VO2max', min: 105, max: 120, color: '#ff6666' },\n    { name: 'Anaerobic', min: 120, max: 200, color: '#c266ff' }\n];\n\n// Generate distinct colors for each scenario\nconst CHART_COLORS = [\n    '#FF6384', // Red\n    '#36A2EB', // Blue\n    '#FFCE56', // Yellow\n    '#4BC0C0', // Teal\n    '#9966FF', // Purple\n    '#FF9F40', // Orange\n    '#FF6384', // Pink (repeat start)\n    '#C9CBCF'  // Grey\n];\n\nconst ScenarioComparison: React.FC<ScenarioComparisonProps> = ({\n    scenarios,\n    userProfile,\n    onClearSelection,\n    singleScenarioView = false\n}) => {\n    const [scenarioPowerProfiles, setScenarioPowerProfiles] = useState<ScenarioPowerProfile[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState<string | null>(null);\n    const [customIntensity, setCustomIntensity] = useState(getTargetIntensity(userProfile));\n\n    // Reset custom intensity when user profile changes\n    useEffect(() => {\n        setCustomIntensity(getTargetIntensity(userProfile));\n    }, [userProfile]);\n\n    useEffect(() => {\n        const calculatePowerProfiles = async () => {\n            setLoading(true);\n            setError(null);\n            \n            try {\n                const profiles: ScenarioPowerProfile[] = [];\n                const effectiveIntensity = customIntensity;\n                \n                for (let i = 0; i < scenarios.length; i++) {\n                    const scenario = scenarios[i];\n                    const color = CHART_COLORS[i % CHART_COLORS.length];\n                    \n                    const powerProfile = await calculateScenarioPowerProfile(scenario, userProfile, effectiveIntensity);\n                    profiles.push({\n                        scenario,\n                        powerData: powerProfile.powerData,\n                        totalDuration: powerProfile.totalDuration,\n                        color\n                    });\n                }\n                \n                setScenarioPowerProfiles(profiles);\n            } catch (err) {\n                setError('Failed to calculate power profiles');\n                console.error('Error calculating power profiles:', err);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        calculatePowerProfiles();\n    }, [scenarios, userProfile, customIntensity]);\n\n    const calculateScenarioPowerProfile = async (scenario: Scenario, profile: UserPowerProfile, effectiveIntensity: number) => {\n        const allPowerData: PowerDataPoint[] = [];\n        let currentTime = 0;\n\n        for (const workout of scenario.workouts) {\n            try {\n                const rawData = getWorkoutData(workout.id);\n                if (!rawData) continue;\n                \n                const { data } = getBestWorkoutData(rawData);\n                if (!data) continue;\n\n                const workoutPowerData = extractNormalizedPowerData(data, profile, currentTime, effectiveIntensity);\n                allPowerData.push(...workoutPowerData.powerData);\n                currentTime += workoutPowerData.duration;\n            } catch (error) {\n                console.error(`Error processing workout ${workout.id}:`, error);\n                // Continue with other workouts\n            }\n        }\n\n        // Bucket the power data into time segments\n        const bucketedData = bucketPowerData(allPowerData, BUCKET_SIZE_SECONDS);\n        \n        return {\n            powerData: bucketedData,\n            totalDuration: currentTime\n        };\n    };\n\n    const extractNormalizedPowerData = (workoutData: WorkoutData, profile: UserPowerProfile, startTime: number, effectiveIntensity: number) => {\n        // Interpolate to a regular 1-second time series\n        let totalDuration = 0;\n        const regularPower: number[] = [];\n        if (workoutData.time && workoutData.value && workoutData.time.length > 0) {\n            // Build a map of time to value\n            const timeArr = workoutData.time;\n            const valueArr = workoutData.value;\n            totalDuration = timeArr[timeArr.length - 1];\n            let lastValue = valueArr[0];\n            let nextIdx = 1;\n            for (let t = 0; t <= totalDuration; t++) {\n                // Find the closest time/value\n                if (nextIdx < timeArr.length && t >= timeArr[nextIdx]) {\n                    lastValue = valueArr[nextIdx];\n                    nextIdx++;\n                }\n                // Apply intensity adjustment when calculating absolute power\n                const adjustedPower = lastValue * profile.ftp * (effectiveIntensity / 100);\n                regularPower.push(adjustedPower);\n            }\n        } else {\n            totalDuration = 3600;\n            for (let t = 0; t <= totalDuration; t++) {\n                const adjustedPower = 0.5 * profile.ftp * (effectiveIntensity / 100);\n                regularPower.push(adjustedPower);\n            }\n        }\n\n        // Calculate rolling 30s NP for each second\n        const npSeries: number[] = [];\n        for (let i = 0; i < regularPower.length; i++) {\n            // 30s window\n            const startIdx = Math.max(0, i - 29);\n            const window = regularPower.slice(startIdx, i + 1);\n            // NP formula: 4th root of mean of 4th powers\n            const mean4th = window.reduce((sum, p) => sum + Math.pow(p, 4), 0) / window.length;\n            const np = Math.pow(mean4th, 0.25);\n            npSeries.push(np);\n        }\n\n        // Return as PowerDataPoint[] (time in seconds, power as % FTP)\n        const powerData: PowerDataPoint[] = npSeries.map((np, i) => ({\n            time: startTime + i,\n            power: (np / profile.ftp) * 100\n        }));\n\n        return { powerData, duration: totalDuration };\n    };\n\n    const bucketPowerData = (powerData: PowerDataPoint[], bucketSize: number): PowerDataPoint[] => {\n        if (powerData.length === 0) return [];\n        \n        const buckets: { [key: number]: number[] } = {};\n        \n        powerData.forEach(point => {\n            const bucketIndex = Math.floor(point.time / bucketSize);\n            if (!buckets[bucketIndex]) {\n                buckets[bucketIndex] = [];\n            }\n            buckets[bucketIndex].push(point.power);\n        });\n        \n        // Calculate average power for each bucket\n        return Object.keys(buckets)\n            .map(Number)\n            .sort((a, b) => a - b)\n            .map(bucketIndex => ({\n                time: bucketIndex * bucketSize,\n                power: buckets[bucketIndex].reduce((sum, p) => sum + p, 0) / buckets[bucketIndex].length\n            }));\n    };\n\n    const formatTime = (seconds: number): string => {\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        \n        if (hours > 0) {\n            return `${hours}h ${minutes.toString().padStart(2, '0')}m`;\n        }\n        return `${minutes}m`;\n    };\n\n    const formatDuration = (seconds: number): string => {\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        \n        if (hours > 0) {\n            return `${hours}:${minutes.toString().padStart(2, '0')}:00`;\n        }\n        return `${minutes.toString().padStart(2, '0')}:00`;\n    };\n\n    // Prepare chart data\n    const chartData: ChartData<'line'> = {\n        labels: [], // Will be filled dynamically\n        datasets: scenarioPowerProfiles.map(profile => {\n            // Convert time to minutes for x-axis\n            const dataPoints = profile.powerData.map(point => ({\n                x: point.time / 60, // Convert to minutes\n                y: point.power\n            }));\n            \n            return {\n                label: profile.scenario.name,\n                data: dataPoints,\n                borderColor: profile.color,\n                backgroundColor: profile.color + '20', // 20% opacity\n                borderWidth: 2,\n                fill: false,\n                pointRadius: 0, // Hide individual points for cleaner look\n                pointHoverRadius: 4,\n                tension: 0.1 // Slight curve for smoother lines\n            };\n        })\n    };\n\n\n\n    const chartOptions: ChartOptions<'line'> = {\n        responsive: true,\n        maintainAspectRatio: false,\n        aspectRatio: 2.2, // less wide\n        scales: {\n            x: {\n                type: 'linear',\n                title: {\n                    display: true,\n                    text: `Time (${BUCKET_SIZE_MINUTES} min intervals)`\n                },\n                ticks: {\n                    callback: function(value) {\n                        return formatTime((value as number) * 60);\n                    }\n                }\n            },\n            y: {\n                title: {\n                    display: true,\n                    text: 'Normalized Power (% of FTP)'\n                },\n                ticks: {\n                    callback: function(value) {\n                        return `${value}%`;\n                    }\n                },\n                beginAtZero: false,\n                min: Math.floor(Math.min(...scenarioPowerProfiles.flatMap(p => p.powerData.map(d => d.power))) * 0.95),\n                max: Math.ceil(Math.max(...scenarioPowerProfiles.flatMap(p => p.powerData.map(d => d.power))) * 1.05)\n            }\n        },\n        plugins: {\n            title: {\n                display: true,\n                text: 'Normalized Power Profile Comparison',\n                font: {\n                    size: 16,\n                    weight: 'bold'\n                }\n            },\n            tooltip: {\n                mode: 'index',\n                intersect: false,\n                callbacks: {\n                    title: function(tooltipItems) {\n                        const minutes = tooltipItems[0].parsed.x ?? 0;\n                        return `Time: ${formatTime(minutes * 60)}`;\n                    },\n                    label: function(context) {\n                        const yValue = context.parsed.y ?? 0;\n                        return `${context.dataset.label}: ${Math.round(yValue)}% FTP`;\n                    }\n                }\n            },\n            legend: {\n                position: 'top' as const,\n                align: 'start' as const\n            }\n        },\n        interaction: {\n            mode: 'index' as const,\n            intersect: false\n        }\n    };\n\n    // Calculate cumulative TSS over time for each scenario\n    const cumulativeTSSData = scenarios.map((scenario: Scenario, scenarioIndex: number) => {\n        let cumulativeTSS = 0;\n        let currentTime = 0;\n        const tssPoints: { time: number; tss: number }[] = [];\n        \n        scenario.workouts.forEach((workout: any) => {\n            const rawData = getWorkoutData(workout.id);\n            if (!rawData) return;\n            const { data } = getBestWorkoutData(rawData);\n            if (!data || !data.value || !data.time) return;\n            \n            // Calculate TSS for this workout\n            let workoutTSS = 0;\n            const duration = data.time[data.time.length - 1]; // workout duration in seconds\n            \n            // Calculate normalized power for the workout\n            const powers = data.value.map((v: number) => {\n                // Apply intensity adjustment when calculating absolute power\n                const adjustedPower = v * userProfile.ftp * (customIntensity / 100);\n                return adjustedPower;\n            });\n            let totalNP4 = 0;\n            let count = 0;\n            \n            // Rolling 30s NP calculation\n            for (let i = 0; i < powers.length; i++) {\n                const startIdx = Math.max(0, i - 29);\n                const window = powers.slice(startIdx, i + 1);\n                const mean4th = window.reduce((sum: number, p: number) => sum + Math.pow(p, 4), 0) / window.length;\n                const np = Math.pow(mean4th, 0.25);\n                totalNP4 += Math.pow(np, 4);\n                count++;\n            }\n            \n            const workoutNP = count > 0 ? Math.pow(totalNP4 / count, 0.25) : 0;\n            const intensityFactor = workoutNP / userProfile.ftp;\n            \n            // TSS = (duration in hours) × (IF^2) × 100\n            workoutTSS = (duration / 3600) * Math.pow(intensityFactor, 2) * 100;\n            cumulativeTSS += workoutTSS;\n            \n            // Add data points throughout the workout for smooth curve\n            const timeStep = Math.max(1, Math.floor(duration / 20)); // 20 points per workout\n            for (let t = 0; t <= duration; t += timeStep) {\n                const progressTSS = cumulativeTSS - workoutTSS + (workoutTSS * t / duration);\n                tssPoints.push({\n                    time: (currentTime + t) / 60, // Convert to minutes\n                    tss: progressTSS\n                });\n            }\n            \n            currentTime += duration;\n        });\n        \n        return {\n            scenario,\n            data: tssPoints,\n            color: CHART_COLORS[scenarioIndex % CHART_COLORS.length],\n            finalTSS: cumulativeTSS\n        };\n    });\n\n    // Prepare cumulative TSS chart data as bar chart\n    const tssChartData = {\n        labels: cumulativeTSSData.map(profile => profile.scenario.name),\n        datasets: [{\n            label: 'Total TSS',\n            data: cumulativeTSSData.map(profile => Math.round(profile.finalTSS)),\n            backgroundColor: cumulativeTSSData.map(profile => profile.color),\n            borderColor: cumulativeTSSData.map(profile => profile.color),\n            borderWidth: 1\n        }]\n    };\n\n    const tssChartOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n            legend: { position: 'top' as const },\n            title: {\n                display: true,\n                text: 'Total Training Stress Score (TSS) Comparison',\n                font: { size: 16, weight: 'bold' as const }\n            }\n        },\n        scales: {\n            x: {\n                title: { \n                    display: true, \n                    text: 'Scenarios' \n                },\n                ticks: {\n                    maxRotation: 45,\n                    minRotation: 0\n                }\n            },\n            y: {\n                beginAtZero: true,\n                title: { \n                    display: true, \n                    text: 'Total TSS' \n                },\n                ticks: {\n                    callback: function(value: any) {\n                        return Math.round(value);\n                    }\n                }\n            }\n        }\n    };\n\n    // Calculate effective intensity for zone calculations\n    const effectiveIntensity = customIntensity;\n\n    // Calculate power zone distribution using raw workout data\n    const zoneDistributions = scenarios.map((scenario: Scenario) => {\n        // Track time (in seconds) spent in each zone\n        const zoneTimes = POWER_ZONES.map(() => 0);\n        \n        // Gather all raw power values with their time intervals from scenario workouts\n        scenario.workouts.forEach((workout: any) => {\n            const rawData = getWorkoutData(workout.id);\n            if (!rawData) return;\n            const { data } = getBestWorkoutData(rawData);\n            if (!data || !data.value || !data.time) return;\n            \n            // Process each power value with its actual time interval\n            for (let i = 0; i < data.value.length && i < data.time.length; i++) {\n                let percentFTP = data.value[i] * 100; // Convert from decimal (0.5 = 50%, 1.0 = 100%)\n                \n                // Apply intensity adjustment - makes efforts appear easier relative to original FTP zones\n                percentFTP = percentFTP * (effectiveIntensity / 100);\n                \n                // Calculate the duration of this interval\n                let intervalDuration = 0;\n                if (i < data.time.length - 1) {\n                    // Duration is the difference between this time and the next\n                    intervalDuration = data.time[i + 1] - data.time[i];\n                } else {\n                    // For the last interval, assume 1 second duration\n                    intervalDuration = 1;\n                }\n                \n                // Find which zone this power value belongs to and add the time interval\n                for (let j = 0; j < POWER_ZONES.length; j++) {\n                    if (percentFTP >= POWER_ZONES[j].min && percentFTP < POWER_ZONES[j].max) {\n                        zoneTimes[j] += intervalDuration;\n                        break;\n                    }\n                }\n            }\n        });\n        \n        // Convert seconds to minutes\n        return zoneTimes.map(seconds => seconds / 60);\n    });\n\n    // Prepare zone chart data for grouped bar chart\n    const zoneChartData = {\n        labels: POWER_ZONES.map(zone => zone.name),\n        datasets: scenarios.map((scenario: Scenario, idx: number) => ({\n            label: scenario.name,\n            data: zoneDistributions[idx],\n            backgroundColor: CHART_COLORS[idx % CHART_COLORS.length],\n            borderColor: CHART_COLORS[idx % CHART_COLORS.length],\n            borderWidth: 1\n        }))\n    };\n\n    const zoneChartOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n            legend: { position: 'top' as const },\n            title: {\n                display: true,\n                text: 'Power Zone Distribution (Minutes)',\n                font: { size: 16, weight: 'bold' as const }\n            }\n        },\n        scales: {\n            x: { \n                stacked: false,\n                title: { display: true, text: 'Power Zones' },\n                ticks: {\n                    maxRotation: 45,\n                    minRotation: 0\n                }\n            },\n            y: {\n                beginAtZero: true,\n                title: { display: true, text: 'Time in Zone (minutes)' },\n                ticks: {\n                    callback: function(value: any) {\n                        return `${Math.round(value * 10) / 10}m`;\n                    }\n                }\n            }\n        }\n    };\n\n    // Prepare pie chart data for single scenario view\n    const zonePieChartData = singleScenarioView && scenarios.length === 1 ? {\n        labels: POWER_ZONES.map(zone => zone.name),\n        datasets: [{\n            label: 'Time in Zone',\n            data: zoneDistributions[0], // Only first scenario for single view\n            backgroundColor: [\n                '#22c55e', // Recovery - green\n                '#3b82f6', // Endurance - blue  \n                '#f59e0b', // Tempo - orange\n                '#ef4444', // Threshold - red\n                '#8b5cf6', // VO2max - purple\n                '#ec4899'  // Anaerobic - pink\n            ],\n            borderWidth: 2,\n            borderColor: '#ffffff'\n        }]\n    } : null;\n\n    const zonePieChartOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n            legend: { \n                position: 'right' as const,\n                labels: {\n                    generateLabels: function(chart: any) {\n                        const data = chart.data;\n                        if (data.labels.length && data.datasets.length) {\n                            return data.labels.map((label: string, i: number) => {\n                                const value = data.datasets[0].data[i];\n                                return {\n                                    text: `${label}: ${Math.round(value * 10) / 10}m`,\n                                    fillStyle: data.datasets[0].backgroundColor[i],\n                                    strokeStyle: data.datasets[0].borderColor,\n                                    lineWidth: data.datasets[0].borderWidth,\n                                    fontColor: '#eaeaea',\n                                    index: i\n                                };\n                            });\n                        }\n                        return [];\n                    }\n                }\n            },\n            title: {\n                display: true,\n                text: 'Power Zone Distribution',\n                font: { size: 16, weight: 'bold' as const }\n            },\n            tooltip: {\n                callbacks: {\n                    label: function(context: any) {\n                        const label = context.label || '';\n                        const value = Math.round(context.raw * 10) / 10;\n                        const total = context.dataset.data.reduce((a: number, b: number) => a + b, 0);\n                        const percentage = Math.round((context.raw / total) * 100);\n                        return `${label}: ${value}m (${percentage}%)`;\n                    }\n                }\n            }\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className={styles.comparisonSection}>\n                <div className={styles.comparisonHeader}>\n                    <h3 className={styles.comparisonTitle}>\n                        Power Profile Analysis\n                    </h3>\n                    {onClearSelection && (\n                        <button onClick={onClearSelection} className={styles.clearSelectionButton}>\n                            Clear Selection\n                        </button>\n                    )}\n                </div>\n                <div className={styles.loadingContainer}>\n                    <div className={styles.loadingText}>\n                        📊 Analyzing power profiles...\n                    </div>\n                    <div className={styles.loadingSubtext}>\n                        Processing workout data and calculating normalized power curves\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    if (error) {\n        return (\n            <div className={styles.comparisonSection}>\n                <div className={styles.comparisonHeader}>\n                    <h3 className={styles.comparisonTitle}>\n                        Power Profile Analysis\n                    </h3>\n                    {onClearSelection && (\n                        <button onClick={onClearSelection} className={styles.clearSelectionButton}>\n                            Clear Selection\n                        </button>\n                    )}\n                </div>\n                <div className={styles.errorContainer}>\n                    <div className={styles.errorText}>❌ {error}</div>\n                    <div className={styles.errorSubtext}>\n                        Unable to generate power profile comparison\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className={styles.comparisonSection}>\n            <div className={styles.comparisonHeader}>\n                <h3 className={styles.comparisonTitle}>\n                    Power Profile Analysis - {scenarios.length} Scenario{scenarios.length > 1 ? 's' : ''}\n                </h3>\n                <div className={styles.headerControls}>\n                    <div className={styles.intensitySliderContainer}>\n                        <label className={styles.sliderLabel}>\n                            Training Intensity: {customIntensity}%\n                        </label>\n                        <input\n                            type=\"range\"\n                            min=\"50\"\n                            max=\"120\"\n                            step=\"1\"\n                            value={customIntensity}\n                            onChange={(e) => setCustomIntensity(Number(e.target.value))}\n                            className={styles.intensitySlider}\n                        />\n                    </div>\n                    \n                    {onClearSelection && (\n                        <button onClick={onClearSelection} className={styles.clearSelectionButton}>\n                            Clear Selection\n                        </button>\n                    )}\n                </div>\n            </div>\n            \n            {singleScenarioView ? (\n                // View Scenario Layout\n                <>\n                    {/* Row 1: Normalized Power and Power Zone side by side */}\n                    <div className={styles.chartsRow}>\n                        {/* First Half: Normalized Power Profile */}\n                        <div className={`${styles.chartContainerHalf} ${styles.chartContainerHalfReduced}`}>\n                            <Line \n                                key={`chart-half-${scenarios.length}-${scenarioPowerProfiles.length}`}\n                                data={chartData} \n                                options={chartOptions} \n                            />\n                        </div>\n                        \n                        {/* Second Half: Power Zone Distribution */}\n                        <div className={`${styles.chartContainerHalf} ${styles.chartContainerHalfReduced}`}>\n                            {zonePieChartData ? (\n                                <Pie data={zonePieChartData} options={zonePieChartOptions} />\n                            ) : (\n                                <Bar data={zoneChartData} options={zoneChartOptions} />\n                            )}\n                        </div>\n                    </div>\n                </>\n            ) : (\n                // Scenario Comparison Layout\n                <>\n                    {/* Row 1: Full width Normalized Power Profile */}\n                    <div className={styles.chartContainer}>\n                        <Line \n                            key={`chart-${scenarios.length}-${scenarioPowerProfiles.length}`}\n                            data={chartData} \n                            options={chartOptions} \n                        />\n                    </div>\n                    \n                    {/* Row 2: TSS and Power Zone side by side */}\n                    <div className={styles.chartsRow}>\n                        {/* First Half: TSS comparison */}\n                        <div className={styles.chartContainerHalf}>\n                            <Bar data={tssChartData} options={tssChartOptions} />\n                        </div>\n                        \n                        {/* Second Half: Power Zone Distribution */}\n                        <div className={styles.chartContainerHalf}>\n                            <Bar data={zoneChartData} options={zoneChartOptions} />\n                        </div>\n                    </div>\n                </>\n            )}\n        </div>\n    );\n};\n\nexport default ScenarioComparison;","import React, { useState, useEffect, useRef } from 'react';\nimport { Scenario } from '../types/scenario';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { loadScenarios, saveScenarios, formatDuration, calculateCombinedMetricsDynamic } from '../utils/scenarioHelpers';\nimport { useViewport } from '../hooks/useViewport';\nimport PrintQuestModal from './PrintQuestModal';\nimport styles from './ScenarioManager.module.css';\nimport ScenarioComparison from './ScenarioComparison';\n\ninterface ScenarioManagerProps {\n    onEditScenario: (scenario: Scenario) => void;\n    onViewScenario?: (scenario: Scenario) => void;\n    onScenariosChange?: (scenarios: Scenario[]) => void;\n    userProfile: UserPowerProfile;\n}\n\ninterface ScenarioWithMetrics extends Scenario {\n    dynamicMetrics: {\n        totalDuration: number;\n        totalElapsedDuration: number;\n        totalTSS: number;\n        averageIF: number;\n        totalNP: number;\n    };\n}\n\nconst ScenarioManager: React.FC<ScenarioManagerProps> = ({ onEditScenario, onViewScenario, onScenariosChange, userProfile }) => {\n    const viewport = useViewport();\n    const comparisonSectionRef = useRef<HTMLDivElement>(null);\n    const [scenarios, setScenarios] = useState<Scenario[]>([]);\n    const [scenariosWithMetrics, setScenariosWithMetrics] = useState<ScenarioWithMetrics[]>([]);\n    const [isLoadingMetrics, setIsLoadingMetrics] = useState(false);\n    const [selectedScenarios, setSelectedScenarios] = useState<Set<string>>(new Set());\n    const [sortBy, setSortBy] = useState<'name' | 'created' | 'duration' | 'elapsed' | 'tss' | 'if'>('created');\n    const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\n    const [showPrintModal, setShowPrintModal] = useState<Scenario | null>(null);\n\n    useEffect(() => {\n        const loadScenariosWithDynamicMetrics = async () => {\n            setIsLoadingMetrics(true);\n            const savedScenarios = loadScenarios();\n            setScenarios(savedScenarios);\n            \n            // Calculate dynamic metrics for each scenario\n            const scenariosWithDynamics: ScenarioWithMetrics[] = [];\n            \n            for (const scenario of savedScenarios) {\n                try {\n                    const dynamicMetrics = await calculateCombinedMetricsDynamic(scenario.workouts, userProfile);\n                    scenariosWithDynamics.push({\n                        ...scenario,\n                        dynamicMetrics\n                    });\n                } catch (error) {\n                    console.error(`Failed to calculate metrics for scenario ${scenario.id}:`, error);\n                    // Use zero metrics as fallback\n                    scenariosWithDynamics.push({\n                        ...scenario,\n                        dynamicMetrics: {\n                            totalDuration: 0,\n                            totalElapsedDuration: 0,\n                            totalTSS: 0,\n                            averageIF: 0,\n                            totalNP: 0\n                        }\n                    });\n                }\n            }\n            \n            setScenariosWithMetrics(scenariosWithDynamics);\n            setIsLoadingMetrics(false);\n        };\n        \n        loadScenariosWithDynamicMetrics();\n    }, [userProfile]);\n\n    const handleSort = (column: 'name' | 'created' | 'duration' | 'elapsed' | 'tss' | 'if') => {\n        if (sortBy === column) {\n            setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n        } else {\n            setSortBy(column);\n            setSortOrder('asc');\n        }\n    };\n\n    const getSortIcon = (column: string) => {\n        if (sortBy !== column) return '↕️';\n        return sortOrder === 'asc' ? '↑' : '↓';\n    };\n\n    const deleteScenario = (scenarioId: string) => {\n        if (window.confirm('Are you sure you want to delete this scenario?')) {\n            const updatedScenarios = scenarios.filter(s => s.id !== scenarioId);\n            const updatedScenariosWithMetrics = scenariosWithMetrics.filter(s => s.id !== scenarioId);\n            \n            setScenarios(updatedScenarios);\n            setScenariosWithMetrics(updatedScenariosWithMetrics);\n            saveScenarios(updatedScenarios);\n            onScenariosChange?.(updatedScenarios);\n            setSelectedScenarios(prev => {\n                const newSet = new Set(prev);\n                newSet.delete(scenarioId);\n                return newSet;\n            });\n        }\n    };\n\n    const duplicateScenario = async (scenario: Scenario | ScenarioWithMetrics) => {\n        const duplicatedScenario: Scenario = {\n            id: `scenario_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,\n            name: `${scenario.name} (Copy)`,\n            createdAt: new Date().toISOString(),\n            workouts: scenario.workouts,\n            combinedMetrics: scenario.combinedMetrics\n        };\n        \n        const updatedScenarios = [...scenarios, duplicatedScenario];\n        setScenarios(updatedScenarios);\n        saveScenarios(updatedScenarios);\n        onScenariosChange?.(updatedScenarios);\n        \n        // Also calculate metrics for the duplicated scenario and update the metrics state\n        try {\n            const dynamicMetrics = await calculateCombinedMetricsDynamic(duplicatedScenario.workouts, userProfile);\n            const duplicatedScenarioWithMetrics: ScenarioWithMetrics = {\n                ...duplicatedScenario,\n                dynamicMetrics\n            };\n            \n            setScenariosWithMetrics(prev => [...prev, duplicatedScenarioWithMetrics]);\n        } catch (error) {\n            console.error('Error calculating metrics for duplicated scenario:', error);\n            // Fallback: add scenario with zero metrics\n            const duplicatedScenarioWithMetrics: ScenarioWithMetrics = {\n                ...duplicatedScenario,\n                dynamicMetrics: {\n                    totalDuration: 0,\n                    totalElapsedDuration: 0,\n                    totalTSS: 0,\n                    averageIF: 0,\n                    totalNP: 0\n                }\n            };\n            setScenariosWithMetrics(prev => [...prev, duplicatedScenarioWithMetrics]);\n        }\n    };\n\n    const shareScenario = (scenario: Scenario) => {\n        const workoutIds = scenario.workouts.map(w => w.id).join(',');\n        const shareUrl = `${window.location.origin}/knighthood-quests/share/?workouts=${workoutIds}&name=${encodeURIComponent(scenario.name)}`;\n        \n        // Copy to clipboard\n        navigator.clipboard.writeText(shareUrl).then(() => {\n            // Show temporary success message\n            alert(`Share link copied to clipboard!\\n\\nAnyone with this link can view and save \"${scenario.name}\" to their own scenarios.`);\n        }).catch(() => {\n            // Fallback: show the URL in a prompt for manual copying\n            prompt('Copy this link to share your scenario:', shareUrl);\n        });\n    };\n\n    const toggleScenarioSelection = (scenarioId: string) => {\n        setSelectedScenarios(prev => {\n            const newSet = new Set(prev);\n            if (newSet.has(scenarioId)) {\n                newSet.delete(scenarioId);\n            } else {\n                newSet.add(scenarioId);\n            }\n            return newSet;\n        });\n    };\n\n    const clearSelection = () => {\n        setSelectedScenarios(new Set());\n    };\n\n    const compareAll = () => {\n        const allScenarioIds = new Set(scenariosWithMetrics.map(s => s.id));\n        setSelectedScenarios(allScenarioIds);\n        \n        // Scroll to comparison section after a short delay to allow for rendering\n        setTimeout(() => {\n            if (comparisonSectionRef.current) {\n                comparisonSectionRef.current.scrollIntoView({ \n                    behavior: 'smooth', \n                    block: 'start'\n                });\n            }\n        }, 100);\n    };\n\n    const sortedScenarios = [...scenariosWithMetrics].sort((a, b) => {\n        let aValue, bValue;\n        \n        switch (sortBy) {\n            case 'name':\n                aValue = a.name;\n                bValue = b.name;\n                break;\n            case 'created':\n                aValue = new Date(a.createdAt).getTime();\n                bValue = new Date(b.createdAt).getTime();\n                break;\n            case 'duration':\n                aValue = a.dynamicMetrics.totalDuration;\n                bValue = b.dynamicMetrics.totalDuration;\n                break;\n            case 'elapsed':\n                aValue = a.dynamicMetrics.totalElapsedDuration;\n                bValue = b.dynamicMetrics.totalElapsedDuration;\n                break;\n            case 'tss':\n                aValue = a.dynamicMetrics.totalTSS;\n                bValue = b.dynamicMetrics.totalTSS;\n                break;\n            case 'if':\n                aValue = a.dynamicMetrics.averageIF;\n                bValue = b.dynamicMetrics.averageIF;\n                break;\n            default:\n                return 0;\n        }\n        \n        if (typeof aValue === 'string') {\n            return sortOrder === 'asc' \n                ? aValue.localeCompare(bValue as string)\n                : (bValue as string).localeCompare(aValue);\n        } else {\n            return sortOrder === 'asc' \n                ? (aValue as number) - (bValue as number)\n                : (bValue as number) - (aValue as number);\n        }\n    });\n\n    const selectedScenariosList = scenariosWithMetrics.filter(s => selectedScenarios.has(s.id));\n\n    // Mobile card layout\n    const renderMobileLayout = () => (\n        <div className={styles.containerMobile}>\n                <h1 className={styles.titleMobile}>\n                    My Paths to KNIGHTHOOD\n                </h1>\n                <p className={styles.subtitleMobile}>\n                    Manage your various quests and recipes for SUFFERING\n                </p>            {isLoadingMetrics && (\n                <div className={styles.loadingContainerMobile}>\n                    <div className={styles.loadingTextLarge}>\n                        📊 Calculating metrics...\n                    </div>\n                    <div className={styles.loadingTextSmall}>\n                        Loading workout data\n                    </div>\n                </div>\n            )}\n\n            {scenariosWithMetrics.length === 0 && !isLoadingMetrics ? (\n                <div className={styles.emptyStateMobile}>\n                    <div className={styles.emptyIcon}>🏆</div>\n                    <h3 className={styles.emptyTitle}>No Scenarios Yet</h3>\n                    <p className={styles.emptyDescription}>\n                        Create your first Knighthood challenge by selecting 10 workouts in the \"Plan Challenge\" tab.\n                    </p>\n                </div>\n            ) : (\n                <>\n                    {/* Sort Controls */}\n                    <div className={styles.controlsMobile}>\n                        <div className={styles.sortControls}>\n                            <span className={styles.sortLabel}>Sort:</span>\n                            {(['name', 'created', 'duration', 'tss'] as const).map(col => (\n                                <button\n                                    key={col}\n                                    onClick={() => handleSort(col)}\n                                    className={`${styles.sortButton} ${\n                                        sortBy === col ? styles.sortButtonActive : styles.sortButtonInactive\n                                    }`}\n                                >\n                                    {col === 'name' ? 'Name' : \n                                     col === 'created' ? 'Date' :\n                                     col === 'duration' ? 'Duration' : 'TSS®'}\n                                    {sortBy === col && getSortIcon(col)}\n                                </button>\n                            ))}\n                        </div>\n                        \n                        <button\n                            onClick={compareAll}\n                            className={styles.compareAllButtonMobile}\n                            disabled={scenariosWithMetrics.length === 0}\n                        >\n                            Compare All\n                        </button>\n                    </div>\n\n                    {/* Scenario Cards */}\n                    <div className={styles.scenarioListMobile}>\n                        {sortedScenarios.map((scenario, index) => (\n                            <div key={scenario.id} className={styles.scenarioCardMobile}>\n                                {/* Header */}\n                                <div className={styles.scenarioHeader}>\n                                    <div className={styles.scenarioHeaderLeft}>\n                                        <h3 className={styles.scenarioTitle}>\n                                            {scenario.name}\n                                        </h3>\n                                        <div className={styles.scenarioDate}>\n                                            Created: {new Date(scenario.createdAt).toLocaleDateString()}\n                                        </div>\n                                    </div>\n                                    <div className={styles.scenarioHeaderRight}>\n                                        <label className={styles.comparisonCheckboxMobile}>\n                                            <input\n                                                type=\"checkbox\"\n                                                checked={selectedScenarios.has(scenario.id)}\n                                                onChange={() => toggleScenarioSelection(scenario.id)}\n                                                className={styles.scenarioCheckboxMobile}\n                                            />\n                                            <span className={styles.comparisonLabelMobile}>Compare</span>\n                                        </label>\n                                    </div>\n                                </div>\n\n                                {/* Metrics Grid */}\n                                <div className={styles.metricsGrid}>\n                                    <div className={styles.metricItem}>\n                                        <div className={styles.metricLabelDuration}>Duration</div>\n                                        <div className={styles.metricValue}>\n                                            {formatDuration(scenario.dynamicMetrics.totalDuration)}\n                                        </div>\n                                    </div>\n                                    <div className={styles.metricItem}>\n                                        <div className={styles.metricLabelTSS}>TSS®</div>\n                                        <div className={styles.metricValue}>\n                                            {Math.round(scenario.dynamicMetrics.totalTSS)}\n                                        </div>\n                                    </div>\n                                    <div className={styles.metricItem}>\n                                        <div className={styles.metricLabelIF}>Avg IF®</div>\n                                        <div className={styles.metricValue}>\n                                            {scenario.dynamicMetrics.averageIF.toFixed(2)}\n                                        </div>\n                                    </div>\n                                    <div className={styles.metricItem}>\n                                        <div className={styles.metricLabelWorkouts}>Workouts</div>\n                                        <div className={styles.metricValue}>\n                                            {scenario.workouts.length}/10\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* Action Buttons */}\n                                <div className={styles.actionButtonsMobile}>\n                                    <button\n                                        data-testid={`view-scenario-${scenario.id}`}\n                                        onClick={() => onViewScenario?.(scenario)}\n                                        className={`${styles.actionButtonMobile} ${styles.viewButtonMobile}`}\n                                    >\n                                        👁️ View\n                                    </button>\n                                    <button\n                                        data-testid={`edit-scenario-${scenario.id}`}\n                                        onClick={() => onEditScenario(scenario)}\n                                        className={`${styles.actionButtonMobile} ${styles.editButtonMobile}`}\n                                    >\n                                        ✏️ Edit\n                                    </button>\n                                    <button\n                                        data-testid={`print-scenario-${scenario.id}`}\n                                        onClick={() => setShowPrintModal(scenario)}\n                                        className={`${styles.actionButtonMobile} ${styles.printButtonMobile}`}\n                                    >\n                                        🖨️ Print\n                                    </button>\n                                    <button\n                                        data-testid={`share-scenario-${scenario.id}`}\n                                        onClick={() => shareScenario(scenario)}\n                                        className={`${styles.actionButtonMobile} ${styles.shareButtonMobile}`}\n                                    >\n                                        🔗 Share\n                                    </button>\n                                    <button\n                                        data-testid={`duplicate-scenario-${scenario.id}`}\n                                        onClick={() => duplicateScenario(scenario)}\n                                        className={`${styles.actionButtonMobile} ${styles.duplicateButtonMobile}`}\n                                    >\n                                        📋 Copy\n                                    </button>\n                                    <button\n                                        data-testid={`delete-scenario-${scenario.id}`}\n                                        onClick={() => deleteScenario(scenario.id)}\n                                        className={`${styles.actionButtonMobile} ${styles.deleteButtonMobile}`}\n                                    >\n                                        🗑️ Delete\n                                    </button>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </>\n            )}\n\n            {/* Enhanced Comparison Section with Chart - Mobile */}\n            {selectedScenarios.size > 0 && (\n                <div ref={comparisonSectionRef}>\n                    {/* Chart-based comparison */}\n                    <ScenarioComparison\n                        scenarios={Array.from(selectedScenarios).map(id => \n                            scenariosWithMetrics.find(s => s.id === id)!\n                        )}\n                        userProfile={userProfile}\n                        onClearSelection={clearSelection}\n                    />\n                </div>\n            )}\n            \n            {/* Print Modal */}\n            {showPrintModal && (\n                <PrintQuestModal\n                    scenario={showPrintModal}\n                    userProfile={userProfile}\n                    onClose={() => setShowPrintModal(null)}\n                />\n            )}\n        </div>\n    );\n\n    return viewport.isMobile ? renderMobileLayout() : (\n        <div className={styles.containerDesktop}>\n            <div className={styles.containerInner}>\n                <h1 className={styles.titleDesktop}>\n                    Your Arsenal of KNIGHTHOOD Quests\n                </h1>\n                <p className={styles.subtitleDesktop}>\n                    Manage and compare your different recipes for SUFFERING in pursuit of the highest HONOUR in Sufferlandria\n                </p>\n\n                {isLoadingMetrics && (\n                    <div className={styles.loadingContainerDesktop}>\n                        <div className={styles.loadingTextLargeDesktop}>\n                            📊 Calculating workout metrics dynamically...\n                        </div>\n                        <div className={styles.loadingTextSmallDesktop}>\n                            Loading duration, TSS, and intensity data from workout files\n                        </div>\n                    </div>\n                )}\n\n                {/* Controls */}\n                <div className={styles.controlsSection}>\n                    <select\n                        value={sortBy}\n                        onChange={(e) => setSortBy(e.target.value as any)}\n                        className={styles.sortSelect}\n                    >\n                        <option value=\"created\">Sort by Created Date</option>\n                        <option value=\"name\">Sort by Name</option>\n                        <option value=\"duration\">Sort by Duration</option>\n                        <option value=\"elapsed\">Sort by Elapsed Duration</option>\n                        <option value=\"tss\">Sort by TSS</option>\n                        <option value=\"if\">Sort by IF</option>\n                    </select>\n                    \n                    <button\n                        onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')}\n                        className={styles.sortOrderButton}\n                    >\n                        {sortOrder === 'asc' ? '↑' : '↓'}\n                    </button>\n\n                    <button\n                        onClick={compareAll}\n                        className={styles.compareAllButton}\n                        disabled={scenariosWithMetrics.length === 0}\n                    >\n                        Compare All\n                    </button>\n\n                    {selectedScenarios.size > 0 && (\n                        <div className={styles.selectionInfo}>\n                            {selectedScenarios.size} scenario{selectedScenarios.size > 1 ? 's' : ''} selected for comparison\n                        </div>\n                    )}\n                </div>\n\n                {/* Scenarios List */}\n                {scenarios.length === 0 ? (\n                    <div className={styles.emptyStateDesktopAlt}>\n                        <h3 className={styles.emptyTitleDesktop}>No Scenarios Yet</h3>\n                        <p className={styles.emptyDescriptionDesktop}>\n                            Forge your first path to KNIGHTHOOD by assembling an arsenal of 10 instruments of SUFFERING.\n                        </p>\n                    </div>\n                ) : (\n                    <div className={styles.mainTableContainer}>\n                        <table className={styles.mainTable}>\n                            <thead>\n                                <tr className={styles.mainTableHeader}>\n                                    <th className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellCenter} ${styles.mainTableHeaderCellCheckbox}`}>\n                                        Compare\n                                    </th>\n                                    <th \n                                        className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellSortable}`}\n                                        onClick={() => handleSort('name')}\n                                    >\n                                        Scenario {getSortIcon('name')}\n                                    </th>\n                                    <th className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellCenter}`}>\n                                        Workouts\n                                    </th>\n                                    <th \n                                        className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellCenter} ${styles.mainTableHeaderCellSortable}`}\n                                        onClick={() => handleSort('duration')}\n                                    >\n                                        Workout Duration {getSortIcon('duration')}\n                                    </th>\n                                    <th \n                                        className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellCenter} ${styles.mainTableHeaderCellSortable}`}\n                                        onClick={() => handleSort('elapsed')}\n                                    >\n                                        Elapsed Duration {getSortIcon('elapsed')}\n                                    </th>\n                                    <th \n                                        className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellCenter} ${styles.mainTableHeaderCellSortable}`}\n                                        onClick={() => handleSort('tss')}\n                                    >\n                                        TSS® {getSortIcon('tss')}\n                                    </th>\n                                    <th \n                                        className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellCenter} ${styles.mainTableHeaderCellSortable}`}\n                                        onClick={() => handleSort('if')}\n                                    >\n                                        Avg IF® {getSortIcon('if')}\n                                    </th>\n                                    <th className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellCenter}`}>\n                                        Avg NP®\n                                    </th>\n                                    <th className={`${styles.mainTableHeaderCell} ${styles.mainTableHeaderCellCenter}`}>\n                                        Actions\n                                    </th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {sortedScenarios.map((scenario, index) => {\n                                    const isSelected = selectedScenarios.has(scenario.id);\n                                    const isLastRow = index >= sortedScenarios.length - 1;\n                                    \n                                    return (\n                                        <tr \n                                            key={scenario.id}\n                                            className={`${styles.mainTableRow} ${\n                                                isSelected ? styles.mainTableRowSelected : \n                                                (index % 2 === 0 ? styles.mainTableRowEven : styles.mainTableRowOdd)\n                                            } ${isLastRow ? styles.mainTableRowLast : ''}`}\n                                        >\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellCenter}`}>\n                                                <input\n                                                    type=\"checkbox\"\n                                                    checked={isSelected}\n                                                    onChange={() => toggleScenarioSelection(scenario.id)}\n                                                    className={styles.scenarioCheckbox}\n                                                />\n                                            </td>\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellTop}`}>\n                                                <div>\n                                                    <div className={styles.scenarioNameDesktop}>{scenario.name}</div>\n                                                    <div className={styles.scenarioDateDesktop}>\n                                                        Created: {new Date(scenario.createdAt).toLocaleDateString()}\n                                                    </div>\n                                                </div>\n                                            </td>\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellCenter}`}>\n                                                {scenario.workouts.length}/10\n                                            </td>\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellCenter}`}>\n                                                {formatDuration(scenario.dynamicMetrics.totalDuration)}\n                                            </td>\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellCenter}`}>\n                                                {formatDuration(scenario.dynamicMetrics.totalElapsedDuration)}\n                                            </td>\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellCenter}`}>\n                                                {Math.round(scenario.dynamicMetrics.totalTSS)}\n                                            </td>\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellCenter}`}>\n                                                {scenario.dynamicMetrics.averageIF.toFixed(2)}\n                                            </td>\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellCenter}`}>\n                                                {Math.round(scenario.dynamicMetrics.totalNP)}W\n                                            </td>\n                                            <td className={`${styles.mainTableCell} ${styles.mainTableCellCenter}`}>\n                                                <div className={styles.actionButtonsDesktopContainer}>\n                                                    <button\n                                                        data-testid={`view-scenario-${scenario.id}`}\n                                                        onClick={() => onViewScenario?.(scenario)}\n                                                        className={`${styles.actionButtonDesktop} ${styles.viewButtonDesktop}`}\n                                                    >\n                                                        View\n                                                    </button>\n                                                    <button\n                                                        onClick={() => onEditScenario(scenario)}\n                                                        data-testid={`edit-scenario-${scenario.id}`}\n                                                        className={`${styles.actionButtonDesktop} ${styles.editButtonDesktop}`}\n                                                    >\n                                                        Edit\n                                                    </button>\n                                                    <button\n                                                        onClick={() => duplicateScenario(scenario)}\n                                                        data-testid={`duplicate-scenario-${scenario.id}`}\n                                                        className={`${styles.actionButtonDesktop} ${styles.copyButtonDesktop}`}\n                                                    >\n                                                        Copy\n                                                    </button>\n                                                    <button\n                                                        onClick={() => setShowPrintModal(scenario)}\n                                                        data-testid={`print-scenario-${scenario.id}`}\n                                                        className={`${styles.actionButtonDesktop} ${styles.printButtonDesktop}`}\n                                                    >\n                                                        Print\n                                                    </button>\n                                                    <button\n                                                        onClick={() => shareScenario(scenario)}\n                                                        data-testid={`share-scenario-${scenario.id}`}\n                                                        className={`${styles.actionButtonDesktop} ${styles.shareButtonDesktop}`}\n                                                    >\n                                                        Share\n                                                    </button>\n                                                    <button\n                                                        onClick={() => deleteScenario(scenario.id)}\n                                                        data-testid={`delete-scenario-${scenario.id}`}\n                                                        className={`${styles.actionButtonDesktop} ${styles.deleteButtonDesktop}`}\n                                                    >\n                                                        Delete\n                                                    </button>\n                                                </div>\n                                            </td>\n                                        </tr>\n                                    );\n                                })}\n                            </tbody>\n                        </table>\n                    </div>\n                )}\n\n                {/* Enhanced Comparison Section with Chart */}\n                {selectedScenarios.size > 0 && (\n                    <div ref={comparisonSectionRef}>\n                        {/* Chart-based comparison */}\n                        <ScenarioComparison\n                            scenarios={selectedScenariosList}\n                            userProfile={userProfile}\n                            onClearSelection={clearSelection}\n                        />\n                    </div>\n                )}\n            </div>\n            \n            {/* Print Modal */}\n            {showPrintModal && (\n                <PrintQuestModal\n                    scenario={showPrintModal}\n                    userProfile={userProfile}\n                    onClose={() => setShowPrintModal(null)}\n                />\n            )}\n        </div>\n    );\n};\n\nexport default ScenarioManager;","import React, { useState } from 'react';\nimport { Scenario, BasketState } from '../types/scenario';\nimport { generateScenarioId, calculateCombinedMetrics, formatDuration } from '../utils/scenarioHelpers';\nimport styles from './SaveScenarioModal.module.css';\n\ninterface SaveScenarioModalProps {\n    basketState: BasketState;\n    onSave: (scenario: Scenario) => void;\n    onCancel: () => void;\n    existingScenario?: Scenario | null;\n}\n\nconst SaveScenarioModal: React.FC<SaveScenarioModalProps> = ({ \n    basketState, \n    onSave, \n    onCancel,\n    existingScenario \n}) => {\n    const [scenarioName, setScenarioName] = useState(existingScenario?.name || '');\n    const [error, setError] = useState('');\n    \n    // Calculate metrics for display purposes only (not stored)\n    const combinedMetrics = calculateCombinedMetrics(basketState.selectedWorkouts);\n\n    const handleSave = () => {\n        if (!scenarioName.trim()) {\n            setError('Please enter a scenario name');\n            return;\n        }\n\n        if (!basketState.isComplete) {\n            setError('Please select exactly 10 workouts');\n            return;\n        }\n\n        const scenario: Scenario = {\n            id: existingScenario?.id || generateScenarioId(),\n            name: scenarioName.trim(),\n            createdAt: existingScenario?.createdAt || new Date().toISOString(),\n            workouts: basketState.selectedWorkouts\n            // No longer storing combinedMetrics - calculated dynamically\n        };\n\n        onSave(scenario);\n    };\n\n    const handleKeyPress = (e: React.KeyboardEvent) => {\n        if (e.key === 'Enter') {\n            handleSave();\n        } else if (e.key === 'Escape') {\n            onCancel();\n        }\n    };\n\n    return (\n        <div \n            className={styles.modalOverlay}\n            onClick={(e) => {\n                if (e.target === e.currentTarget) {\n                    onCancel();\n                }\n            }}\n        >\n            <div \n                className={styles.modalContainer}\n                onClick={(e) => e.stopPropagation()}\n            >\n                <h2 className={styles.modalTitle}>\n                    {existingScenario ? 'Update Scenario' : 'Save New Scenario'}\n                </h2>\n\n                {/* Scenario Name Input */}\n                <div className={styles.formSection}>\n                    <label className={styles.formLabel}>\n                        Scenario Name\n                    </label>\n                    <input\n                        type=\"text\"\n                        value={scenarioName}\n                        onChange={(e) => {\n                            setScenarioName(e.target.value);\n                            setError('');\n                        }}\n                        data-testid=\"scenario-name-input\"\n                        onKeyPress={handleKeyPress}\n                        placeholder=\"Enter a name for your Knighthood challenge scenario...\"\n                        className={`${styles.formInput} ${error ? styles.formInputError : ''}`}\n                        autoFocus\n                    />\n                    {error && (\n                        <div className={styles.errorMessage}>\n                            {error}\n                        </div>\n                    )}\n                </div>\n\n                {/* Summary */}\n                <div className={styles.summarySection}>\n                    <h3 className={styles.summaryTitle}>Challenge Summary</h3>\n                    \n                    <div className={styles.metricsGrid}>\n                        <div className={styles.metricItem}>\n                            <div className={styles.metricLabel}>Workouts</div>\n                            <div className={styles.metricValueComplete}>\n                                {basketState.selectedWorkouts.length}/10\n                                {basketState.isComplete && (\n                                    <span className={styles.completeIcon}>✓</span>\n                                )}\n                            </div>\n                        </div>\n                        <div className={styles.metricItem}>\n                            <div className={styles.metricLabel}>Total Duration</div>\n                            <div className={styles.metricValue}>\n                                {formatDuration(combinedMetrics.totalDuration)}\n                            </div>\n                        </div>\n                        <div className={styles.metricItem}>\n                            <div className={styles.metricLabel}>Total TSS®</div>\n                            <div className={styles.metricValue}>\n                                {Math.round(combinedMetrics.totalTSS)}\n                            </div>\n                        </div>\n                        <div className={styles.metricItem}>\n                            <div className={styles.metricLabel}>Average IF®</div>\n                            <div className={styles.metricValue}>\n                                {combinedMetrics.averageIF.toFixed(2)}\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Workout List */}\n                    <div className={styles.workoutListSection}>\n                        <div className={styles.workoutListLabel}>\n                            Selected Workouts:\n                        </div>\n                        <div className={styles.workoutListContainer}>\n                            {basketState.selectedWorkouts.map((workout, index) => (\n                                <div \n                                    key={workout.id}\n                                    className={styles.workoutItem}\n                                >\n                                    <div>\n                                        <span className={styles.workoutName}>\n                                            {index + 1}. {workout.name}\n                                        </span>\n                                    </div>\n                                    <div className={styles.workoutDuration}>\n                                        {workout.metrics ? formatDuration(workout.metrics.duration) : 'N/A'}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Actions */}\n                <div className={styles.actionButtons}>\n                    <button\n                        onClick={onCancel}\n                        className={styles.cancelButton}\n                    >\n                        Cancel\n                    </button>\n                    <button\n                        onClick={handleSave}\n                        disabled={!basketState.isComplete || !scenarioName.trim()}\n                        data-testid=\"save-scenario-modal-button\"\n                        className={`${styles.saveButton} ${\n                            basketState.isComplete && scenarioName.trim() \n                                ? styles.saveButtonEnabled \n                                : styles.saveButtonDisabled\n                        }`}\n                    >\n                        {existingScenario ? 'Update Scenario' : 'Save Scenario'}\n                    </button>\n                </div>\n\n                <div className={styles.infoSection}>\n                    <p className={styles.infoText}>\n                        <strong>About the Knight of Sufferlandria Challenge:</strong><br />\n                        Complete these 10 workouts back-to-back to earn your knighthood. \n                        Plan your challenge carefully - the order and combination matter for your success!\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default SaveScenarioModal;","import { UserProfileData, UserPowerProfile } from '../types/userProfile';\n\nconst USER_PROFILE_STORAGE_KEY = 'user_power_profile';\nexport const DEFAULT_TARGET_INTENSITY = 70;\n\nexport const saveUserProfile = (profile: UserPowerProfile): void => {\n    try {\n        const profileData: UserProfileData = {\n            powerProfile: profile,\n            createdAt: getUserProfile()?.createdAt || new Date().toISOString(),\n            updatedAt: new Date().toISOString()\n        };\n        localStorage.setItem(USER_PROFILE_STORAGE_KEY, JSON.stringify(profileData));\n    } catch (error) {\n        console.error('Failed to save user profile to localStorage:', error);\n    }\n};\n\nexport const getUserProfile = (): UserProfileData | null => {\n    try {\n        const stored = localStorage.getItem(USER_PROFILE_STORAGE_KEY);\n        return stored ? JSON.parse(stored) : null;\n    } catch (error) {\n        console.error('Failed to load user profile from localStorage:', error);\n        return null;\n    }\n};\n\nexport const hasUserProfile = (): boolean => {\n    const profile = getUserProfile();\n    return profile !== null && \n           profile.powerProfile.nm > 0 && \n           profile.powerProfile.ac > 0 && \n           profile.powerProfile.map > 0 && \n           profile.powerProfile.ftp > 0 &&\n           (profile.powerProfile.targetIntensity === undefined || profile.powerProfile.targetIntensity >= 30);\n};\n\nexport const clearUserProfile = (): void => {\n    try {\n        localStorage.removeItem(USER_PROFILE_STORAGE_KEY);\n    } catch (error) {\n        console.error('Failed to clear user profile from localStorage:', error);\n    }\n};\n\nexport const getDefaultPowerProfile = (): UserPowerProfile => {\n    // Realistic default values for an average recreational cyclist\n    return {\n        ftp: 200,   // Functional Threshold Power (base level)\n        map: 260,   // Maximum Aerobic Power (typically ~30% higher than FTP)\n        ac: 340,    // Anaerobic Capacity (typically ~30% higher than MAP)\n        nm: 450,    // Neuromuscular Power (typically ~30% higher than AC)\n        targetIntensity: DEFAULT_TARGET_INTENSITY  // Target training intensity percentage\n    };\n};\n\nexport const getUserProfileWithDefaults = (): UserPowerProfile => {\n    const profile = getUserProfile();\n    if (!profile) {\n        return getDefaultPowerProfile();\n    }\n    \n    // Migrate existing profiles that might not have targetIntensity\n    const powerProfile = { ...profile.powerProfile };\n    \n    // Ensure targetIntensity is always a valid number\n    if (!powerProfile.targetIntensity || \n        isNaN(powerProfile.targetIntensity) || \n        powerProfile.targetIntensity <= 0 || \n        powerProfile.targetIntensity > 100) {\n        powerProfile.targetIntensity = DEFAULT_TARGET_INTENSITY; // Default to 70% for invalid values\n    }\n    \n    return powerProfile;\n};\n\nexport const isUsingDefaultProfile = (): boolean => {\n    const profile = getUserProfile();\n    return profile === null || !hasUserProfile();\n};\n\nexport const validatePowerProfile = (profile: UserPowerProfile): string[] => {\n    const errors: string[] = [];\n    \n    if (!profile.nm || profile.nm <= 0) {\n        errors.push('Neuromuscular Power (NM) must be greater than 0');\n    }\n    if (!profile.ac || profile.ac <= 0) {\n        errors.push('Anaerobic Capacity (AC) must be greater than 0');\n    }\n    if (!profile.map || profile.map <= 0) {\n        errors.push('Maximum Aerobic Power (MAP) must be greater than 0');\n    }\n    if (!profile.ftp || profile.ftp <= 0) {\n        errors.push('Functional Threshold Power (FTP) must be greater than 0');\n    }\n    if (profile.targetIntensity == null || profile.targetIntensity < 30 || profile.targetIntensity > 100) {\n        errors.push('Target Intensity must be between 30% and 100%');\n    }\n    \n    // Logical validation: NM >= AC >= MAP >= FTP (typical power curve)\n    if (profile.nm > 0 && profile.ac > 0 && profile.nm < profile.ac) {\n        errors.push('Neuromuscular Power (NM) should typically be higher than Anaerobic Capacity (AC)');\n    }\n    if (profile.ac > 0 && profile.map > 0 && profile.ac < profile.map) {\n        errors.push('Anaerobic Capacity (AC) should typically be higher than Maximum Aerobic Power (MAP)');\n    }\n    if (profile.map > 0 && profile.ftp > 0 && profile.map < profile.ftp) {\n        errors.push('Maximum Aerobic Power (MAP) should typically be higher than Functional Threshold Power (FTP)');\n    }\n    \n    return errors;\n};","import React, { useState } from 'react';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { validatePowerProfile } from '../utils/userProfileHelpers';\nimport { useViewport } from '../hooks/useViewport';\nimport styles from './UserProfileSetup.module.css';\n\ninterface UserProfileSetupProps {\n    onProfileSave: (profile: UserPowerProfile) => void;\n    initialProfile?: UserPowerProfile | null;\n    isFirstTime?: boolean;\n}\n\nconst UserProfileSetup: React.FC<UserProfileSetupProps> = ({ \n    onProfileSave, \n    initialProfile,\n    isFirstTime = false \n}) => {\n    const viewport = useViewport();\n    const [profile, setProfile] = useState<UserPowerProfile>(\n        initialProfile || { nm: 0, ac: 0, map: 0, ftp: 0, targetIntensity: 70 }\n    );\n    const [errors, setErrors] = useState<string[]>([]);\n    const [isSubmitting, setIsSubmitting] = useState(false);\n\n    const handleInputChange = (field: keyof UserPowerProfile, value: string) => {\n        const numValue = parseInt(value) || 0;\n        setProfile(prev => ({ ...prev, [field]: numValue }));\n        setErrors([]); // Clear errors when user starts typing\n    };\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        setIsSubmitting(true);\n        \n        const validationErrors = validatePowerProfile(profile);\n        \n        if (validationErrors.length > 0) {\n            setErrors(validationErrors);\n            setIsSubmitting(false);\n            return;\n        }\n\n        onProfileSave(profile);\n        setIsSubmitting(false);\n    };\n\n    return (\n        <div className={`${styles.modalOverlay} ${viewport.isMobile ? styles.modalOverlayMobile : styles.modalOverlayDesktop}`}>\n            <div className={`${styles.modalContainer} ${viewport.isMobile ? styles.modalContainerMobile : styles.modalContainerDesktop}`}>\n                <div className={`${styles.headerSection} ${viewport.isMobile ? styles.headerSectionMobile : styles.headerSectionDesktop}`}>\n                    <h1 className={`${styles.title} ${viewport.isMobile ? styles.titleMobile : styles.titleDesktop}`}>\n                        {isFirstTime ? \n                            (viewport.isMobile ? '🏰 Welcome!' : '🏰 Welcome to Knight of Sufferlandria!') : \n                            '⚙️ Power Profile Settings'\n                        }\n                    </h1>\n                    <p className={`${styles.subtitle} ${viewport.isMobile ? styles.subtitleMobile : styles.subtitleDesktop}`}>\n                        {isFirstTime \n                            ? (viewport.isMobile \n                                ? 'Enter your power profile values to calculate accurate training metrics.'\n                                : 'To calculate accurate training metrics for your Knighthood challenge, we need your power profile values. These are typically determined through a 4DP (Four Dimensional Power) test in Wahoo SYSTM.'\n                              )\n                            : 'Update your power profile values to recalculate training metrics.'\n                        }\n                    </p>\n                </div>\n\n                <form onSubmit={handleSubmit}>\n                    <div className={styles.formGrid}>\n                        {/* NM Input */}\n                        <div className={styles.inputGroup}>\n                            <label className={`${styles.label} ${styles.labelNM}`}>\n                                Neuromuscular Power (NM)\n                            </label>\n                            <input\n                                type=\"number\"\n                                value={profile.nm || ''}\n                                onChange={(e) => handleInputChange('nm', e.target.value)}\n                                placeholder=\"e.g. 922\"\n                                className={`${styles.input} ${styles.inputNM}`}\n                            />\n                            <p className={styles.helpText}>\n                                Peak power output (5-15 seconds) - Your maximum sprint power\n                            </p>\n                        </div>\n\n                        {/* AC Input */}\n                        <div className={styles.inputGroup}>\n                            <label className={`${styles.label} ${styles.labelAC}`}>\n                                Anaerobic Capacity (AC)\n                            </label>\n                            <input\n                                type=\"number\"\n                                value={profile.ac || ''}\n                                onChange={(e) => handleInputChange('ac', e.target.value)}\n                                placeholder=\"e.g. 503\"\n                                className={`${styles.input} ${styles.inputAC}`}\n                            />\n                            <p className={styles.helpText}>\n                                Power at VO2max (1-2 minutes) - Your oxygen processing ability\n                            </p>\n                        </div>\n\n                        {/* MAP Input */}\n                        <div className={styles.inputGroup}>\n                            <label className={`${styles.label} ${styles.labelMAP}`}>\n                                Maximum Aerobic Power (MAP)\n                            </label>\n                            <input\n                                type=\"number\"\n                                value={profile.map || ''}\n                                onChange={(e) => handleInputChange('map', e.target.value)}\n                                placeholder=\"e.g. 337\"\n                                className={`${styles.input} ${styles.inputMAP}`}\n                            />\n                            <p className={styles.helpText}>\n                                Sustainable power at MAP (3-8 minutes) - Your aerobic engine\n                            </p>\n                        </div>\n\n                        {/* FTP Input */}\n                        <div className={styles.inputGroup}>\n                            <label className={`${styles.label} ${styles.labelFTP}`}>\n                                Functional Threshold Power (FTP)\n                            </label>\n                            <input\n                                type=\"number\"\n                                value={profile.ftp || ''}\n                                onChange={(e) => handleInputChange('ftp', e.target.value)}\n                                placeholder=\"e.g. 266\"\n                                className={`${styles.input} ${styles.inputFTP}`}\n                            />\n                            <p className={styles.helpText}>\n                                One-hour sustainable power - Your threshold endurance\n                            </p>\n                        </div>\n\n                        {/* Target Intensity Input */}\n                        <div className={styles.inputGroup}>\n                            <label className={`${styles.label} ${styles.labelTargetIntensity}`}>\n                                Target Intensity (%)\n                            </label>\n                            <input\n                                type=\"number\"\n                                min=\"30\"\n                                max=\"100\"\n                                value={profile.targetIntensity || ''}\n                                onChange={(e) => handleInputChange('targetIntensity', e.target.value)}\n                                placeholder=\"e.g. 70\"\n                                className={`${styles.input} ${styles.inputTargetIntensity}`}\n                            />\n                            <p className={styles.helpText}>\n                                Your preferred training intensity level (30-100%)\n                            </p>\n                        </div>\n                    </div>\n\n                    {/* Error Display */}\n                    {errors.length > 0 && (\n                        <div className={styles.errorDisplay}>\n                            <h4 className={styles.errorTitle}>\n                                Please fix these issues:\n                            </h4>\n                            <ul className={styles.errorList}>\n                                {errors.map((error, index) => (\n                                    <li key={index} className={styles.errorItem}>\n                                        {error}\n                                    </li>\n                                ))}\n                            </ul>\n                        </div>\n                    )}\n\n                    {/* Info Box */}\n                    <div className={styles.infoBox}>\n                        <h4 className={styles.infoTitle}>\n                            💡 Don't have these values yet?\n                        </h4>\n                        <p className={styles.infoText}>\n                            These power values are determined through a 4DP test in Wahoo SYSTM. If you don't have them, \n                            you can estimate FTP and use these typical ratios: NM ≈ 150% of FTP, AC ≈ 120% of FTP, MAP ≈ 105% of FTP.\n                        </p>\n                    </div>\n\n                    {/* Action Buttons */}\n                    <div className={styles.buttonContainer}>\n                        {!isFirstTime && (\n                            <button\n                                type=\"button\"\n                                onClick={() => window.location.reload()}\n                                className={`${styles.button} ${styles.cancelButton}`}\n                            >\n                                Cancel\n                            </button>\n                        )}\n                        <button\n                            type=\"submit\"\n                            disabled={isSubmitting}\n                            className={`${styles.button} ${styles.submitButton} ${isSubmitting ? styles.submitButtonDisabled : styles.submitButtonEnabled}`}\n                        >\n                            {isSubmitting ? 'Saving...' : (isFirstTime ? 'Start Challenge Planning' : 'Update Profile')}\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n};\n\nexport default UserProfileSetup;","import React, { useState } from 'react';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { getUserProfile, clearUserProfile, isUsingDefaultProfile } from '../utils/userProfileHelpers';\nimport UserProfileSetup from './UserProfileSetup';\nimport styles from './UserProfileManager.module.css';\nimport { formatTargetIntensity } from '../utils/targetIntensityUtils';\n\ninterface UserProfileManagerProps {\n    currentProfile: UserPowerProfile;\n    onProfileUpdate: (profile: UserPowerProfile) => void;\n}\n\nconst UserProfileManager: React.FC<UserProfileManagerProps> = ({ \n    currentProfile, \n    onProfileUpdate \n}) => {\n    const [showSetup, setShowSetup] = useState(false);\n    const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n\n    const profileData = getUserProfile();\n\n    const handleProfileSave = (profile: UserPowerProfile) => {\n        onProfileUpdate(profile);\n        setShowSetup(false);\n    };\n\n    const handleClearProfile = () => {\n        if (window.confirm('Are you sure you want to clear your power profile? This will refresh the app and you\\'ll need to set up your profile again.')) {\n            clearUserProfile();\n            window.location.reload();\n        }\n        setShowDeleteConfirm(false);\n    };\n\n    return (\n        <div className={styles.container}>\n            <div className={styles.containerInner}>\n                <h1 className={styles.title}>\n                    Power Profile Settings\n                </h1>\n                <p className={isUsingDefaultProfile() ? styles.subtitleWithWarning : styles.subtitle}>\n                    Manage your 4DP power profile values used for training metrics calculations\n                </p>\n                \n                {isUsingDefaultProfile() && (\n                    <div className={styles.warningBanner}>\n                        <div className={styles.warningHeader}>\n                            <span className={styles.warningIcon}>⚡</span>\n                            <strong className={styles.warningTitle}>Using Default Power Profile</strong>\n                        </div>\n                        <p className={styles.warningText}>\n                            You're currently using default power values (FTP: 200W, MAP: 260W, AC: 340W, NM: 450W). \n                            These are typical for recreational cyclists. For more accurate training metrics, \n                            customize these values based on your actual power profile or 4DP test results.\n                        </p>\n                    </div>\n                )}\n\n                {/* Current Profile Display */}\n                <div className={styles.profileContainer}>\n                    <h3 className={styles.profileTitle}>Current Power Profile</h3>\n                    \n                    <div className={styles.profileGrid}>\n                        <div className={`${styles.powerCard} ${styles.powerCardNM}`}>\n                            <div className={`${styles.powerCardLabel} ${styles.powerCardLabelNM}`}>\n                                Neuromuscular Power\n                            </div>\n                            <div className={styles.powerCardValue}>\n                                {currentProfile.nm}W\n                            </div>\n                            <div className={styles.powerCardUnit}>NM</div>\n                        </div>\n\n                        <div className={`${styles.powerCard} ${styles.powerCardAC}`}>\n                            <div className={`${styles.powerCardLabel} ${styles.powerCardLabelAC}`}>\n                                Anaerobic Capacity\n                            </div>\n                            <div className={styles.powerCardValue}>\n                                {currentProfile.ac}W\n                            </div>\n                            <div className={styles.powerCardUnit}>AC</div>\n                        </div>\n\n                        <div className={`${styles.powerCard} ${styles.powerCardMAP}`}>\n                            <div className={`${styles.powerCardLabel} ${styles.powerCardLabelMAP}`}>\n                                Maximum Aerobic Power\n                            </div>\n                            <div className={styles.powerCardValue}>\n                                {currentProfile.map}W\n                            </div>\n                            <div className={styles.powerCardUnit}>MAP</div>\n                        </div>\n\n                        <div className={`${styles.powerCard} ${styles.powerCardFTP}`}>\n                            <div className={`${styles.powerCardLabel} ${styles.powerCardLabelFTP}`}>\n                                Functional Threshold Power\n                            </div>\n                            <div className={styles.powerCardValue}>\n                                {currentProfile.ftp}W\n                            </div>\n                            <div className={styles.powerCardUnit}>FTP</div>\n                        </div>\n\n                        <div className={`${styles.powerCard} ${styles.powerCardTarget}`}>\n                            <div className={`${styles.powerCardLabel} ${styles.powerCardLabelTarget}`}>\n                                Target Intensity\n                            </div>\n                            <div className={styles.powerCardValue}>\n                                {formatTargetIntensity(currentProfile)}\n                            </div>\n                            <div className={styles.powerCardUnit}>Training Level</div>\n                        </div>\n                    </div>\n\n                    {profileData && (\n                        <div className={styles.profileMetadata}>\n                            <div className={styles.profileDates}>\n                                <span>Created: {new Date(profileData.createdAt).toLocaleDateString()}</span>\n                                <span>Last Updated: {new Date(profileData.updatedAt).toLocaleDateString()}</span>\n                            </div>\n                        </div>\n                    )}\n                </div>\n\n                {/* Actions */}\n                <div className={styles.actionsContainer}>\n                    <button\n                        onClick={() => setShowSetup(true)}\n                        className={styles.updateButton}\n                    >\n                        Update Power Profile\n                    </button>\n                    <button\n                        onClick={() => setShowDeleteConfirm(true)}\n                        className={styles.clearButton}\n                    >\n                        Clear Profile\n                    </button>\n                </div>\n\n                {/* Information Section */}\n                <div className={styles.infoContainer}>\n                    <h3 className={styles.infoTitle}>About 4DP Power Profile</h3>\n                    <div className={styles.infoContent}>\n                        <p className={styles.infoText}>\n                            The Four Dimensional Power (4DP) profile captures your power across different energy systems:\n                        </p>\n                        <ul className={styles.infoList}>\n                            <li className={styles.infoListItem}>\n                                <strong className={styles.infoListItemNM}>NM (Neuromuscular Power):</strong> Peak 5-15 second power output\n                            </li>\n                            <li className={styles.infoListItem}>\n                                <strong className={styles.infoListItemAC}>AC (Anaerobic Capacity):</strong> Power at VO2max (1-2 minutes)\n                            </li>\n                            <li className={styles.infoListItem}>\n                                <strong className={styles.infoListItemMAP}>MAP (Maximum Aerobic Power):</strong> Sustainable aerobic power (3-8 minutes)\n                            </li>\n                            <li className={styles.infoListItem}>\n                                <strong className={styles.infoListItemFTP}>FTP (Functional Threshold Power):</strong> One-hour sustainable power\n                            </li>\n                            <li className={styles.infoListItem}>\n                                <strong className={styles.infoListItemTarget}>Target Intensity:</strong> Your preferred training intensity level (30-100%)\n                            </li>\n                        </ul>\n                        <p>\n                            These values are used throughout the app to calculate Training Stress Score (TSS), \n                            Intensity Factor (IF), and Normalized Power (NP) for each workout in your Knighthood challenge scenarios.\n                        </p>\n                    </div>\n                </div>\n\n                {/* Delete Confirmation Dialog */}\n                {showDeleteConfirm && (\n                    <div className={styles.modalOverlay}>\n                        <div className={styles.modalContent}>\n                            <h3 className={styles.modalTitle}>Clear Power Profile?</h3>\n                            <p className={styles.modalText}>\n                                This will permanently delete your power profile and refresh the app. \n                                You'll need to set up your profile again.\n                            </p>\n                            <div className={styles.modalActions}>\n                                <button\n                                    onClick={() => setShowDeleteConfirm(false)}\n                                    className={styles.modalCancelButton}\n                                >\n                                    Cancel\n                                </button>\n                                <button\n                                    onClick={handleClearProfile}\n                                    className={styles.modalConfirmButton}\n                                >\n                                    Clear Profile\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )}\n            </div>\n\n            {/* Profile Setup Modal */}\n            {showSetup && (\n                <UserProfileSetup\n                    onProfileSave={handleProfileSave}\n                    initialProfile={currentProfile}\n                    isFirstTime={false}\n                />\n            )}\n        </div>\n    );\n};\n\nexport default UserProfileManager;","import React, { useState, useEffect } from 'react';\nimport { WorkoutSelection } from '../types/scenario';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { calculateAllTrainingMetrics } from '../utils/trainingMetrics';\nimport { WorkoutData } from '../types/workout';\nimport { getBestWorkoutData } from '../utils/workoutDataHelpers';\nimport WorkoutChart from './WorkoutChart';\nimport allWorkouts from '../data/workouts.json';\nimport { getWorkoutData } from '../data/workout-data';\nimport { useViewport } from '../hooks/useViewport';\nimport { formatDuration } from '../utils/scenarioHelpers';\nimport styles from './ReorderableWorkoutList.module.css';\n\n// Utility function to get color based on TSS value (red = high, green = low)\nconst getTSSColor = (tss: number, minTSS: number, maxTSS: number): string => {\n    if (maxTSS === minTSS) return '#FFFFFF'; // All same TSS, use white\n    \n    const normalized = (tss - minTSS) / (maxTSS - minTSS);\n    const red = Math.round(255 * normalized);\n    const green = Math.round(255 * (1 - normalized));\n    return `rgb(${red}, ${green}, 0)`;\n};\n\n// Utility function to get color based on variance from ideal 10% progression\nconst getVarianceColor = (variance: number): string => {\n    // Variance is the difference from ideal (e.g. -4%, +5%, etc.)\n    const absVariance = Math.abs(variance);\n    \n    // Scale: 0% variance = white, higher variance = more intense color\n    // Cap at 20% variance for color scaling\n    const normalized = Math.min(absVariance / 20, 1);\n        \n    const intensity = Math.round(255 * normalized);\n    \n    if (variance >= 0) {\n        // Ahead of schedule = green spectrum (0, green, 0)\n        return `rgb(0, ${255 - intensity + 128}, 0)`;\n    } else {\n        // Behind schedule = red spectrum (red, 0, 0)\n        return `rgb(${255 - intensity + 128}, 0, 0)`;\n    }\n};\n\ninterface ReorderableWorkoutListProps {\n    workouts: WorkoutSelection[];\n    userProfile: UserPowerProfile;\n    onReorder: (reorderedWorkouts: WorkoutSelection[]) => void;\n    title?: string;\n    subtitle?: string;\n}\n\ninterface WorkoutRowData {\n    id: string;\n    name: string;\n    workoutData: WorkoutData | null;\n    metrics: {\n        duration: string;\n        tss: number;\n        targetTss: number;\n        intensityFactor: number;\n        targetIntensityFactor: number;\n        normalizedPower: number;\n        targetNormalizedPower: number;\n    } | null;\n    error?: string;\n    usedOutdoorData?: boolean;\n    cumulativeTSSPercentage?: number;\n}\n\nconst ReorderableWorkoutList: React.FC<ReorderableWorkoutListProps> = ({\n    workouts,\n    userProfile,\n    onReorder,\n    title = \"Challenge Workouts\",\n    subtitle = \"Drag and drop to reorder workouts • Click charts to see detailed workout profiles\"\n}) => {\n    const viewport = useViewport();\n    const [workoutRows, setWorkoutRows] = useState<WorkoutRowData[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [draggedIndex, setDraggedIndex] = useState<number | null>(null);\n    const [dragOverIndex, setDragOverIndex] = useState<number | null>(null);\n    const [minTSS, setMinTSS] = useState<number>(0);\n    const [maxTSS, setMaxTSS] = useState<number>(0);\n    const [totalTSS, setTotalTSS] = useState<number>(0);\n    const [totalTargetTSS, setTotalTargetTSS] = useState<number>(0);\n    const [averageTargetIF, setAverageTargetIF] = useState<number>(0);\n    const [totalDuration, setTotalDuration] = useState<number>(0);\n    const [averageIF, setAverageIF] = useState<number>(0);\n    const [combinedWorkoutData, setCombinedWorkoutData] = useState<WorkoutData | null>(null);\n\n\n\n    const findWorkoutTitle = (contentId: string): string => {\n        const workout = allWorkouts.data.library.content.find((item: any) => item.id === contentId);\n        return workout?.name || 'Unknown Workout';\n    };\n\n    const loadWorkoutData = async (workoutId: string): Promise<{ data: WorkoutData | null; usedOutdoor: boolean }> => {\n        try {\n            const rawData = getWorkoutData(workoutId);\n            if (!rawData) {\n                throw new Error(`Workout data not found for ${workoutId}`);\n            }\n            const result = getBestWorkoutData(rawData);\n            return {\n                data: result.data,\n                usedOutdoor: result.usedOutdoor\n            };\n        } catch (error) {\n            console.error(`Error loading workout ${workoutId}:`, error);\n            return { data: null, usedOutdoor: false };\n        }\n    };\n\n    const formatDurationFromSeconds = (seconds: number): string => {\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n        \n        if (hours > 0) {\n            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        } else {\n            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        }\n    };\n\n    const formatTotalDuration = (totalSeconds: number): string => {\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        \n        if (hours > 0) {\n            return `${hours}h ${minutes}m`;\n        } else {\n            return `${minutes}m`;\n        }\n    };\n\n    const combineWorkoutDataWithRest = (workoutRows: WorkoutRowData[]): WorkoutData | null => {\n        const validWorkouts = workoutRows.filter(row => row.workoutData);\n        if (validWorkouts.length === 0) return null;\n\n        let combinedTime: number[] = [];\n        let combinedValue: number[] = [];\n        let combinedType: string[] = [];\n        let currentTime = 0;\n\n        validWorkouts.forEach((workout, index) => {\n            if (!workout.workoutData) return;\n\n            // Add the workout data, adjusting timestamps\n            const workoutData = workout.workoutData;\n            const adjustedTime = workoutData.time.map(t => t + currentTime);\n            \n            combinedTime = combinedTime.concat(adjustedTime);\n            combinedValue = combinedValue.concat(workoutData.value);\n            combinedType = combinedType.concat(workoutData.type);\n            \n            // Update current time to end of this workout\n            const lastTime = workoutData.time[workoutData.time.length - 1];\n            if (lastTime !== undefined) {\n                currentTime += lastTime;\n            }\n\n            // Add 10-minute rest period between workouts (except after the last one)\n            if (index < validWorkouts.length - 1) {\n                const restDuration = 10 * 60; // 10 minutes in seconds\n                \n                // Add rest period data points (every 30 seconds for efficiency)\n                for (let i = 0; i <= restDuration; i += 30) {\n                    combinedTime.push(currentTime + i);\n                    combinedValue.push(0); // Zero power during rest\n                    combinedType.push('power'); // Assume power type\n                }\n                \n                currentTime += restDuration;\n            }\n        });\n\n        return {\n            time: combinedTime,\n            value: combinedValue,\n            type: combinedType,\n            __typename: validWorkouts[0].workoutData?.__typename || 'WorkoutData'\n        };\n    };\n\n    useEffect(() => {\n        const loadWorkoutDetails = async () => {\n            const rows: WorkoutRowData[] = [];\n\n            for (const workout of workouts) {\n                const title = findWorkoutTitle(workout.id);\n                const workoutResult = await loadWorkoutData(workout.id);\n                \n                let metrics = null;\n                if (workoutResult.data) {\n                    try {\n                        const calculatedMetrics = calculateAllTrainingMetrics(workoutResult.data, userProfile);\n                        metrics = {\n                            duration: formatDurationFromSeconds(calculatedMetrics.duration),\n                            tss: calculatedMetrics.trainingStressScore,\n                            targetTss: calculatedMetrics.trainingStressScore * (userProfile.targetIntensity / 100),\n                            intensityFactor: calculatedMetrics.intensityFactor,\n                            targetIntensityFactor: calculatedMetrics.intensityFactor * (userProfile.targetIntensity / 100),\n                            normalizedPower: calculatedMetrics.normalizedPower,\n                            targetNormalizedPower: calculatedMetrics.normalizedPower * (userProfile.targetIntensity / 100)\n                        };\n                    } catch (error) {\n                        console.error(`Error calculating metrics for ${workout.id}:`, error);\n                    }\n                }\n\n                rows.push({\n                    id: workout.id,\n                    name: title,\n                    workoutData: workoutResult.data,\n                    metrics,\n                    error: !workoutResult.data ? 'Workout data not available' : undefined,\n                    usedOutdoorData: workoutResult.usedOutdoor\n                });\n            }\n\n            // Calculate TSS statistics and cumulative percentages\n            const validTSSValues = rows.filter(row => row.metrics?.tss).map(row => row.metrics!.tss);\n            if (validTSSValues.length > 0) {\n                const minTSSValue = Math.min(...validTSSValues);\n                const maxTSSValue = Math.max(...validTSSValues);\n                const totalTSSValue = validTSSValues.reduce((sum, tss) => sum + tss, 0);\n                \n                setMinTSS(minTSSValue);\n                setMaxTSS(maxTSSValue);\n                setTotalTSS(totalTSSValue);\n\n                // Calculate target TSS and average target IF\n                const validTargetTSSValues = rows.filter(row => row.metrics?.targetTss).map(row => row.metrics!.targetTss);\n                const validTargetIFValues = rows.filter(row => row.metrics?.targetIntensityFactor).map(row => row.metrics!.targetIntensityFactor);\n                \n                if (validTargetTSSValues.length > 0) {\n                    const totalTargetTSSValue = validTargetTSSValues.reduce((sum, targetTss) => sum + targetTss, 0);\n                    setTotalTargetTSS(totalTargetTSSValue);\n                }\n                \n                if (validTargetIFValues.length > 0) {\n                    const averageTargetIFValue = validTargetIFValues.reduce((sum, targetIf) => sum + targetIf, 0) / validTargetIFValues.length;\n                    setAverageTargetIF(averageTargetIFValue);\n                }\n\n                // Calculate total duration and average IF\n                const validDurationValues = rows.filter(row => row.metrics?.duration).map(row => {\n                    const duration = row.metrics!.duration;\n                    // Convert duration string (HH:MM:SS or MM:SS) to seconds\n                    const parts = duration.split(':').map(Number);\n                    if (parts.length === 3) {\n                        return parts[0] * 3600 + parts[1] * 60 + parts[2];\n                    } else if (parts.length === 2) {\n                        return parts[0] * 60 + parts[1];\n                    }\n                    return 0;\n                });\n                \n                const validIFValues = rows.filter(row => row.metrics?.intensityFactor).map(row => row.metrics!.intensityFactor);\n                \n                if (validDurationValues.length > 0) {\n                    const totalDurationValue = validDurationValues.reduce((sum, duration) => sum + duration, 0);\n                    setTotalDuration(totalDurationValue);\n                }\n                \n                if (validIFValues.length > 0) {\n                    const averageIFValue = validIFValues.reduce((sum, if_val) => sum + if_val, 0) / validIFValues.length;\n                    setAverageIF(averageIFValue);\n                }\n\n                // Calculate cumulative TSS percentages\n                let cumulativeTSS = 0;\n                rows.forEach(row => {\n                    if (row.metrics?.tss) {\n                        cumulativeTSS += row.metrics.tss;\n                        row.cumulativeTSSPercentage = (cumulativeTSS / totalTSSValue) * 100;\n                    }\n                });\n            }\n\n            setWorkoutRows(rows);\n            \n            // Generate combined workout data\n            const combined = combineWorkoutDataWithRest(rows);\n            setCombinedWorkoutData(combined);\n            \n            setLoading(false);\n        };\n\n        loadWorkoutDetails();\n    }, [workouts, userProfile]);\n\n    // Update combined workout data when rows change (for drag and drop reordering)\n    useEffect(() => {\n        if (workoutRows.length > 0) {\n            const combined = combineWorkoutDataWithRest(workoutRows);\n            setCombinedWorkoutData(combined);\n        }\n    }, [workoutRows]);\n\n\n\n    const handleDragStart = (e: React.DragEvent<HTMLDivElement>, index: number) => {\n        setDraggedIndex(index);\n        e.dataTransfer.effectAllowed = 'move';\n        e.dataTransfer.setData('text/html', e.currentTarget.outerHTML);\n        e.currentTarget.style.opacity = '0.5';\n    };\n\n    const handleDragEnd = (e: React.DragEvent<HTMLDivElement>) => {\n        e.currentTarget.style.opacity = '';\n        setDraggedIndex(null);\n        setDragOverIndex(null);\n    };\n\n\n\n    const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        e.dataTransfer.dropEffect = 'move';\n    };\n\n    const handleDragEnter = (e: React.DragEvent<HTMLDivElement>, index: number) => {\n        e.preventDefault();\n        setDragOverIndex(index);\n    };\n\n    const handleDrop = (e: React.DragEvent<HTMLDivElement>, dropIndex: number) => {\n        e.preventDefault();\n        \n        if (draggedIndex === null || draggedIndex === dropIndex) {\n            return;\n        }\n\n        const newWorkouts = [...workouts];\n        const draggedWorkout = newWorkouts[draggedIndex];\n        \n        // Remove the dragged workout from its original position\n        newWorkouts.splice(draggedIndex, 1);\n        \n        // Insert it at the new position\n        newWorkouts.splice(dropIndex, 0, draggedWorkout);\n        \n        onReorder(newWorkouts);\n        setDraggedIndex(null);\n        setDragOverIndex(null);\n    };\n\n    const handleChartClick = (workoutRow: WorkoutRowData) => {\n        // For now, just show an alert with workout info\n        if (workoutRow.workoutData) {\n            alert(`Workout: ${workoutRow.name}\\nDuration: ${workoutRow.metrics?.duration || 'N/A'}\\nFull TSS: ${workoutRow.metrics ? Math.round(workoutRow.metrics.tss) : 'N/A'}\\nTarget TSS: ${workoutRow.metrics ? Math.round(workoutRow.metrics.targetTss) : 'N/A'} (${userProfile.targetIntensity}%)\\nFull IF: ${workoutRow.metrics ? workoutRow.metrics.intensityFactor.toFixed(2) : 'N/A'}\\nTarget IF: ${workoutRow.metrics ? workoutRow.metrics.targetIntensityFactor.toFixed(2) : 'N/A'} (${userProfile.targetIntensity}%)\\nFull NP: ${workoutRow.metrics ? Math.round(workoutRow.metrics.normalizedPower) : 'N/A'}W\\nTarget NP: ${workoutRow.metrics ? Math.round(workoutRow.metrics.targetNormalizedPower) : 'N/A'}W (${userProfile.targetIntensity}%)`);\n        }\n    };\n\n    const renderMobileLayout = () => (\n        <div data-testid=\"reorderable-workout-list\" className={styles.container}>\n            {(title || subtitle) && (\n                <div className={styles.headerSection}>\n                    {title && <h2 className={styles.title}>{title}</h2>}\n                    {subtitle && (\n                        <p className={styles.subtitle}>\n                            Tap and hold to reorder • Tap charts to see detailed workout profiles\n                        </p>\n                    )}\n                </div>\n            )}\n            \n            {loading ? (\n                <div className={styles.loadingContainer}>\n                    Loading workouts...\n                </div>\n            ) : (\n                <>\n                    {/* Combined Scenario Power Profile */}\n                    {combinedWorkoutData && (\n                        <div className={styles.combinedProfile}>\n                            <h3 className={`${styles.combinedProfileTitle} ${styles.combinedProfileTitleMobile}`}>\n                                Complete Challenge Profile\n                            </h3>\n                            <p className={styles.combinedProfileSubtitle}>\n                                Full power profile with 10-minute rest periods between workouts\n                            </p>\n                            <WorkoutChart\n                                workoutData={combinedWorkoutData}\n                                userProfile={userProfile}\n                                width={viewport.width - 80}\n                                height={120}\n                            />\n                        </div>\n                    )}\n\n                    <div className={styles.mobileContainer}>\n                        {workoutRows.map((row, index) => (\n                        <div\n                            key={`${row.name}-${index}`}\n                            data-testid={`workout-item-${index}`}\n                            data-workout-id={row.id}\n                            draggable\n                            onDragStart={(e) => handleDragStart(e, index)}\n                            onDragEnd={handleDragEnd}\n                            onDragOver={handleDragOver}\n                            onDragEnter={(e) => handleDragEnter(e, index)}\n                            onDrop={(e) => handleDrop(e, index)}\n                            className={[\n                                styles.mobileWorkoutItem,\n                                draggedIndex === index ? styles.mobileWorkoutItemDragging : '',\n                                dragOverIndex === index ? styles.mobileWorkoutItemDragOver : ''\n                            ].filter(Boolean).join(' ')}\n                        >\n                            {/* Order Number and Drag Handle */}\n                            <div className={styles.mobileHeader}>\n                                <div \n                                    data-testid={`order-number-${index}`}\n                                    className={styles.mobileIndex}\n                                >\n                                    {index + 1}\n                                </div>\n                                <div \n                                    data-testid={`drag-handle-${index}`}\n                                    className={styles.mobileDragHandle}\n                                >\n                                    ⋮⋮\n                                </div>\n                            </div>\n\n                            {/* Workout Name */}\n                            <h3 className={styles.mobileWorkoutName}>\n                                {row.name}\n                                {row.usedOutdoorData && (\n                                    <span className={styles.outdoorBadge}>\n                                        OUTDOOR\n                                    </span>\n                                )}\n                                <a \n                                    href={`https://systm.wahoofitness.com/content-details/${row.id}`}\n                                    target=\"_blank\"\n                                    rel=\"noopener noreferrer\"\n                                    onTouchStart={(e) => e.stopPropagation()}\n                                    onMouseDown={(e) => e.stopPropagation()}\n                                    onClick={(e) => e.stopPropagation()}\n                                    className={styles.systmLink}\n                                    onTouchEnd={(e) => {\n                                        e.currentTarget.style.backgroundColor = 'rgba(76, 175, 80, 0.2)';\n                                        setTimeout(() => {\n                                            e.currentTarget.style.backgroundColor = 'transparent';\n                                        }, 150);\n                                    }}\n                                    title={`View ${row.name} on SYSTM`}\n                                >\n                                    ↗\n                                </a>\n                            </h3>\n\n                            {/* Metrics Grid - Row 1: Duration, Full TSS, Target TSS */}\n                            <div className={styles.mobileMetricsRowOne}>\n                                <div className={styles.mobileMetricItem}>\n                                    <div className={styles.mobileMetricValue}>\n                                        {row.metrics?.duration || '-'}\n                                    </div>\n                                    <div className={styles.mobileMetricLabel}>\n                                        Duration\n                                    </div>\n                                </div>\n                                <div className={styles.mobileMetricItem}>\n                                    <div className={styles.mobileMetricValue}>\n                                        {row.metrics ? `${Math.round(row.metrics.normalizedPower)}W` : '-'}&nbsp;\n                                        ({row.metrics ? `${Math.round(row.metrics.targetNormalizedPower)}W` : '-'})\n                                    </div>\n                                    <div className={styles.mobileMetricLabel}>\n                                        NP® ({userProfile.targetIntensity}%)\n                                    </div>\n                                </div>\n                                <div className={styles.mobileMetricItem}>\n                                    <div \n                                        className={styles.mobileMetricValue}\n                                        style={{ \n                                            color: row.metrics ? getTSSColor(row.metrics.tss, minTSS, maxTSS) : \"white\"\n                                        }}>\n                                        {row.metrics ? Math.round(row.metrics.tss) : '-'}&nbsp;\n                                        ({row.metrics ? Math.round(row.metrics.targetTss) : '-'})\n                                    </div>\n                                    <div className={styles.mobileMetricLabel}>\n                                        TSS ({userProfile.targetIntensity}%)\n                                    </div>\n                                </div>\n                                <div className={styles.mobileMetricItem}>\n                                    <div className={styles.mobileMetricValue}>\n                                        {row.metrics ? row.metrics.intensityFactor.toFixed(2) : '-'}&nbsp;\n                                        ({row.metrics ? `${row.metrics.targetIntensityFactor.toFixed(2)}` : '-'})\n                                    </div>\n                                    <div className={styles.mobileMetricLabel}>\n                                        IF® ({userProfile.targetIntensity}%)\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Workout Chart */}\n                            {row.workoutData && (\n                                <div \n                                    className={styles.mobileChartContainer}\n                                    onClick={() => handleChartClick(row)}\n                                >\n                                    <WorkoutChart\n                                        workoutData={row.workoutData}\n                                        userProfile={userProfile}\n                                        width={viewport.width - 80}\n                                        height={60}\n                                    />\n                                </div>\n                            )}\n                        </div>\n                        ))}\n                    </div>\n                </>\n            )}\n        </div>\n    );\n\n    if (loading) {\n        return (\n            <div className={styles.loadingDesktop}>\n                <div className={styles.loadingText}>Loading workout details...</div>\n            </div>\n        );\n    }\n\n    // Use mobile layout for mobile screens\n    if (viewport.isMobile || viewport.isTablet) {\n        return renderMobileLayout();\n    }\n\n    return (\n        <div className={styles.desktopContainer}>\n            {/* Header */}\n            {(title || subtitle) && (\n                <div className={styles.desktopHeader}>\n                    {title && <h2 className={styles.desktopTitle}>{title}</h2>}\n                    {subtitle && <p className={styles.desktopSubtitle}>{subtitle}</p>}\n                </div>\n            )}\n\n            {/* Combined Scenario Power Profile */}\n            {combinedWorkoutData && (\n                <div className={styles.combinedScenarioProfile}>\n                    <h3 className={styles.combinedScenarioTitle}>\n                        Complete Challenge Profile\n                    </h3>\n                    <p className={styles.combinedScenarioSubtitle}>\n                        Full power profile showing all workouts in sequence with 10-minute rest periods between each workout\n                    </p>\n                    <WorkoutChart\n                        workoutData={combinedWorkoutData}\n                        userProfile={userProfile}\n                        height={150}\n                    />\n                </div>\n            )}\n\n            {/* Reorderable Workout List */}\n            <div data-testid=\"reorderable-workout-list\" className={styles.desktopTable}>\n                {/* Column Headers */}\n                <div className={styles.desktopTableHeader}>\n                    <div className={styles.headerDragSpace}></div> {/* Drag handle space */}\n                    <div className={styles.headerOrderCol}>#</div>\n                    <div className={styles.headerWorkoutCol}>Workout</div>\n                    <div className={styles.headerProfileCol}>Profile</div>\n                    <div className={styles.headerDurationCol}>Duration</div>\n                    <div className={styles.headerFullTssCol}>Full TSS</div>\n                    <div className={styles.headerTargetTssCol}>Target TSS  ({userProfile.targetIntensity}%)</div>\n                    <div className={styles.headerCumTssCol}>Cum TSS%</div>\n                    <div className={styles.headerFullIfCol}>Full IF</div>\n                    <div className={styles.headerTargetIfCol}>Target IF  ({userProfile.targetIntensity}%)</div>\n                    <div className={styles.headerNpCol}>NP® ({userProfile.targetIntensity}%)</div>\n                </div>\n\n                <div className={styles.desktopTableBody}>\n                    {workoutRows.map((workout, index) => (\n                        <div\n                            key={workout.id}\n                            data-testid={`workout-item-${index}`}\n                            data-workout-id={workout.id}\n                            draggable\n                            onDragStart={(e) => handleDragStart(e, index)}\n                            onDragEnd={handleDragEnd}\n                            onDragOver={handleDragOver}\n                            onDragEnter={(e) => handleDragEnter(e, index)}\n                            onDrop={(e) => handleDrop(e, index)}\n                            className={`${styles.desktopTableRow} ${\n                                dragOverIndex === index ? styles.dragOver : \n                                (index % 2 === 0 ? styles.evenRow : styles.oddRow)\n                            } ${draggedIndex === index ? styles.dragging : ''}`}\n                        >\n                            {/* Drag Handle */}\n                            <div \n                                data-testid={`drag-handle-${index}`}\n                                className={styles.desktopDragHandle}\n                            >\n                                ⋮⋮\n                            </div>\n\n                            {/* Order Number */}\n                            <div \n                                data-testid={`order-number-${index}`}\n                                className={styles.desktopOrderNumber}\n                            >\n                                {index + 1}\n                            </div>\n\n                            {/* Workout Info Column */}\n                            <div className={styles.desktopWorkoutInfo}>\n                                <div className={styles.desktopWorkoutNameSection}>\n                                    <div className={styles.desktopWorkoutName}>\n                                        {workout.name}\n                                        {workout.usedOutdoorData && (\n                                            <span className={styles.desktopOutdoorBadge}>\n                                                OUTDOOR\n                                            </span>\n                                        )}\n                                        <a \n                                            href={`https://systm.wahoofitness.com/content-details/${workout.id}`}\n                                            target=\"_blank\"\n                                            rel=\"noopener noreferrer\"\n                                            onMouseDown={(e) => e.stopPropagation()}\n                                            onClick={(e) => e.stopPropagation()}\n                                            className={styles.desktopSystmLink}\n                                            onMouseEnter={(e) => {\n                                                e.currentTarget.style.backgroundColor = 'rgba(76, 175, 80, 0.2)';\n                                            }}\n                                            onMouseLeave={(e) => {\n                                                e.currentTarget.style.backgroundColor = 'transparent';\n                                            }}\n                                            title={`View ${workout.name} on SYSTM`}\n                                        >\n                                            ↗\n                                        </a>\n                                    </div>\n                                    <div className={styles.desktopWorkoutId}>\n                                        ID: {workout.id}\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Profile Chart Column */}\n                            <div className={styles.desktopProfileColumn}>\n                                <div className={styles.desktopChartSection}>\n                                    {workout.workoutData ? (\n                                        <div \n                                            className={styles.desktopChartContainer}\n                                            onClick={() => handleChartClick(workout)}\n                                        >\n                                            <WorkoutChart \n                                                workoutData={workout.workoutData}\n                                                userProfile={userProfile}\n                                                height={50}\n                                            />\n                                        </div>\n                                    ) : (\n                                        <div className={styles.desktopNoChart}>\n                                            {workout.error || 'No workout data available'}\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Metrics */}\n                            <>\n                                <div className={styles.desktopDurationCol}>\n                                    {workout.metrics?.duration || '-'}\n                                </div>\n                                <div \n                                    className={styles.desktopTssCol}\n                                    style={{ \n                                        color: workout.metrics ? getTSSColor(workout.metrics.tss, minTSS, maxTSS) : 'white'\n                                    }}>\n                                    {workout.metrics ? Math.round(workout.metrics.tss) : '-'}\n                                </div>\n                                <div className={styles.desktopTargetTssCol}>\n                                    {workout.metrics ? `${Math.round(workout.metrics.targetTss)}` : '-'}\n                                </div>\n                                <div \n                                    className={styles.desktopCumTssCol}\n                                    style={{ \n                                        color: workout.cumulativeTSSPercentage ? getVarianceColor(workout.cumulativeTSSPercentage - (index + 1) * 10) : 'white'\n                                    }}>\n                                    {workout.cumulativeTSSPercentage ? \n                                        `${Math.round(workout.cumulativeTSSPercentage)}% (${(workout.cumulativeTSSPercentage - (index + 1) * 10) >= 0 ? '+' : ''}${Math.round(workout.cumulativeTSSPercentage - (index + 1) * 10)}%)` \n                                        : '-'\n                                    }\n                                </div>\n                                <div className={styles.desktopIfCol}>\n                                    {workout.metrics ? workout.metrics.intensityFactor.toFixed(2) : '-'}\n                                </div>\n                                <div className={styles.desktopTargetIfCol}>\n                                    {workout.metrics ? `${workout.metrics.targetIntensityFactor.toFixed(2)}` : '-'}\n                                </div>\n                                <div className={styles.desktopNpCol}>\n                                    {workout.metrics ? `${Math.round(workout.metrics.normalizedPower)}W (${Math.round(workout.metrics.targetNormalizedPower)}W)` : '-'}\n                                </div>\n                            </>\n                        </div>\n                    ))}\n                </div>\n\n                {/* Instructions */}\n                <div className={styles.instructionsContainer}>\n                    <div className={styles.instructionsTitle}>\n                        💡 Drag & Drop Instructions\n                    </div>\n                    <div className={styles.instructionsText}>\n                        • Grab the ⋮⋮ handle or anywhere on a workout row to drag it<br/>\n                        • Drop it at the desired position to reorder<br/>\n                        • Hover over workout charts to see detailed power profiles<br/>\n                        • Changes are automatically saved to your scenario\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ReorderableWorkoutList;","import React, { useState, useEffect } from 'react';\nimport { WorkoutSelection, Scenario } from '../types/scenario';\nimport { UserPowerProfile } from '../types/userProfile';\nimport ReorderableWorkoutList from './ReorderableWorkoutList';\nimport { calculateCombinedMetricsDynamic, formatDuration, generateScenarioId } from '../utils/scenarioHelpers';\nimport allWorkouts from '../data/workouts.json';\nimport styles from './SharedScenarioView.module.css';\nimport { getTargetIntensity } from '../utils/targetIntensityUtils';\n\ninterface SharedScenarioViewProps {\n    workoutIds: string[];\n    scenarioName: string;\n    onSaveAsScenario?: (scenario: Scenario) => void;\n    onBackToApp?: () => void;\n    userProfile: UserPowerProfile;\n}\n\nconst SharedScenarioView: React.FC<SharedScenarioViewProps> = ({\n    workoutIds,\n    scenarioName,\n    onSaveAsScenario,\n    onBackToApp,\n    userProfile\n}) => {\n    const [workouts, setWorkouts] = useState<WorkoutSelection[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [dynamicMetrics, setDynamicMetrics] = useState({\n        totalDuration: 0,\n        totalElapsedDuration: 0,\n        totalTSS: 0,\n        averageIF: 0,\n        totalNP: 0\n    });\n    const [targetMetrics, setTargetMetrics] = useState({\n        totalTargetTSS: 0,\n        averageTargetIF: 0\n    });\n    const [saveAsName, setSaveAsName] = useState(scenarioName || 'Shared Challenge');\n\n    const findWorkoutTitle = (contentId: string): string => {\n        const workout = allWorkouts.data.library.content.find((item: any) => item.id === contentId);\n        return workout?.name || 'Unknown Workout';\n    };\n\n    useEffect(() => {\n        const loadSharedScenario = async () => {\n            try {\n                console.log('Loading shared scenario with workout IDs:', workoutIds);\n                // Convert workout IDs to WorkoutSelection format\n                const workoutSelections: WorkoutSelection[] = workoutIds.map(id => ({\n                    id,\n                    name: findWorkoutTitle(id),\n                    metrics: null // These will be loaded dynamically\n                }));\n\n                setWorkouts(workoutSelections);\n\n                // Calculate metrics dynamically\n                const metrics = await calculateCombinedMetricsDynamic(workoutSelections, userProfile);\n                setDynamicMetrics(metrics);\n\n                // Calculate target metrics using centralized utility\n                const targetIntensityValue = getTargetIntensity(userProfile);\n                const targetIntensity = targetIntensityValue / 100;\n                const baseTSS = isNaN(metrics.totalTSS) ? 0 : metrics.totalTSS;\n                const baseIF = isNaN(metrics.averageIF) ? 0 : metrics.averageIF;\n                \n                const totalTargetTSS = baseTSS * targetIntensity;\n                const averageTargetIF = baseIF * targetIntensity;\n\n                setTargetMetrics({\n                    totalTargetTSS: isNaN(totalTargetTSS) ? 0 : totalTargetTSS,\n                    averageTargetIF: isNaN(averageTargetIF) ? 0 : averageTargetIF\n                });\n\n                setLoading(false);\n            } catch (error) {\n                console.error('Error loading shared scenario:', error);\n                setLoading(false);\n            }\n        };\n\n        if (workoutIds.length > 0) {\n            loadSharedScenario();\n        }\n    }, [workoutIds, userProfile]);\n\n    const handleSaveAs = () => {\n        if (!saveAsName.trim()) {\n            alert('Please enter a name for your scenario');\n            return;\n        }\n\n        const newScenario: Scenario = {\n            id: generateScenarioId(),\n            name: saveAsName.trim(),\n            workouts,\n            createdAt: new Date().toISOString()\n        };\n\n        onSaveAsScenario?.(newScenario);\n        alert(`Scenario \"${saveAsName}\" has been saved to your collection!`);\n    };\n\n    if (loading) {\n        return (\n            <div className={styles.loadingContainer}>\n                <div className={styles.loadingContent}>\n                    <h2 className={styles.loadingTitle}>Loading shared challenge...</h2>\n                </div>\n            </div>\n        );\n    }\n\n    if (workouts.length === 0) {\n        return (\n            <div className={styles.invalidContainer}>\n                <div className={styles.invalidContent}>\n                    <h2 className={styles.invalidTitle}>Invalid Share Link</h2>\n                    <p className={styles.invalidText}>\n                        This share link appears to be invalid or the workouts could not be loaded.\n                    </p>\n                    <button\n                        onClick={onBackToApp}\n                        className={`${styles.button} ${styles.primaryButton}`}\n                    >\n                        Back to App\n                    </button>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className={styles.container}>\n            {/* Header */}\n            <div className={styles.headerSection}>\n                <div className={styles.headerContainer}>\n                    {/* Back Button */}\n                    <button\n                        onClick={onBackToApp}\n                        className={styles.backButton}\n                    >\n                        ← Back to App\n                    </button>\n\n                    {/* Title and Share Info */}\n                    <div className={styles.shareInfoCard}>\n                        <div className={styles.shareInfoHeader}>\n                            <div className={styles.shareInfoIcon}>🔗</div>\n                            <h1 className={styles.shareInfoTitle}>Shared Challenge: {scenarioName}</h1>\n                        </div>\n                        <p className={styles.shareInfoDescription}>\n                            Someone shared this Knight of Sufferlandria challenge with you. \n                            You can view the workout details and save it to your own collection.\n                        </p>\n\n                        {/* Save As Section */}\n                        <div className={styles.saveAsSection}>\n                            <label className={styles.saveAsLabel}>\n                                Save as:\n                            </label>\n                            <input\n                                type=\"text\"\n                                value={saveAsName}\n                                onChange={(e) => setSaveAsName(e.target.value)}\n                                placeholder=\"Enter scenario name\"\n                                className={styles.saveAsInput}\n                            />\n                            <button\n                                onClick={handleSaveAs}\n                                className={styles.saveAsButton}\n                            >\n                                💾 Save to My Scenarios\n                            </button>\n                        </div>\n                    </div>\n\n                    {/* Metrics Overview */}\n                    <div className={styles.metricsGrid}>\n                        <div className={`${styles.metricCard} ${styles.metricCardDuration}`}>\n                            <div className={`${styles.metricLabel} ${styles.colorDuration}`}>\n                                Total Duration\n                            </div>\n                            <div className={styles.metricValue}>\n                                {formatDuration(dynamicMetrics.totalDuration)}\n                            </div>\n                        </div>\n\n                        <div className={`${styles.metricCard} ${styles.metricCardElapsed}`}>\n                            <div className={`${styles.metricLabel} ${styles.colorElapsed}`}>\n                                Total Elapsed Duration\n                            </div>\n                            <div className={styles.metricValue}>\n                                {formatDuration(dynamicMetrics.totalElapsedDuration)}\n                            </div>\n                            <div className={styles.metricSubtext}>\n                                Includes rest periods\n                            </div>\n                        </div>\n\n                        <div className={`${styles.metricCard} ${styles.metricCardTss}`}>\n                            <div className={`${styles.metricLabel} ${styles.colorTss}`}>\n                                Total TSS®\n                            </div>\n                            <div className={styles.metricValue}>\n                                {Math.round(dynamicMetrics.totalTSS)}\n                            </div>\n                        </div>\n\n                        <div className={`${styles.metricCard} ${styles.metricCardIf}`}>\n                            <div className={`${styles.metricLabel} ${styles.colorIf}`}>\n                                Average IF®\n                            </div>\n                            <div className={styles.metricValue}>\n                                {dynamicMetrics.averageIF.toFixed(2)}\n                            </div>\n                        </div>\n\n                        <div className={`${styles.metricCard} ${styles.metricCardNp}`}>\n                            <div className={`${styles.metricLabel} ${styles.colorNp}`}>\n                                Average NP®\n                            </div>\n                            <div className={styles.metricValue}>\n                                {Math.round(dynamicMetrics.totalNP)}W\n                            </div>\n                        </div>\n\n                        <div className={`${styles.metricCard} ${styles.metricCardTargetTss}`}>\n                            <div className={`${styles.metricLabel} ${styles.colorTargetTss}`}>\n                                Target TSS® ({userProfile.targetIntensity}%)\n                            </div>\n                            <div className={styles.metricValue}>\n                                {Math.round(targetMetrics.totalTargetTSS)}\n                            </div>\n                        </div>\n\n                        <div className={`${styles.metricCard} ${styles.metricCardTargetIf}`}>\n                            <div className={`${styles.metricLabel} ${styles.colorTargetIf}`}>\n                                Target IF® ({userProfile.targetIntensity}%)\n                            </div>\n                            <div className={styles.metricValue}>\n                                {targetMetrics.averageTargetIF.toFixed(2)}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Workout List */}\n            <ReorderableWorkoutList\n                title=\"Arsenal of SUFFERING\"\n                subtitle=\"The 10 instruments of pain in this shared quest (read-only)\"\n                workouts={workouts}\n                onReorder={() => {}} // Read-only, no reordering\n                userProfile={userProfile}\n            />\n        </div>\n    );\n};\n\nexport default SharedScenarioView;","import React from 'react';\nimport { useViewport } from '../hooks/useViewport';\nimport styles from './IntroPage.module.css';\n\ninterface IntroPageProps {\n    onGetStarted: () => void;\n}\n\nconst IntroPage: React.FC<IntroPageProps> = ({ onGetStarted }) => {\n    const viewport = useViewport();\n\n    return (\n        <div className={styles.container}>\n            {/* Hero Section */}\n            <div className={`${styles.heroSection} ${viewport.isMobile ? styles.heroSectionMobile : ''}`}>\n                <h1 className={`${styles.heroTitle} ${viewport.isMobile ? styles.heroTitleMobile : ''}`}>\n                    Assault on the Castle\n                </h1>\n                <p className={`${styles.heroSubtitle} ${viewport.isMobile ? styles.heroSubtitleMobile : ''}`}>\n                    Launch your siege on the fortress in pursuit of KNIGHTHOOD and IMMORTALITY! Plan your quest through 10 instruments of SUFFERING, \n                    analyze the training load, and storm the castle to claim the highest HONOUR in Sufferlandria!\n                </p>\n            </div>\n\n            {/* What is the Challenge Section */}\n            <div className={`${styles.contentCard} ${viewport.isMobile ? styles.contentCardMobile : ''}`}>\n                <h2 className={`${styles.cardTitle} ${viewport.isMobile ? styles.cardTitleMobile : ''}`}>\n                    🏰 The Quest Bestowed by the Ministry of Madness\n                </h2>\n                <p className={styles.cardText}>\n                    There are those who know how to Suffer. And there are those for whom SUFFERING is but a minor annoyance. \n                    To earn the highest HONOUR accorded by the Sufferlandrian Ministry of Madness, one must simply do \n                    <strong> 10 Sufferfest videos back-to-back</strong>, with no more than 10 minutes rest between each instrument of pain.\n                </p>\n                <p className={`${styles.cardText} ${styles.cardTextLast}`}>\n                    This is not merely a test of your physical capabilities in your Bicycle Torture Chamber—it's a trial of mental \n                    fortitude that separates true Sufferlandrians from mere mortals. Only the brave dare attempt it, and even fewer \n                    emerge victorious to bask in eternal GLORY!\n                </p>\n            </div>\n\n            {/* How to Use This App */}\n            <div className={`${styles.contentCard} ${viewport.isMobile ? styles.contentCardMobile : ''}`}>\n                <h2 className={`${styles.cardTitle} ${viewport.isMobile ? styles.cardTitleMobile : ''} ${styles.cardTitleWithSteps}`}>\n                    📱 Your Guide to KNIGHTHOOD\n                </h2>\n                \n                <div className={styles.stepsContainer}>\n                    <div className={styles.stepItem}>\n                        <div className={styles.stepNumber}>1</div>\n                        <div>\n                            <h3 className={styles.stepTitle}>\n                                Assemble Your Arsenal of SUFFERING\n                            </h3>\n                            <p className={styles.stepDescription}>\n                                Use the <strong>\"Plan Quest\"</strong> tab to select 10 instruments of pain from all available \n                                Knighthood workouts. Witness real-time calculations of your impending SUFFERING through TSS and training load.\n                            </p>\n                        </div>\n                    </div>\n\n                    <div className={styles.stepItem}>\n                        <div className={styles.stepNumber}>2</div>\n                        <div>\n                            <h3 className={styles.stepTitle}>\n                                Plot Your Path to GLORY\n                            </h3>\n                            <p className={styles.stepDescription}>\n                                Save different combinations of SUFFERING as scenarios. Compare the pain levels, \n                                share your madness with fellow Sufferlandrians, and find the perfect recipe for KNIGHTHOOD.\n                            </p>\n                        </div>\n                    </div>\n\n                    <div className={styles.stepItem}>\n                        <div className={styles.stepNumber}>3</div>\n                        <div>\n                            <h3 className={styles.stepTitle}>\n                                Perfect Your 4DP Battle Plan\n                            </h3>\n                            <p className={styles.stepDescription}>\n                                Analyze your Four Dimensional Power profile, view detailed breakdowns of each torture session, \n                                and calibrate your power settings to accurately predict the magnitude of SUFFERING ahead.\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Action Buttons */}\n            <div className={`${styles.actionButtons} ${viewport.isMobile ? styles.actionButtonsMobile : ''}`}>\n                <button\n                    data-testid=\"begin-quest-button\"\n                    onClick={onGetStarted}\n                    className={styles.primaryButton}\n                >\n                    ⚔️ Begin Your Assault on the Castle\n                </button>\n                <a\n                    href=\"https://support.wahoofitness.com/hc/en-us/articles/4406074947090-How-to-become-a-Knight-of-Sufferlandria\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className={styles.secondaryButton}\n                >\n                    � Official Rules from the Ministry\n                </a>\n            </div>\n\n        </div>\n    );\n};\n\nexport default IntroPage;","import React from 'react';\nimport styles from './PrivacyPolicyModal.module.css';\n\ninterface PrivacyPolicyModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst PrivacyPolicyModal: React.FC<PrivacyPolicyModalProps> = ({ isOpen, onClose }) => {\n    if (!isOpen) return null;\n\n    return (\n        <div className={styles.overlay}>\n            <div className={styles.modal}>\n                <div className={styles.header}>\n                    <h2 className={styles.title}>Privacy Policy - Workout Scheduling</h2>\n                    <button onClick={onClose} className={styles.closeButton}>\n                        ×\n                    </button>\n                </div>\n\n                <div className={styles.content}>\n                    <div className={styles.section}>\n                        <h3>Your Data Stays Private</h3>\n                        <p>\n                            We take your privacy seriously. When you use our workout scheduling feature, \n                            your credentials and personal data are handled with the utmost care.\n                        </p>\n                    </div>\n\n                    <div className={styles.section}>\n                        <h3>What We Don't Do</h3>\n                        <ul className={styles.list}>\n                            <li><strong>No Storage:</strong> We never store your Wahoo Systm username or password</li>\n                            <li><strong>No Tracking:</strong> We don't track or log your credentials</li>\n                            <li><strong>No Sharing:</strong> We don't share your data with any third parties</li>\n                            <li><strong>No Databases:</strong> Your credentials never touch our servers or databases</li>\n                        </ul>\n                    </div>\n\n                    <div className={styles.section}>\n                        <h3>How It Works</h3>\n                        <p>\n                            When you enter your Wahoo Systm credentials:\n                        </p>\n                        <ol className={styles.list}>\n                            <li>Your credentials are kept only in your browser's memory</li>\n                            <li>We connect directly from your browser to Wahoo Systm's API</li>\n                            <li>We schedule your workouts using Wahoo's official endpoints</li>\n                            <li>Your credentials are immediately cleared from memory after use</li>\n                            <li>The connection is encrypted end-to-end</li>\n                        </ol>\n                    </div>\n\n                    <div className={styles.section}>\n                        <h3>Technical Details</h3>\n                        <p>\n                            This application runs entirely in your browser. Your Wahoo Systm credentials \n                            are sent directly to <code>api.thesufferfest.com</code> using their official \n                            GraphQL endpoints. We act only as a pass-through - your data never stops \n                            at our servers.\n                        </p>\n                    </div>\n\n                    <div className={styles.section}>\n                        <h3>Open Source</h3>\n                        <p>\n                            This application is open source. You can inspect the code to verify that \n                            we handle your data exactly as described in this policy. Look for the \n                            <code>systmApi.ts</code> service and <code>WorkoutSchedulingModal.tsx</code> \n                            component to see exactly how your credentials are processed.\n                        </p>\n                    </div>\n\n                    <div className={styles.disclaimer}>\n                        <p>\n                            <strong>Note:</strong> This application is not affiliated with Wahoo Fitness. \n                            Wahoo, Systm, and The Sufferfest are trademarks of Wahoo Fitness LLC.\n                        </p>\n                    </div>\n                </div>\n\n                <div className={styles.footer}>\n                    <button onClick={onClose} className={styles.okButton}>\n                        I Understand\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default PrivacyPolicyModal;","import React, { useState } from 'react';\nimport { useViewport } from '../hooks/useViewport';\nimport PrivacyPolicyModal from './PrivacyPolicyModal';\nimport styles from './Footer.module.css';\n\nconst Footer: React.FC = () => {\n    const viewport = useViewport();\n    const [showPrivacyPolicy, setShowPrivacyPolicy] = useState(false);\n\n    return (\n        <div className={styles.footer}>\n            <p className={styles.footerTitle}>\n                <strong>Helpful Resources:</strong>\n            </p>\n            <div className={`${styles.linksContainer} ${viewport.isMobile ? styles.linksContainerMobile : styles.linksContainerDesktop}`}>\n                <a \n                    href=\"https://wahooligan.com/\" \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className={styles.footerLink}\n                >\n                    Wahooligan Community\n                </a>\n                <a \n                    href=\"https://systm.wahoofitness.com/\" \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className={styles.footerLink}\n                >\n                    SYSTM Training App\n                </a>\n                <a \n                    href=\"https://support.wahoofitness.com/hc/en-us/articles/360021387420-Learn-about-4DP\" \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className={styles.footerLink}\n                >\n                    4DP Power Profile\n                </a>\n                <a \n                    href=\"https://github.com/againstdemons84/knighthood-quests/issues\" \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className={styles.footerLink}\n                >\n                    Raise an Issue\n                </a>\n                <a \n                    href=\"https://github.com/againstdemons84/knighthood-quests/\" \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className={styles.footerLink}\n                >\n                    Contribute on GitHub\n                </a>\n                <button\n                    onClick={() => setShowPrivacyPolicy(true)}\n                    className={styles.privacyButton}\n                >\n                    Privacy Policy\n                </button>\n            </div>\n\n            <PrivacyPolicyModal \n                isOpen={showPrivacyPolicy} \n                onClose={() => setShowPrivacyPolicy(false)} \n            />\n        </div>\n    );\n};\n\nexport default Footer;","import { useNavigate, useLocation, useParams } from 'react-router-dom';\n\nexport type AppPage = 'intro' | 'selector' | 'scenarios' | 'scenario-detail' | 'profile-setup' | 'profile-manager' | 'profile' | 'shared-scenario';\n\ninterface UseAppRoutingResult {\n    currentPage: AppPage;\n    scenarioId: string | null;\n    sharedScenarioData: { workoutIds: string[]; name: string } | null;\n    setPage: (page: AppPage, scenarioId?: string) => void;\n}\n\nexport const useAppRouting = (): UseAppRoutingResult => {\n    const navigate = useNavigate();\n    const location = useLocation();\n    const params = useParams();\n\n    // Determine current page from pathname\n    const getCurrentPage = (): AppPage => {\n        const path = location.pathname;\n        \n        if (path === '/' || path === '') {\n            return 'intro';\n        } else if (path === '/plan') {\n            return 'selector';\n        } else if (path === '/scenarios') {\n            return 'scenarios';\n        } else if (path === '/profile') {\n            return 'profile';\n        } else if (path.startsWith('/scenario/')) {\n            return 'scenario-detail';\n        } else if (path.startsWith('/share/')) {\n            return 'shared-scenario';\n        }\n        \n        return 'intro';\n    };\n\n    // Get scenario ID from URL params\n    const getScenarioId = (): string | null => {\n        if (params.scenarioId) {\n            return params.scenarioId;\n        }\n        return null;\n    };\n\n    // Parse shared scenario data from URL search params\n    const getSharedScenarioData = (): { workoutIds: string[]; name: string } | null => {\n        if (location.pathname.startsWith('/share/')) {\n            const searchParams = new URLSearchParams(location.search);\n            const workoutsParam = searchParams.get('workouts');\n            const nameParam = searchParams.get('name');\n            \n            if (workoutsParam && nameParam) {\n                try {\n                    const workoutIds = workoutsParam.split(',');\n                    return {\n                        workoutIds,\n                        name: decodeURIComponent(nameParam)\n                    };\n                } catch (error) {\n                    console.error('Error parsing shared scenario data:', error);\n                }\n            }\n        }\n        return null;\n    };\n\n    const setPage = (page: AppPage, scenarioId?: string) => {\n        switch (page) {\n            case 'intro':\n                navigate('/');\n                break;\n            case 'selector':\n                navigate('/plan');\n                break;\n            case 'scenarios':\n                navigate('/scenarios');\n                break;\n            case 'profile':\n                navigate('/profile');\n                break;\n            case 'scenario-detail':\n                if (scenarioId) {\n                    navigate(`/scenario/${scenarioId}`);\n                } else {\n                    navigate('/scenarios');\n                }\n                break;\n            default:\n                navigate('/');\n                break;\n        }\n    };\n\n    return {\n        currentPage: getCurrentPage(),\n        scenarioId: getScenarioId(),\n        sharedScenarioData: getSharedScenarioData(),\n        setPage\n    };\n};","// Wahoo Systm API Service for authentication and workout scheduling\n\ninterface AppInformation {\n    platform: string;\n    version: string;\n    installId: string;\n}\n\ninterface LoginRequest {\n    operationName: string;\n    variables: {\n        appInformation: AppInformation;\n        username: string;\n        password: string;\n    };\n    query: string;\n}\n\ninterface LoginResponse {\n    data: {\n        loginUser: {\n            status: string;\n            message: string;\n            token: string;\n            failureId: string | null;\n            __typename: string;\n        };\n    };\n}\n\ninterface ScheduleRequest {\n    operationName: string;\n    variables: {\n        contentId: string;\n        date: string;\n        timeZone: string;\n        rank: number;\n    };\n    query: string;\n}\n\ninterface ScheduleResponse {\n    data: {\n        addAgenda: {\n            status: string;\n            message: string | null;\n            agendaId: string;\n            __typename: string;\n        };\n    };\n}\n\nexport interface SystmCredentials {\n    username: string;\n    password: string;\n}\n\nexport interface WorkoutScheduleItem {\n    contentId: string;\n    date: string; // ISO string\n    timeZone: string;\n    rank: number;\n}\n\nexport class SystmApiError extends Error {\n    constructor(message: string, public readonly code?: string) {\n        super(message);\n        this.name = 'SystmApiError';\n    }\n}\n\nclass SystmApiService {\n    private readonly endpoint = 'https://api.thesufferfest.com/graphql';\n    private readonly appInfo: AppInformation = {\n        platform: 'web',\n        version: '7.101.1-web.3480-7-g4802ce80',\n        installId: '7BC7E6377390574C8E6C95782C087C7A' // TODO: Generate unique per session if needed\n    };\n\n    private readonly loginQuery = `\n        mutation Login($appInformation: AppInformation!, $username: String!, $password: String!) {\n            loginUser(\n                appInformation: $appInformation\n                username: $username\n                password: $password\n            ) {\n                status\n                message\n                token\n                failureId\n                __typename\n            }\n        }\n    `;\n\n    private readonly scheduleQuery = `\n        mutation AddUserPlanItem($contentId: ID!, $date: Date!, $timeZone: TimeZone!, $rank: Int) {\n            addAgenda(contentId: $contentId, date: $date, timeZone: $timeZone, rank: $rank) {\n                status\n                message\n                agendaId\n                __typename\n            }\n        }\n    `;\n\n    private getHeaders(authToken?: string): HeadersInit {\n        const headers: HeadersInit = {\n            'Content-Type': 'application/json',\n            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36',\n            'Referer': 'https://systm.wahoofitness.com/',\n            'DNT': '1',\n            'sec-ch-ua-platform': '\"macOS\"',\n            'sec-ch-ua': '\"Chromium\";v=\"142\", \"Google Chrome\";v=\"142\", \"Not_A Brand\";v=\"99\"',\n            'sec-ch-ua-mobile': '?0',\n            'accept': '*/*'\n        };\n\n        if (authToken) {\n            headers['authorization'] = `Bearer ${authToken}`;\n        }\n\n        return headers;\n    }\n\n    /**\n     * Authenticate user and get access token\n     */\n    async authenticate(credentials: SystmCredentials): Promise<string> {\n        const request: LoginRequest = {\n            operationName: 'Login',\n            variables: {\n                appInformation: this.appInfo,\n                username: credentials.username,\n                password: credentials.password\n            },\n            query: this.loginQuery\n        };\n\n        try {\n            const response = await fetch(this.endpoint, {\n                method: 'POST',\n                headers: this.getHeaders(),\n                body: JSON.stringify(request)\n            });\n\n            if (!response.ok) {\n                throw new SystmApiError(\n                    `HTTP ${response.status}: ${response.statusText}`,\n                    'HTTP_ERROR'\n                );\n            }\n\n            const data: LoginResponse = await response.json();\n\n            // Check for GraphQL errors\n            if (!data.data?.loginUser) {\n                throw new SystmApiError('Invalid response format', 'INVALID_RESPONSE');\n            }\n\n            const loginResult = data.data.loginUser;\n\n            if (loginResult.status !== 'Success') {\n                throw new SystmApiError(\n                    loginResult.message || 'Authentication failed',\n                    'AUTH_FAILED'\n                );\n            }\n\n            if (loginResult.failureId) {\n                throw new SystmApiError(\n                    `Authentication failed: ${loginResult.failureId}`,\n                    'AUTH_FAILED'\n                );\n            }\n\n            if (!loginResult.token) {\n                throw new SystmApiError('No token received', 'NO_TOKEN');\n            }\n\n            return loginResult.token;\n        } catch (error) {\n            if (error instanceof SystmApiError) {\n                throw error;\n            }\n\n            // Handle network errors\n            if (error instanceof TypeError && error.message.includes('fetch')) {\n                throw new SystmApiError(\n                    'Unable to connect to Wahoo Systm. Please check your internet connection.',\n                    'NETWORK_ERROR'\n                );\n            }\n\n            throw new SystmApiError(\n                `Unexpected error: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                'UNKNOWN_ERROR'\n            );\n        }\n    }\n\n    /**\n     * Schedule a single workout\n     */\n    async scheduleWorkout(\n        authToken: string,\n        scheduleItem: WorkoutScheduleItem\n    ): Promise<string> {\n        const request: ScheduleRequest = {\n            operationName: 'AddUserPlanItem',\n            variables: {\n                contentId: scheduleItem.contentId,\n                date: scheduleItem.date,\n                timeZone: scheduleItem.timeZone,\n                rank: scheduleItem.rank\n            },\n            query: this.scheduleQuery\n        };\n\n        try {\n            const response = await fetch(this.endpoint, {\n                method: 'POST',\n                headers: this.getHeaders(authToken),\n                body: JSON.stringify(request)\n            });\n\n            if (!response.ok) {\n                throw new SystmApiError(\n                    `HTTP ${response.status}: ${response.statusText}`,\n                    'HTTP_ERROR'\n                );\n            }\n\n            const data: ScheduleResponse = await response.json();\n\n            // Check for GraphQL errors\n            if (!data.data?.addAgenda) {\n                throw new SystmApiError('Invalid response format', 'INVALID_RESPONSE');\n            }\n\n            const scheduleResult = data.data.addAgenda;\n\n            if (scheduleResult.status !== 'Success') {\n                throw new SystmApiError(\n                    scheduleResult.message || 'Scheduling failed',\n                    'SCHEDULE_FAILED'\n                );\n            }\n\n            if (!scheduleResult.agendaId) {\n                throw new SystmApiError('No agenda ID received', 'NO_AGENDA_ID');\n            }\n\n            return scheduleResult.agendaId;\n        } catch (error) {\n            if (error instanceof SystmApiError) {\n                throw error;\n            }\n\n            // Handle network errors\n            if (error instanceof TypeError && error.message.includes('fetch')) {\n                throw new SystmApiError(\n                    'Unable to connect to Wahoo Systm. Please check your internet connection.',\n                    'NETWORK_ERROR'\n                );\n            }\n\n            throw new SystmApiError(\n                `Unexpected error: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                'UNKNOWN_ERROR'\n            );\n        }\n    }\n\n    /**\n     * Get user's timezone (browser timezone as default)\n     */\n    getUserTimeZone(): string {\n        try {\n            return Intl.DateTimeFormat().resolvedOptions().timeZone;\n        } catch {\n            return 'UTC'; // Fallback\n        }\n    }\n}\n\n// Export singleton instance\nexport const systmApi = new SystmApiService();","// Utility functions for workout scheduling\n\nimport { WorkoutSelection } from '../types/scenario';\n\ninterface WorkoutMetadata {\n    id: string;\n    contentId: string;\n    workoutId: string;\n    workoutName: string;\n    fetchedAt: string;\n    source: string;\n}\n\ninterface WorkoutData {\n    data: any; // Workout graph data\n    metadata: WorkoutMetadata;\n}\n\n/**\n * Load workout data from JSON file and extract metadata\n */\nasync function loadWorkoutData(workoutId: string): Promise<WorkoutData | null> {\n    try {\n        const response = await fetch(`/data/workout-data/${workoutId}.json`);\n        if (!response.ok) {\n            console.warn(`Failed to load workout data for ${workoutId}`);\n            return null;\n        }\n        return await response.json();\n    } catch (error) {\n        console.warn(`Error loading workout data for ${workoutId}:`, error);\n        return null;\n    }\n}\n\n/**\n * Get contentId from workout selection by loading its metadata\n */\nexport async function getWorkoutContentId(workout: WorkoutSelection): Promise<string | null> {\n    const data = await loadWorkoutData(workout.id);\n    return data?.metadata?.contentId || null;\n}\n\n/**\n * Load contentIds for all workouts in a scenario\n */\nexport async function loadWorkoutContentIds(workouts: WorkoutSelection[]): Promise<Map<string, string>> {\n    const contentIdMap = new Map<string, string>();\n    \n    // Load all workout data in parallel\n    const loadPromises = workouts.map(async (workout) => {\n        const contentId = await getWorkoutContentId(workout);\n        if (contentId) {\n            contentIdMap.set(workout.id, contentId);\n        }\n        return { workoutId: workout.id, contentId };\n    });\n\n    const results = await Promise.all(loadPromises);\n    \n    // Log any missing contentIds\n    const missing = results.filter(r => !r.contentId);\n    if (missing.length > 0) {\n        console.warn('Missing contentIds for workouts:', missing.map(r => r.workoutId));\n    }\n\n    return contentIdMap;\n}\n\n/**\n * Generate schedule items with proper contentIds and timing\n */\nexport async function generateScheduleItems(\n    workouts: WorkoutSelection[],\n    startDate: string,\n    timeZone: string\n): Promise<Array<{\n    workout: WorkoutSelection;\n    contentId: string;\n    scheduledTime: string;\n    rank: number;\n}>> {\n    const contentIdMap = await loadWorkoutContentIds(workouts);\n    const scheduleItems = [];\n\n    for (let i = 0; i < workouts.length; i++) {\n        const workout = workouts[i];\n        let contentId = contentIdMap.get(workout.id);\n        \n        // Fallback: use workout.id if contentId not found\n        if (!contentId) {\n            console.warn(`Using fallback contentId for workout ${workout.name} (${workout.id})`);\n            contentId = workout.id;\n        }\n\n        // Create date with hour increment (ensure proper timezone handling)\n        const date = new Date(startDate + 'T00:00:00');\n        date.setHours(1 + i, 0, 0, 0); // Start at 01:00, increment by 1 hour\n\n        scheduleItems.push({\n            workout,\n            contentId,\n            scheduledTime: date.toISOString(),\n            rank: 100 + i\n        });\n    }\n\n    return scheduleItems;\n}\n\n/**\n * Format time for display (HH:MM format)\n */\nexport function formatTime(isoString: string): string {\n    if (!isoString) return '--:--';\n    \n    const date = new Date(isoString);\n    \n    // Check if date is valid\n    if (isNaN(date.getTime())) {\n        return '--:--';\n    }\n    \n    return date.toLocaleTimeString('en-US', { \n        hour: '2-digit', \n        minute: '2-digit', \n        hour12: false \n    });\n}\n\n/**\n * Format date for display\n */\nexport function formatDate(isoString: string): string {\n    if (!isoString) return 'Unknown Date';\n    \n    const date = new Date(isoString);\n    \n    // Check if date is valid\n    if (isNaN(date.getTime())) {\n        return 'Invalid Date';\n    }\n    \n    return date.toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n    });\n}","import React, { useState } from 'react';\nimport { Scenario, WorkoutSelection } from '../types/scenario';\nimport { systmApi, SystmApiError } from '../services/systmApi';\nimport { generateScheduleItems, formatTime, formatDate } from '../utils/workoutScheduling';\nimport PrivacyPolicyModal from './PrivacyPolicyModal';\nimport styles from './WorkoutSchedulingModal.module.css';\n\ninterface WorkoutSchedulingModalProps {\n    scenario: Scenario;\n    isOpen: boolean;\n    onClose: () => void;\n}\n\ninterface FormData {\n    username: string;\n    password: string;\n    startDate: string;\n}\n\ninterface ScheduleItem {\n    workout: WorkoutSelection;\n    contentId: string;\n    scheduledTime: string;\n    rank: number;\n}\n\ntype ModalStep = 'form' | 'validating' | 'confirmation' | 'scheduling' | 'results';\n\ninterface ScheduleResult {\n    workout: WorkoutSelection;\n    success: boolean;\n    error?: string;\n    agendaId?: string;\n}\n\nconst WorkoutSchedulingModal: React.FC<WorkoutSchedulingModalProps> = ({\n    scenario,\n    isOpen,\n    onClose\n}) => {\n    const [currentStep, setCurrentStep] = useState<ModalStep>('form');\n    const [formData, setFormData] = useState<FormData>({\n        username: '',\n        password: '',\n        startDate: ''\n    });\n    const [authToken, setAuthToken] = useState<string>('');\n    const [scheduleItems, setScheduleItems] = useState<ScheduleItem[]>([]);\n    const [results, setResults] = useState<ScheduleResult[]>([]);\n    const [error, setError] = useState<string>('');\n    const [showPrivacyPolicy, setShowPrivacyPolicy] = useState<boolean>(false);\n\n\n\n    const handleFormSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        \n        if (!formData.username || !formData.password || !formData.startDate) {\n            setError('Please fill in all fields');\n            return;\n        }\n\n        setError('');\n        setCurrentStep('validating');\n\n        try {\n            // Authenticate with Wahoo Systm\n            const token = await systmApi.authenticate({\n                username: formData.username,\n                password: formData.password\n            });\n            setAuthToken(token);\n            \n            // Generate schedule items with real contentIds\n            const timeZone = systmApi.getUserTimeZone();\n            console.log('Generating schedule items for date:', formData.startDate, 'timezone:', timeZone);\n            const items = await generateScheduleItems(scenario.workouts, formData.startDate, timeZone);\n            console.log('Generated schedule items:', items);\n            setScheduleItems(items);\n            \n            if (items.length === 0) {\n                throw new Error('No workouts could be scheduled. Please check that workout data is available.');\n            }\n            \n            setCurrentStep('confirmation');\n        } catch (err) {\n            const errorMessage = err instanceof SystmApiError \n                ? err.message \n                : err instanceof Error \n                ? err.message\n                : 'Authentication failed. Please check your credentials.';\n            setError(errorMessage);\n            setCurrentStep('form');\n        }\n    };\n\n    const handleConfirmScheduling = async () => {\n        setCurrentStep('scheduling');\n        const scheduleResults: ScheduleResult[] = [];\n        const timeZone = systmApi.getUserTimeZone();\n\n        for (const item of scheduleItems) {\n            try {\n                const agendaId = await systmApi.scheduleWorkout(authToken, {\n                    contentId: item.contentId,\n                    date: item.scheduledTime,\n                    timeZone: timeZone,\n                    rank: item.rank\n                });\n                \n                scheduleResults.push({\n                    workout: item.workout,\n                    success: true,\n                    agendaId: agendaId\n                });\n            } catch (err) {\n                const errorMessage = err instanceof SystmApiError \n                    ? err.message \n                    : 'Unknown scheduling error';\n                    \n                scheduleResults.push({\n                    workout: item.workout,\n                    success: false,\n                    error: errorMessage\n                });\n            }\n        }\n\n        setResults(scheduleResults);\n        setCurrentStep('results');\n        \n        // Clear sensitive data from memory\n        setFormData(prev => ({ ...prev, password: '' }));\n        setAuthToken('');\n    };\n\n    const handleClose = () => {\n        // Clear all data including sensitive information\n        setFormData({ username: '', password: '', startDate: '' });\n        setAuthToken('');\n        setScheduleItems([]);\n        setResults([]);\n        setError('');\n        setCurrentStep('form');\n        onClose();\n    };\n\n\n\n    if (!isOpen) return null;\n\n    return (\n        <div className={styles.overlay}>\n            <div className={styles.modal}>\n                <div className={styles.header}>\n                    <h2 className={styles.title}>\n                        Schedule Workouts in Wahoo Systm\n                    </h2>\n                    <button onClick={handleClose} className={styles.closeButton}>\n                        ×\n                    </button>\n                </div>\n\n                <div className={styles.content}>\n                    {currentStep === 'form' && (\n                        <form onSubmit={handleFormSubmit} className={styles.form}>\n                            <p className={styles.description}>\n                                Schedule your \"{scenario.name}\" workouts in your Wahoo Systm calendar.\n                            </p>\n                            \n                            {error && (\n                                <div className={styles.error}>\n                                    {error}\n                                </div>\n                            )}\n\n                            <div className={styles.field}>\n                                <label htmlFor=\"username\" className={styles.label}>\n                                    Wahoo Systm Username (Email)\n                                </label>\n                                <input\n                                    type=\"email\"\n                                    id=\"username\"\n                                    value={formData.username}\n                                    onChange={(e) => setFormData(prev => ({ ...prev, username: e.target.value }))}\n                                    className={styles.input}\n                                    required\n                                    autoComplete=\"email\"\n                                />\n                            </div>\n\n                            <div className={styles.field}>\n                                <label htmlFor=\"password\" className={styles.label}>\n                                    Wahoo Systm Password\n                                </label>\n                                <input\n                                    type=\"password\"\n                                    id=\"password\"\n                                    value={formData.password}\n                                    onChange={(e) => setFormData(prev => ({ ...prev, password: e.target.value }))}\n                                    className={styles.input}\n                                    required\n                                    autoComplete=\"current-password\"\n                                />\n                            </div>\n\n                            <div className={styles.privacyNotice}>\n                                <p className={styles.privacyText}>\n                                    🔒 Your credentials are sent directly to Wahoo Systm and never stored on our servers.\n                                </p>\n                                <button\n                                    type=\"button\"\n                                    onClick={() => setShowPrivacyPolicy(true)}\n                                    className={styles.privacyLink}\n                                >\n                                    Learn more about our privacy practices\n                                </button>\n                            </div>\n\n                            <div className={styles.field}>\n                                <label htmlFor=\"startDate\" className={styles.label}>\n                                    Schedule Date\n                                </label>\n                                <input\n                                    type=\"date\"\n                                    id=\"startDate\"\n                                    value={formData.startDate}\n                                    onChange={(e) => setFormData(prev => ({ ...prev, startDate: e.target.value }))}\n                                    className={styles.input}\n                                    required\n                                />\n                            </div>\n\n                            <div className={styles.actions}>\n                                <button type=\"button\" onClick={handleClose} className={styles.cancelButton}>\n                                    Cancel\n                                </button>\n                                <button type=\"submit\" className={styles.submitButton}>\n                                    Validate & Continue\n                                </button>\n                            </div>\n                        </form>\n                    )}\n\n                    {currentStep === 'validating' && (\n                        <div className={styles.loading}>\n                            <div className={styles.spinner}></div>\n                            <p>Validating your credentials...</p>\n                        </div>\n                    )}\n\n                    {currentStep === 'confirmation' && (\n                        <div className={styles.confirmation}>\n                            <h3>Confirm Your Workout Schedule</h3>\n                            <p className={styles.confirmDescription}>\n                                The following workouts will be scheduled on {scheduleItems.length > 0 ? formatDate(scheduleItems[0].scheduledTime) : formData.startDate}:\n                            </p>\n                            \n                            <div className={styles.scheduleList}>\n                                {scheduleItems.map((item, index) => (\n                                    <div key={index} className={styles.scheduleItem}>\n                                        <span className={styles.workoutName}>{item.workout.name}</span>\n                                        <span className={styles.scheduledTime}>{formatTime(item.scheduledTime)}</span>\n                                    </div>\n                                ))}\n                            </div>\n\n                            <div className={styles.actions}>\n                                <button onClick={() => setCurrentStep('form')} className={styles.cancelButton}>\n                                    Back to Form\n                                </button>\n                                <button onClick={handleConfirmScheduling} className={styles.confirmButton}>\n                                    Schedule Workouts\n                                </button>\n                            </div>\n                        </div>\n                    )}\n\n                    {currentStep === 'scheduling' && (\n                        <div className={styles.loading}>\n                            <div className={styles.spinner}></div>\n                            <p>Scheduling your workouts...</p>\n                            <p className={styles.loadingNote}>Please wait, this may take a few moments.</p>\n                        </div>\n                    )}\n\n                    {currentStep === 'results' && (\n                        <div className={styles.results}>\n                            <h3>Scheduling Complete</h3>\n                            \n                            {results.every(r => r.success) ? (\n                                <div className={styles.successMessage}>\n                                    ✅ All {results.length} workouts were successfully scheduled!\n                                </div>\n                            ) : (\n                                <div className={styles.partialMessage}>\n                                    ⚠️ {results.filter(r => r.success).length} of {results.length} workouts were scheduled successfully.\n                                </div>\n                            )}\n\n                            <div className={styles.resultsList}>\n                                {results.map((result, index) => (\n                                    <div \n                                        key={index} \n                                        className={`${styles.resultItem} ${result.success ? styles.resultSuccess : styles.resultError}`}\n                                    >\n                                        <span className={styles.resultWorkout}>{result.workout.name}</span>\n                                        <span className={styles.resultStatus}>\n                                            {result.success ? '✅ Scheduled' : '❌ Failed'}\n                                        </span>\n                                        {result.error && (\n                                            <span className={styles.resultError}>\n                                                {result.error}\n                                            </span>\n                                        )}\n                                    </div>\n                                ))}\n                            </div>\n\n                            <div className={styles.actions}>\n                                <button onClick={handleClose} className={styles.doneButton}>\n                                    Done\n                                </button>\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            <PrivacyPolicyModal \n                isOpen={showPrivacyPolicy} \n                onClose={() => setShowPrivacyPolicy(false)} \n            />\n        </div>\n    );\n};\n\nexport default WorkoutSchedulingModal;","import React, { useState, useEffect } from 'react';\nimport { Scenario, WorkoutSelection } from '../types/scenario';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { formatDuration, calculateCombinedMetricsDynamic, loadScenarios, saveScenarios } from '../utils/scenarioHelpers';\nimport ReorderableWorkoutList from './ReorderableWorkoutList';\nimport ScenarioComparison from './ScenarioComparison';\nimport { useViewport } from '../hooks/useViewport';\nimport PrintQuestModal from './PrintQuestModal';\nimport WorkoutSchedulingModal from './WorkoutSchedulingModal';\nimport styles from './ScenarioDetailsView.module.css';\nimport { getTargetIntensity } from '../utils/targetIntensityUtils';\n(window as any).DEBUG_TEST = 'ScenarioDetailsView loaded at ' + new Date().toISOString();\n\ninterface ScenarioDetailsViewProps {\n    scenario: Scenario;\n    userProfile: UserPowerProfile;\n    onBack: () => void;\n    onScenarioUpdate?: (updatedScenario: Scenario) => void;\n}\n\n\n\nconst ScenarioDetailsView: React.FC<ScenarioDetailsViewProps> = ({\n    scenario,\n    userProfile,\n    onBack,\n    onScenarioUpdate\n}) => {\n    const viewport = useViewport();\n    const [loading, setLoading] = useState(true);\n    const [currentScenario, setCurrentScenario] = useState<Scenario>(scenario);\n    const [dynamicMetrics, setDynamicMetrics] = useState({\n        totalDuration: 0,\n        totalElapsedDuration: 0,\n        totalTSS: 0,\n        averageIF: 0,\n        totalNP: 0\n    });\n    const [targetMetrics, setTargetMetrics] = useState({\n        totalTargetTSS: 0,\n        averageTargetIF: 0,\n        totalTargetNP: 0\n    });\n    const [showPrintModal, setShowPrintModal] = useState(false);\n    const [showSchedulingModal, setShowSchedulingModal] = useState(false);\n    const [honourStage, setHonourStage] = useState(0); // 0: Honour, 1: Glory, 2: Victory, 3: trigger form\n    \n    // Computed value for target intensity display\n    const targetIntensityValue = getTargetIntensity(userProfile);\n\n    const handleHonourClick = () => {\n        if (honourStage < 2) {\n            setHonourStage(honourStage + 1);\n        } else {\n            // Stage 2 (Victory) -> trigger the form\n            setShowSchedulingModal(true);\n            setHonourStage(0); // Reset for next time\n        }\n    };\n\n    const getHonourButtonText = () => {\n        switch (honourStage) {\n            case 0: return 'Honour!';\n            case 1: return 'Glory!';\n            case 2: return 'Victory!';\n            default: return 'Honour!';\n        }\n    };\n\n    const handleWorkoutReorder = (reorderedWorkouts: WorkoutSelection[]) => {\n        const updatedScenario: Scenario = {\n            ...scenario,\n            workouts: reorderedWorkouts\n        };\n\n        // Update current scenario state for charts\n        setCurrentScenario(updatedScenario);\n\n        // Save to localStorage\n        const allScenarios = loadScenarios();\n        const scenarioIndex = allScenarios.findIndex(s => s.id === scenario.id);\n        \n        if (scenarioIndex >= 0) {\n            allScenarios[scenarioIndex] = updatedScenario;\n            saveScenarios(allScenarios);\n            \n            // Notify parent component if callback provided\n            if (onScenarioUpdate) {\n                onScenarioUpdate(updatedScenario);\n            }\n        }\n    };\n\n    useEffect(() => {\n        setCurrentScenario(scenario);\n    }, [scenario]);\n\n    useEffect(() => {\n        const loadScenarioMetrics = async () => {\n            // Don't calculate metrics if userProfile isn't properly loaded yet\n            if (!userProfile || !userProfile.ftp) {\n                setLoading(false);\n                return;\n            }\n            \n            // Calculate dynamic metrics for the scenario\n            try {\n                const calculatedMetrics = await calculateCombinedMetricsDynamic(scenario.workouts, userProfile);\n                \n\n                \n                setDynamicMetrics(calculatedMetrics);\n\n                // Calculate target metrics using centralized utility\n                const targetIntensityValue = getTargetIntensity(userProfile);\n                const targetIntensityDecimal = targetIntensityValue / 100;\n                \n\n                \n                // For target metrics, we need to recalculate with adjusted intensity\n                // TSS = IF² × duration_hours × 100, so with target intensity:\n                // Target IF = base IF × target intensity ratio\n                const baseIF = isNaN(calculatedMetrics.averageIF) ? 0 : calculatedMetrics.averageIF;\n                const baseNP = isNaN(calculatedMetrics.totalNP) ? 0 : calculatedMetrics.totalNP;\n                const baseDuration = isNaN(calculatedMetrics.totalDuration) ? 0 : calculatedMetrics.totalDuration;\n                \n                const targetIF = baseIF * targetIntensityDecimal;\n                const targetNP = baseNP * targetIntensityDecimal;\n                const durationHours = baseDuration / 3600;\n                const targetTSS = Math.pow(targetIF, 2) * durationHours * 100;\n\n                const totalTargetTSS = !isFinite(targetTSS) ? 0 : Math.round(targetTSS);\n                const averageTargetIF = !isFinite(targetIF) ? 0 : Math.round(targetIF * 100) / 100;\n                const totalTargetNP = !isFinite(targetNP) ? 0 : Math.round(targetNP);\n                \n\n\n                setTargetMetrics({\n                    totalTargetTSS,\n                    averageTargetIF,\n                    totalTargetNP\n                });\n            } catch (error) {\n                console.error('Error calculating dynamic metrics:', error);\n                // Keep default zero values on error\n            }\n            \n            setLoading(false);\n        };\n\n        loadScenarioMetrics();\n    }, [scenario, userProfile]);\n\n    if (loading) {\n        return (\n            <div className={styles.loadingContainer}>\n                <div className={styles.loadingContent}>\n                    <h1 className={styles.loadingTitle}>Loading Scenario Details...</h1>\n                    <p className={styles.loadingText}>Loading workout data for \"{scenario.name}\"...</p>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className={`${styles.container} ${viewport.isMobile ? styles.containerMobile : styles.containerDesktop}`}>\n            {/* Header with Back Button */}\n            <div className={`${styles.headerContainer} ${viewport.isMobile ? styles.headerContainerMobile : styles.headerContainerDesktop}`}>\n                <div className={`${styles.buttonContainer} ${viewport.isMobile ? styles.buttonContainerMobile : styles.buttonContainerDesktop}`}>\n                    <button \n                        data-testid=\"back-button\"\n                        onClick={onBack}\n                        className={`${styles.button} ${styles.backButton} ${viewport.isMobile ? styles.buttonMobile : styles.buttonDesktop}`}\n                    >\n                        ← Back\n                    </button>\n                    <button\n                        onClick={() => setShowPrintModal(true)}\n                        className={`${styles.button} ${styles.printButton} ${viewport.isMobile ? styles.buttonMobile : styles.buttonDesktop}`}\n                    >\n                        🖨️ Print Quest Plan\n                    </button>\n                    <button\n                        onClick={handleHonourClick}\n                        className={`${styles.button} ${styles.honourButton} ${viewport.isMobile ? styles.buttonMobile : styles.buttonDesktop}`}\n                    >\n                        ⚔️ {getHonourButtonText()}\n                    </button>\n                </div>\n\n                {/* Scenario Title and Description */}\n                <div className={viewport.isMobile ? styles.titleSectionMobile : styles.titleSectionDesktop}>\n                    <h1 className={`${styles.title} ${viewport.isMobile ? styles.titleMobile : styles.titleDesktop}`}>\n                        {scenario.name} - Arsenal of SUFFERING\n                    </h1>\n                    <p className={`${styles.subtitle} ${viewport.isMobile ? styles.subtitleMobile : styles.subtitleDesktop}`}>\n                        Drag and drop to reorder your {scenario.workouts.length} instruments of pain for KNIGHTHOOD\n                    </p>\n                </div>\n\n                {/* Scenario Summary Cards */}\n                <div className={`${styles.metricsGrid} ${viewport.isMobile ? styles.metricsGridMobile : styles.metricsGridDesktop}`}>\n                    <div className={`${styles.metricCard} ${styles.metricCardDuration} ${viewport.isMobile ? styles.metricCardMobile : styles.metricCardDesktop}`}>\n                        <div className={`${styles.metricLabel} ${styles.colorDuration} ${viewport.isMobile ? styles.metricLabelMobile : styles.metricLabelDesktop}`}>\n                            Duration\n                        </div>\n                        <div className={`${styles.metricValue} ${viewport.isMobile ? styles.metricValueMobile : styles.metricValueDesktop}`}>\n                            {formatDuration(dynamicMetrics.totalDuration)}\n                        </div>\n                    </div>\n\n                    {!viewport.isMobile && (\n                        <div className={`${styles.metricCard} ${styles.metricCardElapsed} ${styles.metricCardDesktop}`}>\n                            <div className={`${styles.metricLabel} ${styles.colorElapsed} ${styles.metricLabelDesktop}`}>\n                                Total Elapsed Duration\n                            </div>\n                            <div className={`${styles.metricValue} ${styles.metricValueDesktop}`}>\n                                {formatDuration(dynamicMetrics.totalElapsedDuration)}\n                            </div>\n                            <div className={styles.metricSubtext}>\n                                Includes rest periods\n                            </div>\n                        </div>\n                    )}\n\n                    <div className={`${styles.metricCard} ${styles.metricCardTss} ${viewport.isMobile ? styles.metricCardMobile : styles.metricCardDesktop}`}>\n                        <div className={`${styles.metricLabel} ${styles.colorTss} ${viewport.isMobile ? styles.metricLabelMobile : styles.metricLabelDesktop}`}>\n                            TSS® ({targetIntensityValue}%)\n                        </div>\n                        <div className={`${styles.metricValue} ${viewport.isMobile ? styles.metricValueMobile : styles.metricValueDesktop}`}>\n                            {Math.round(dynamicMetrics.totalTSS)} ({Math.round(targetMetrics.totalTargetTSS)})\n                        </div>\n                    </div>\n\n                    <div className={`${styles.metricCard} ${styles.metricCardIf} ${viewport.isMobile ? styles.metricCardMobile : styles.metricCardDesktop}`}>\n                        <div className={`${styles.metricLabel} ${styles.colorIf} ${viewport.isMobile ? styles.metricLabelMobile : styles.metricLabelDesktop}`}>\n                            Avg IF® ({targetIntensityValue}%)\n                        </div>\n                        <div className={`${styles.metricValue} ${viewport.isMobile ? styles.metricValueMobile : styles.metricValueDesktop}`}>\n                            {dynamicMetrics.averageIF.toFixed(2)} ({targetMetrics.averageTargetIF.toFixed(2)})\n                        </div>\n                    </div>\n\n                    <div className={`${styles.metricCard} ${styles.metricCardNp} ${viewport.isMobile ? styles.metricCardMobile : styles.metricCardDesktop}`}>\n                        <div className={`${styles.metricLabel} ${styles.colorNp} ${viewport.isMobile ? styles.metricLabelMobile : styles.metricLabelDesktop}`}>\n                            Avg NP® ({targetIntensityValue}%)\n                        </div>\n                        <div className={`${styles.metricValue} ${viewport.isMobile ? styles.metricValueMobile : styles.metricValueDesktop}`}>\n                            {Math.round(dynamicMetrics.totalNP)}W ({Math.round(targetMetrics.totalTargetNP)}W)\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Scenario Analysis Charts */}\n            <div className={styles.chartsSection}>\n                <ScenarioComparison\n                    scenarios={[currentScenario]}\n                    userProfile={userProfile}\n                    singleScenarioView={true}\n                />\n            </div>\n\n            {/* Reorderable Workout List */}\n            <ReorderableWorkoutList\n                workouts={scenario.workouts}\n                userProfile={userProfile}\n                onReorder={handleWorkoutReorder}\n                title=\"\"\n                subtitle=\"\"\n            />\n            \n            {/* Print Modal */}\n            {showPrintModal && (\n                <PrintQuestModal\n                    scenario={scenario}\n                    userProfile={userProfile}\n                    onClose={() => setShowPrintModal(false)}\n                />\n            )}\n\n            {/* Workout Scheduling Modal */}\n            <WorkoutSchedulingModal\n                scenario={currentScenario}\n                isOpen={showSchedulingModal}\n                onClose={() => setShowSchedulingModal(false)}\n            />\n        </div>\n    );\n};\n\nexport default ScenarioDetailsView;","import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport ScenarioDetailsView from '../components/ScenarioDetailsView';\nimport { Scenario } from '../types/scenario';\nimport { UserPowerProfile } from '../types/userProfile';\nimport { loadScenarios, saveScenarios } from '../utils/scenarioHelpers';\n\ninterface ScenarioDetailRouteProps {\n    userProfile: UserPowerProfile;\n    scenarios: Scenario[];\n    onScenariosUpdate: (scenarios: Scenario[]) => void;\n}\n\nconst ScenarioDetailRoute: React.FC<ScenarioDetailRouteProps> = ({ \n    userProfile, \n    scenarios, \n    onScenariosUpdate \n}) => {\n    const { scenarioId } = useParams<{ scenarioId: string }>();\n    const navigate = useNavigate();\n    const [selectedScenario, setSelectedScenario] = useState<Scenario | null>(null);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        if (scenarioId && scenarios.length > 0) {\n            const scenario = scenarios.find(s => s.id === scenarioId);\n            if (scenario) {\n                setSelectedScenario(scenario);\n                setLoading(false);\n            } else {\n                // If scenario not found, try reloading scenarios from localStorage\n                const savedScenarios = loadScenarios();\n                const foundScenario = savedScenarios.find(s => s.id === scenarioId);\n                if (foundScenario) {\n                    setSelectedScenario(foundScenario);\n                    // Update parent component with fresh scenarios\n                    onScenariosUpdate(savedScenarios);\n                } else {\n                    // Scenario doesn't exist, redirect to scenarios page\n                    console.warn(`Scenario ${scenarioId} not found, redirecting to scenarios page`);\n                    navigate('/scenarios');\n                }\n                setLoading(false);\n            }\n        } else if (scenarioId && scenarios.length === 0) {\n            // Scenarios not loaded yet, try loading from localStorage\n            const savedScenarios = loadScenarios();\n            const foundScenario = savedScenarios.find(s => s.id === scenarioId);\n            if (foundScenario) {\n                setSelectedScenario(foundScenario);\n                onScenariosUpdate(savedScenarios);\n            } else {\n                navigate('/scenarios');\n            }\n            setLoading(false);\n        } else {\n            setLoading(false);\n        }\n    }, [scenarioId, scenarios, navigate, onScenariosUpdate]);\n\n    const handleScenarioUpdate = (updatedScenario: Scenario) => {\n        setSelectedScenario(updatedScenario);\n        // Update the scenarios list in case we go back\n        const updatedScenarios = scenarios.map(s => \n            s.id === updatedScenario.id ? updatedScenario : s\n        );\n        onScenariosUpdate(updatedScenarios);\n        saveScenarios(updatedScenarios);\n    };\n\n    if (loading) {\n        return <div>Loading scenario...</div>;\n    }\n\n    if (!selectedScenario) {\n        return <div>Scenario not found</div>;\n    }\n\n    return (\n        <ScenarioDetailsView\n            scenario={selectedScenario}\n            userProfile={userProfile}\n            onBack={() => navigate('/scenarios')}\n            onScenarioUpdate={handleScenarioUpdate}\n        />\n    );\n};\n\nexport default ScenarioDetailRoute;","import React, { useState, useEffect } from 'react';\nimport { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\nimport WorkoutChart from './components/WorkoutChart';\nimport styles from './App.module.css';\nimport WorkoutSelector from './components/WorkoutSelector';\nimport ScenarioManager from './components/ScenarioManager';\nimport SaveScenarioModal from './components/SaveScenarioModal';\nimport UserProfileSetup from './components/UserProfileSetup';\nimport UserProfileManager from './components/UserProfileManager';\nimport WorkoutTable from './components/WorkoutTable';\nimport ScenarioDetailsView from './components/ScenarioDetailsView';\nimport SharedScenarioView from './components/SharedScenarioView';\nimport IntroPage from './components/IntroPage';\nimport Footer from './components/Footer';\nimport knighthoodWorkouts from './data/knighthood-workouts.json';\nimport allWorkouts from './data/workouts.json';\nimport { calculateAllTrainingMetrics } from './utils/trainingMetrics';\nimport { getWorkoutData } from './data/workout-data';\nimport { WorkoutData } from './types/workout';\nimport { Scenario, BasketState } from './types/scenario';\nimport { getBestWorkoutData } from './utils/workoutDataHelpers';\nimport { UserPowerProfile } from './types/userProfile';\nimport { loadScenarios, saveScenarios } from './utils/scenarioHelpers';\nimport { getUserProfile, saveUserProfile, hasUserProfile, getUserProfileWithDefaults, isUsingDefaultProfile } from './utils/userProfileHelpers';\nimport { useViewport } from './hooks/useViewport';\nimport { useAppRouting } from './hooks/useAppRouting';\nimport ScenarioDetailRoute from './routes/ScenarioDetailRoute';\n\n// Global CSS styles that need to be injected for dynamic classes\nconst globalStyles = `\n  .workout-checkbox {\n    cursor: pointer;\n  }\n  \n  .workout-checkbox.selected {\n    background-color: #4CAF50 !important;\n  }\n  \n  .workout-checkbox.unselected {\n    background-color: transparent !important;\n  }\n`;\n\ninterface KnighthoodWorkout {\n    id: string;\n    name: string;\n}\n\ninterface WorkoutTableRow {\n    id: string;\n    name: string;\n    workoutData: WorkoutData | null;\n    metrics: {\n        duration: string;\n        tss: number;\n        intensityFactor: number;\n        normalizedPower: number;\n    } | null;\n    error?: string;\n    usedOutdoorData?: boolean;\n}\n\nconst AppContent = () => {\n    const viewport = useViewport();\n    const { currentPage, scenarioId, sharedScenarioData, setPage } = useAppRouting();\n    const [workoutRows, setWorkoutRows] = useState<WorkoutTableRow[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [basketState, setBasketState] = useState<BasketState>({ selectedWorkouts: [], isComplete: false });\n    const [showSaveModal, setShowSaveModal] = useState(false);\n    const [editingScenario, setEditingScenario] = useState<Scenario | null>(null);\n    const [scenarios, setScenarios] = useState<Scenario[]>([]);\n    const [userProfile, setUserProfile] = useState<UserPowerProfile | null>(null);\n    const [showProfileSetup, setShowProfileSetup] = useState(false);\n\n    const formatDuration = (seconds: number): string => {\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n        \n        if (hours > 0) {\n            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        } else {\n            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        }\n    };\n\n    const findWorkoutTitle = (contentId: string): string => {\n        const workout = allWorkouts.data.library.content.find((item: any) => item.id === contentId);\n        return workout?.name || 'Unknown Workout';\n    };\n\n    const loadWorkoutData = async (workoutId: string): Promise<{ data: WorkoutData | null; usedOutdoor: boolean }> => {\n        try {\n            // Load the workout data from imported modules\n            const rawData = getWorkoutData(workoutId);\n            if (!rawData) {\n                throw new Error(`Workout data not found for ${workoutId}`);\n            }\n            const result = getBestWorkoutData(rawData);\n            return {\n                data: result.data,\n                usedOutdoor: result.usedOutdoor\n            };\n        } catch (error) {\n            console.error(`Error loading workout data for ${workoutId}:`, error);\n            return { data: null, usedOutdoor: false };\n        }\n    };\n\n    // Load workout data on component mount\n    useEffect(() => {\n        const loadAllWorkoutData = async () => {\n            setLoading(true);\n            const rows: WorkoutTableRow[] = [];\n            \n            for (const workout of knighthoodWorkouts.workouts) {\n                try {\n                    const result = await loadWorkoutData(workout.id);\n                    const workoutData = result.data;\n                    \n                    if (workoutData) {\n                        const profile = getUserProfileWithDefaults();\n                        const metrics = calculateAllTrainingMetrics(workoutData, profile);\n                        \n                        rows.push({\n                            id: workout.id,\n                            name: workout.name,\n                            workoutData,\n                            metrics: {\n                                duration: formatDuration(workoutData.time[workoutData.time.length - 1] || 0),\n                                tss: Math.round(metrics.trainingStressScore),\n                                intensityFactor: metrics.intensityFactor,\n                                normalizedPower: Math.round(metrics.normalizedPower)\n                            },\n                            usedOutdoorData: result.usedOutdoor\n                        });\n                    } else {\n                        rows.push({\n                            id: workout.id,\n                            name: workout.name,\n                            workoutData: null,\n                            metrics: null,\n                            error: 'Workout data not available'\n                        });\n                    }\n                } catch (error) {\n                    console.error(`Error processing workout ${workout.id}:`, error);\n                    rows.push({\n                        id: workout.id,\n                        name: workout.name,\n                        workoutData: null,\n                        metrics: null,\n                        error: 'Failed to load workout data'\n                    });\n                }\n            }\n            \n            setWorkoutRows(rows);\n            setLoading(false);\n        };\n\n        loadAllWorkoutData();\n    }, []);\n\n    // Load user profile and scenarios on mount\n    useEffect(() => {\n        // Always use getUserProfileWithDefaults to ensure proper migration and fallbacks\n        const profile = getUserProfileWithDefaults();\n        setUserProfile(profile);\n\n        // Load saved scenarios\n        const savedScenarios = loadScenarios();\n        setScenarios(savedScenarios);\n    }, []);\n\n    const handleBasketChange = (newBasketState: BasketState) => {\n        setBasketState(newBasketState);\n    };\n\n    const handleSaveScenario = (scenario: Scenario) => {\n        let updatedScenarios: Scenario[];\n        \n        if (editingScenario) {\n            // Update existing scenario\n            updatedScenarios = scenarios.map(s => s.id === scenario.id ? scenario : s);\n            setEditingScenario(null);\n        } else {\n            // Add new scenario\n            updatedScenarios = [...scenarios, scenario];\n        }\n        \n        setScenarios(updatedScenarios);\n        saveScenarios(updatedScenarios);\n        setBasketState({ selectedWorkouts: [], isComplete: false });\n        setShowSaveModal(false);\n        \n        // Navigate to scenarios page\n        setPage('scenarios');\n    };\n\n    const handleEditScenario = (scenario: Scenario) => {\n        setEditingScenario(scenario);\n        setBasketState({\n            selectedWorkouts: scenario.workouts,\n            isComplete: scenario.workouts.length === 10\n        });\n        setPage('selector');\n    };\n\n    const handleScenariosChange = (newScenarios: Scenario[]) => {\n        setScenarios(newScenarios);\n        saveScenarios(newScenarios);\n    };\n\n    const handleScenariosUpdate = (newScenarios: Scenario[]) => {\n        setScenarios(newScenarios);\n    };\n\n    const handleProfileSave = (profile: UserPowerProfile) => {\n        setUserProfile(profile);\n        saveUserProfile(profile);\n        setShowProfileSetup(false);\n    };\n\n    const handleSaveSharedScenario = (scenario: Scenario) => {\n        const updatedScenarios = [...scenarios, scenario];\n        setScenarios(updatedScenarios);\n        saveScenarios(updatedScenarios);\n        setPage('scenarios');\n    };\n\n    const handleBackToAppFromShare = () => {\n        setPage('intro');\n    };\n\n    const renderNavigation = () => (\n        <div className={`${styles.navigation} ${viewport.isMobile ? styles.navigationMobile : styles.navigationDesktop}`}>\n            <div className={`${styles.tabContainer} ${viewport.isMobile ? styles.tabContainerMobile : ''}`}>\n                    <button\n                        data-testid=\"home-tab\"\n                        className={`${styles.tabButton} ${viewport.isMobile ? styles.tabButtonMobile : ''} ${currentPage === 'intro' ? 'active' : ''}`}\n                        onClick={() => setPage('intro')}\n                    >\n                        Home\n                    </button>\n                    <button\n                        data-testid=\"quest-tab\"\n                        className={`${styles.tabButton} ${viewport.isMobile ? styles.tabButtonMobile : ''} ${currentPage === 'selector' ? 'active' : ''}`}\n                        onClick={() => {\n                            setPage('selector');\n                            setEditingScenario(null);\n                        }}\n                    >\n                        {viewport.isMobile ? `Plan Quest (${basketState.selectedWorkouts.length}/10)` : `Plan Your Quest (${basketState.selectedWorkouts.length}/10)`}\n                    </button>\n                    <button\n                        data-testid=\"scenarios-tab\"\n                        className={`${styles.tabButton} ${viewport.isMobile ? styles.tabButtonMobile : ''} ${currentPage === 'scenarios' ? 'active' : ''}`}\n                        onClick={() => setPage('scenarios')}\n                    >\n                        {viewport.isMobile ? `Enterpainment (${scenarios.length})` : `Enterpainment (${scenarios.length})`}\n                    </button>\n                    <button\n                        className={`${styles.tabButton} ${viewport.isMobile ? styles.tabButtonMobile : ''} ${currentPage === 'profile' ? 'active' : ''} ${isUsingDefaultProfile() ? 'warning' : ''}`}\n                        onClick={() => setPage('profile')}\n                    >\n                        {viewport.isMobile ? (isUsingDefaultProfile() ? '⚙️!' : '⚙️') : (isUsingDefaultProfile() ? '⚙️ Profile!' : '⚙️ Profile')}\n                    </button>\n            </div>\n        </div>\n    );\n\n    return (\n        <div className={`${styles.appContainer} ${viewport.isMobile ? styles.appContainerMobile : ''}`}>\n            <style dangerouslySetInnerHTML={{ __html: globalStyles }} />\n            \n            <Routes>\n                {/* Main application routes */}\n                <Route path=\"/\" element={\n                    <>\n                        {renderNavigation()}\n                        <div className={viewport.isMobile ? styles.contentWrapperMobile : styles.contentWrapper}>\n                            {userProfile ? (\n                                <IntroPage onGetStarted={() => setPage('selector')} />\n                            ) : null}\n                        </div>\n                        <Footer />\n                    </>\n                } />\n                \n                <Route path=\"/plan\" element={\n                    <>\n                        {renderNavigation()}\n                        <div className={viewport.isMobile ? styles.contentWrapperMobile : styles.contentWrapper}>\n                            {userProfile ? (\n                                <WorkoutSelector\n                                    onBasketChange={handleBasketChange}\n                                    initialBasket={basketState.selectedWorkouts}\n                                    userProfile={userProfile}\n                                    onSaveScenario={() => setShowSaveModal(true)}\n                                    editingScenario={editingScenario}\n                                    onCancelEdit={() => {\n                                        setEditingScenario(null);\n                                        setBasketState({ selectedWorkouts: [], isComplete: false });\n                                        setPage('scenarios');\n                                    }}\n                                />\n                            ) : null}\n                        </div>\n                        <Footer />\n                    </>\n                } />\n                \n                <Route path=\"/scenarios\" element={\n                    <>\n                        {renderNavigation()}\n                        <div className={viewport.isMobile ? styles.contentWrapperMobile : styles.contentWrapper}>\n                            {userProfile ? (\n                                <ScenarioManager\n                                    onEditScenario={handleEditScenario}\n                                    onViewScenario={(scenario) => {\n                                        setPage('scenario-detail', scenario.id);\n                                    }}\n                                    onScenariosChange={handleScenariosChange}\n                                    userProfile={userProfile}\n                                />\n                            ) : null}\n                        </div>\n                        <Footer />\n                    </>\n                } />\n                \n                <Route path=\"/profile\" element={\n                    <>\n                        {renderNavigation()}\n                        <div className={viewport.isMobile ? styles.contentWrapperMobile : styles.contentWrapper}>\n                            {userProfile ? (\n                                <UserProfileManager\n                                    currentProfile={userProfile}\n                                    onProfileUpdate={handleProfileSave}\n                                />\n                            ) : null}\n                        </div>\n                        <Footer />\n                    </>\n                } />\n                \n                <Route path=\"/scenario/:scenarioId\" element={\n                    <>\n                        {renderNavigation()}\n                        <div className={viewport.isMobile ? styles.contentWrapperMobile : styles.contentWrapper}>\n                            {userProfile ? (\n                                <ScenarioDetailRoute\n                                    userProfile={userProfile}\n                                    scenarios={scenarios}\n                                    onScenariosUpdate={handleScenariosUpdate}\n                                />\n                            ) : null}\n                        </div>\n                        <Footer />\n                    </>\n                } />\n                \n                <Route path=\"/share/\" element={\n                    sharedScenarioData && userProfile ? (\n                        <SharedScenarioView\n                            workoutIds={sharedScenarioData.workoutIds}\n                            scenarioName={sharedScenarioData.name}\n                            userProfile={userProfile}\n                            onSaveAsScenario={handleSaveSharedScenario}\n                            onBackToApp={handleBackToAppFromShare}\n                        />\n                    ) : null\n                } />\n            </Routes>\n            \n            {/* Modals */}\n            {showSaveModal && (\n                <SaveScenarioModal\n                    basketState={basketState}\n                    onSave={handleSaveScenario}\n                    onCancel={() => {\n                        setShowSaveModal(false);\n                        setEditingScenario(null);\n                    }}\n                    existingScenario={editingScenario}\n                />\n            )}\n            \n            {showProfileSetup && (\n                <UserProfileSetup\n                    onProfileSave={handleProfileSave}\n                    isFirstTime={false}\n                />\n            )}\n        </div>\n    );\n};\n\nconst App = () => {\n    return (\n        <Router basename=\"/knighthood-quests\">\n            <AppContent />\n        </Router>\n    );\n};\n\nexport default App;","import React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App';\n\nconst container = document.getElementById('root');\nconst root = createRoot(container!);\nroot.render(<App />);"],"names":["m","require$$0","client","hasAllZeroValues","workoutData","val","getBestWorkoutData","rawData","indoor","_b","_a","outdoor","_d","_c","getPowerValue","type","intensity","userProfile","calculateNormalizedPower","time","value","maxTime","powerBySecond","second","segmentIndex","i","actualPower","rollingAverages","average","sum","power","fourthPowers","avg","averageOfFourthPowers","normalizedPower","calculateIntensityFactor","intensityFactor","calculateTrainingStressScore","durationInSeconds","durationInHours","tss","calculateAllTrainingMetrics","duration","trainingStressScore","workout_14TmGHiqpC","workout_1tViNkXwKQ","workout_3aJ8nMrgLd","workout_3rLnRlTdQ3","workout_54dYn0oExU","workout_553lkiVNgV","workout_89HeFQSbGE","workout_FML2PrDvkR","workout_IX2uSFbGPZ","workout_JpDMHRZtaB","workout_LGt8MqcvdQ","workout_MzBfwwDxEB","workout_NkctG9Onu1","workout_OIoXe9I4bh","workout_PexwKSHyz6","workout_TBn7DwOwEc","workout_VBEbqmsmYl","workout_YBjIjxrpJ2","workout_aB01LoXAZk","workout_bZIBbPzXc6","workout_e0fpoQCSWR","workout_ereX1jTlGO","workout_k0MlcITKGW","workout_tJpZlAA0hq","workout_uLOWEcW9V1","workout_vCBrff5o6l","workout_xjx8cV9fzM","workout_xzCdnkKwU1","getWorkoutData","workoutId","SCENARIOS_STORAGE_KEY","loadWorkoutMetrics","result","metrics","error","saveScenarios","scenarios","loadScenarios","stored","calculateCombinedMetricsDynamic","workouts","metricsPromises","workout","validMetrics","totalDuration","totalTSS","restPeriods","totalElapsedDuration","totalIFDuration","ifValue","product","averageIF","totalNPDuration","npValue","totalNP","calculateCombinedMetrics","validWorkouts","w","formatDuration","seconds","hours","minutes","secs","generateScenarioId","generateOptimalSelections","lowestTSS","a","b","highestTSS","shortestDuration","longestDuration","lowestIF","highestIF","balanced","maxTSS","maxDuration","maxIF","minTSS","minDuration","minIF","normalizedTSS","normalizedDuration","normalizedIF","tssDistance","durationDistance","ifDistance","balanceScore","convertToWorkoutSelections","sortedWorkouts","DEFAULT_TARGET_INTENSITY","getTargetIntensity","formatTargetIntensity","useViewport","viewport","setViewport","useState","useEffect","updateViewport","width","height","getColorByType","generateSVG","showMetrics","svgWidth","chartHeight","chartTop","elements","maxPower","currentX","startTime","endTime","workoutType","x","rectWidthFloat","rectWidth","rectHeight","y","fillColor","React","ftp","ftpRatio","ftpY","generateWorkoutHeader","headerElements","totalSeconds","durationText","labelFontSize","valueFontSize","legendFontSize","metricsY","valuesY","np","legendStartX","legendSpacing","circleRadius","circleY","zone","index","xPos","WorkoutChart","jsx","styles","jsxs","WorkoutSelector","onBasketChange","initialBasket","onSaveScenario","editingScenario","onCancelEdit","workoutRows","setWorkoutRows","loading","setLoading","basket","setBasket","searchTerm","setSearchTerm","sortBy","setSortBy","sortOrder","setSortOrder","optimalSelections","setOptimalSelections","showFloatingSave","setShowFloatingSave","searchInputRef","MAX_WORKOUTS","findWorkoutTitle","contentId","allWorkouts","item","loadWorkoutData","handleSort","column","getSortIcon","rows","basketIds","knighthoodWorkouts","title","workoutResult","calculatedMetrics","row","optimal","handleScroll","isSearchVisible","toggleWorkoutSelection","newBasket","newWorkout","clearBasket","randomKnighthoodQuest","shuffled","aValue","bValue","_e","_f","combinedMetrics","targetIntensityValue","targetIntensity","baseTSS","baseIF","baseNP","targetMetrics","renderMobileLayout","selections","Fragment","e","col","isSelected","isClickable","canSelect","canDeselect","target","printStyles","PrintQuestModal","scenario","onClose","setStartTime","now","calculateSchedule","startDate","currentTime","schedule","workoutStartTime","durationMinutes","workoutEndTime","breakEndTime","handlePrint","intensityScaleFactor","scaledTotalTSS","scaledAvgIF","printContent","printWindow","originalStyle","ChartJS","CategoryScale","LinearScale","PointElement","LineElement","BarElement","BarController","ArcElement","Title","Tooltip","Legend","BUCKET_SIZE_MINUTES","BUCKET_SIZE_SECONDS","POWER_ZONES","CHART_COLORS","ScenarioComparison","onClearSelection","singleScenarioView","scenarioPowerProfiles","setScenarioPowerProfiles","setError","customIntensity","setCustomIntensity","profiles","effectiveIntensity","color","powerProfile","calculateScenarioPowerProfile","err","profile","allPowerData","data","workoutPowerData","extractNormalizedPowerData","bucketPowerData","regularPower","timeArr","valueArr","lastValue","nextIdx","t","adjustedPower","npSeries","startIdx","window","mean4th","powerData","bucketSize","buckets","point","bucketIndex","p","formatTime","chartData","dataPoints","chartOptions","d","tooltipItems","context","yValue","cumulativeTSSData","scenarioIndex","cumulativeTSS","tssPoints","workoutTSS","powers","v","totalNP4","count","timeStep","progressTSS","tssChartData","tssChartOptions","zoneDistributions","zoneTimes","percentFTP","intervalDuration","j","zoneChartData","idx","zoneChartOptions","zonePieChartData","zonePieChartOptions","chart","label","total","percentage","Line","Pie","Bar","ScenarioManager","onEditScenario","onViewScenario","onScenariosChange","comparisonSectionRef","useRef","setScenarios","scenariosWithMetrics","setScenariosWithMetrics","isLoadingMetrics","setIsLoadingMetrics","selectedScenarios","setSelectedScenarios","showPrintModal","setShowPrintModal","savedScenarios","scenariosWithDynamics","dynamicMetrics","deleteScenario","scenarioId","updatedScenarios","s","updatedScenariosWithMetrics","prev","newSet","duplicateScenario","duplicatedScenario","duplicatedScenarioWithMetrics","shareScenario","workoutIds","shareUrl","toggleScenarioSelection","clearSelection","compareAll","allScenarioIds","sortedScenarios","selectedScenariosList","id","isLastRow","SaveScenarioModal","basketState","onSave","onCancel","existingScenario","scenarioName","setScenarioName","handleSave","handleKeyPress","USER_PROFILE_STORAGE_KEY","saveUserProfile","profileData","getUserProfile","hasUserProfile","clearUserProfile","getDefaultPowerProfile","getUserProfileWithDefaults","isUsingDefaultProfile","validatePowerProfile","errors","UserProfileSetup","onProfileSave","initialProfile","isFirstTime","setProfile","setErrors","isSubmitting","setIsSubmitting","handleInputChange","field","numValue","handleSubmit","validationErrors","UserProfileManager","currentProfile","onProfileUpdate","showSetup","setShowSetup","showDeleteConfirm","setShowDeleteConfirm","handleProfileSave","handleClearProfile","getTSSColor","normalized","red","green","getVarianceColor","variance","absVariance","ReorderableWorkoutList","onReorder","subtitle","draggedIndex","setDraggedIndex","dragOverIndex","setDragOverIndex","setMinTSS","setMaxTSS","setTotalTSS","totalTargetTSS","setTotalTargetTSS","averageTargetIF","setAverageTargetIF","setTotalDuration","setAverageIF","combinedWorkoutData","setCombinedWorkoutData","formatDurationFromSeconds","combineWorkoutDataWithRest","combinedTime","combinedValue","combinedType","adjustedTime","lastTime","validTSSValues","minTSSValue","maxTSSValue","totalTSSValue","validTargetTSSValues","validTargetIFValues","totalTargetTSSValue","targetTss","averageTargetIFValue","targetIf","validDurationValues","parts","validIFValues","totalDurationValue","averageIFValue","if_val","combined","handleDragStart","handleDragEnd","handleDragOver","handleDragEnter","handleDrop","dropIndex","newWorkouts","draggedWorkout","handleChartClick","workoutRow","SharedScenarioView","onSaveAsScenario","onBackToApp","setWorkouts","setDynamicMetrics","setTargetMetrics","saveAsName","setSaveAsName","loadSharedScenario","workoutSelections","handleSaveAs","newScenario","IntroPage","onGetStarted","PrivacyPolicyModal","isOpen","Footer","showPrivacyPolicy","setShowPrivacyPolicy","useAppRouting","navigate","useNavigate","location","useLocation","params","useParams","getCurrentPage","path","getScenarioId","getSharedScenarioData","searchParams","workoutsParam","nameParam","setPage","page","SystmApiError","message","code","SystmApiService","authToken","headers","credentials","request","response","loginResult","scheduleItem","scheduleResult","systmApi","getWorkoutContentId","loadWorkoutContentIds","contentIdMap","loadPromises","missing","r","generateScheduleItems","timeZone","scheduleItems","date","isoString","formatDate","WorkoutSchedulingModal","currentStep","setCurrentStep","formData","setFormData","setAuthToken","setScheduleItems","results","setResults","handleFormSubmit","token","items","errorMessage","handleConfirmScheduling","scheduleResults","agendaId","handleClose","ScenarioDetailsView","onBack","onScenarioUpdate","currentScenario","setCurrentScenario","showSchedulingModal","setShowSchedulingModal","honourStage","setHonourStage","handleHonourClick","getHonourButtonText","handleWorkoutReorder","reorderedWorkouts","updatedScenario","allScenarios","targetIntensityDecimal","baseDuration","targetIF","targetNP","durationHours","targetTSS","totalTargetNP","ScenarioDetailRoute","onScenariosUpdate","selectedScenario","setSelectedScenario","foundScenario","handleScenarioUpdate","globalStyles","AppContent","currentPage","sharedScenarioData","setBasketState","showSaveModal","setShowSaveModal","setEditingScenario","setUserProfile","showProfileSetup","setShowProfileSetup","handleBasketChange","newBasketState","handleSaveScenario","handleEditScenario","handleScenariosChange","newScenarios","handleScenariosUpdate","handleSaveSharedScenario","handleBackToAppFromShare","renderNavigation","Routes","Route","App","Router","container","root","createRoot"],"mappings":"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","x_google_ignoreList":[0]}